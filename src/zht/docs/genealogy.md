---
title: 字形輸入法源流圖
aside: false
---

<script setup>
import Genealogy from '../../components/genealogy/Genealogy.vue'
</script>

# 字形輸入法源流圖

<Genealogy />

## 說明

- **時間軸**：左側顯示年份，從上到下表示時間推移
- **卡片**：每個卡片代表一個輸入法，顯示名稱、作者和發布時間
- **點擊**：點擊卡片可以查看詳細信息和源流關係
- **搜索**：使用頂部搜索框快速定位輸入法
- **反轉**：點擊 ⇅ 按鈕可以反轉時間軸方向

## 功能特性

::: info 當前進度
✅ 數據加載和解析  
✅ 基礎佈局和時間軸  
✅ **智能佈局算法（防重疊）**  
✅ **動態時間軸間距（空間節省 75%）**  
✅ **空白段壓縮算法（連續空白自動壓縮）**  
✅ **智能年份標籤（壓縮率 53%）**  
✅ **自動分組和橫向分佈**  
✅ **佈局質量評分系統**  
✅ **可選的力導向優化**  
✅ **連接關係計算**  
✅ **貝塞爾曲線連接線**  
✅ **特性/作者繼承可視化**  
✅ 搜索和篩選功能  
🚧 完整的 Focus 互動（開發中）  
🚧 響應式優化（開發中）
:::

### 智能佈局算法

源流圖採用了先進的智能佈局算法，確保輸入法卡片清晰可見、不會重疊：

1. **動態時間軸間距**：根據每年的輸入法數量智能調整間距
1. **動態時間軸間距**：根據每年的輸入法數量智能調整間距
   - 有輸入法的年份：自動擴展高度（70px，緊湊單行卡片）
   - 短空白期（<3年）：正常間距（20px/年）
   - 長空白期（≥3年）：整段壓縮為固定高度（40px）
   - 空間利用率提升 **80%+**！
2. **緊湊單行卡片**：將三行信息壓縮為一行
   - 格式：**輸入法名** 作者名 | 年份
   - 卡片高度從 80px 減少到 40px（節省 50%）
   - 視覺更清爽，可容納更多信息
3. **智能年份標籤**：空白段只顯示起始、結束和間隔年份
   - 減少 53% 的標籤數量，保持清晰度
   - 例如：1999-2013年（15年空白期）只顯示 1999、2004、2009、2013
4. **時間軸定位**：根據精確的發布日期（年/月/日）計算Y坐標
5. **智能分組**：將時間相近的輸入法自動分組
6. **橫向分佈**：同一時間段的輸入法均勻分佈，避免擁擠
7. **防重疊檢測**：自動檢測並避免卡片重疊
8. **質量評分**：實時顯示佈局質量（0-100分）

#### 緊湊布局優勢

- **卡片高度減半**：從 80px → 40px
- **間距優化**：nodeSpacing 20→15, schemaSpacing 90→50
- **空白段壓縮**：emptySegmentSpacing 60→40
- **總體高度**：進一步減少約 40-50%

#### 空白段壓縮示例

實際數據（1976-2024，緊湊布局）：
- **1987-1997**（11年空白）：220px → 40px（節省 180px）
- **1999-2013**（15年空白）：300px → 40px（節省 260px）
- **2015-2022**（8年空白）：160px → 40px（節省 120px）
- **總計節省**：進一步優化，總高度可能降至 **600-700px**

### 連接關係可視化

源流圖會自動計算並展示輸入法之間的繼承關係：

#### 特性繼承（實線）
- 當一個輸入法首次引入某個特性時，它成為該特性的"起源"
- 後續使用該特性的輸入法會用**藍紫色實線**連接到起源
- 例如："最長四碼"特性從鄭碼開始，後續的五筆、徐碼都會連接到鄭碼

#### 作者繼承（虛線）
- 當同一作者創作多個輸入法時，它們會按時間順序連接
- 使用**綠色虛線**表示
- 例如：王永民的五筆86版和五筆98版會用綠色虛線連接

### 交互功能

- **篩選連接類型**：使用"全部/特性/作者"按鈕切換顯示的連接類型
- **Hover 連接線**：鼠標懸停時連接線會高亮並顯示標籤
- **點擊卡片**：點擊輸入法卡片時，只顯示與該輸入法相關的連接
- **連接統計**：控制台輸出連接數量和類型分布

### 佈局優化選項

開啟"優化佈局"選項後，會使用力導向算法進一步優化節點位置：
- 自動調整節點間距
- 減少視覺混亂

### 配置選項

可以通過 `config` 屬性自定義源流圖的行為：

```vue
<Genealogy :config="{
  width: 900,                    // 畫布寬度
  nodeSpacing: 15,              // 卡片間距（默認 15px，緊湊布局）
  baseSpacing: 20,              // 短空白期間距（默認 20px）
  schemaSpacing: 50,            // 每個輸入法高度（默認 50px，緊湊）
  emptyYearThreshold: 3,        // 空白段閾值（默認 3年）
  emptySegmentSpacing: 40,      // 空白段總高度（默認 40px）
  labelInterval: 5,             // 空白段標籤間隔（默認 5年）
  nodeSpacing: 20,              // 卡片最小間距
  showDeprecated: true          // 顯示已停止維護的輸入法
}" />
```

#### 間距參數說明

- **nodeSpacing**：相鄰卡片之間的最小間距（緊湊布局默認 15px）
- **baseSpacing**：短空白期（<閾值）每年的間距（緊湊布局默認 20px）
- **schemaSpacing**：每個輸入法佔用的額外高度（緊湊布局默認 50px）
- **emptyYearThreshold**：連續超過此年數的空白期將被壓縮
  - 設為 3：連續 3 年以上空白會壓縮
  - 設為 999：禁用空白段壓縮（退回舊版行為）
- **emptySegmentSpacing**：長空白段的總高度（無論多少年）
  - 緊湊布局默認 40px（例如：15年空白期也只佔用 40px）
- **labelInterval**：空白段內年份標籤的顯示間隔
  - 設為 5：每 5 年顯示一次標籤
  - 設為 0：只顯示起始和結束年份

#### 效果對比

| 方案                         | 總高度     | 節省空間 | 平均/輸入法 | 卡片高度 |
| ---------------------------- | ---------- | -------- | ----------- | -------- |
| 固定間距（100px/年）         | 4800px     | -        | 600px       | 80px     |
| 動態間距（無壓縮）           | 2100px     | 56.3%    | 263px       | 80px     |
| 空白段壓縮                   | 1200px     | 75.0%    | 150px       | 80px     |
| **緊湊單行布局**（當前推薦） | **~700px** | **~85%** | **~88px**   | **40px** |
- 提升整體美觀度

適合節點較多且分佈密集的情況。
