import{f as ue}from"./share.Nrbaa2_l.js";import{C as J}from"./ChaiDataLoader.DYi6iwdM.js";import{d as re,k as P,am as ve,h as f,l as ee,A as he,y as se,o as e,c as s,e as x,m as l,n as y,F as p,G as g,Q as ne,t as h,q as _e,s as fe,_ as pe}from"./framework.rq0FYgLR.js";const v=U=>(_e("data-v-712e9f15"),U=U(),fe(),U),ge={class:"zigen-map-container"},me={key:0,class:"flex justify-center items-center py-8"},ye=v(()=>l("div",{class:"loading loading-spinner loading-lg"},null,-1)),xe=v(()=>l("span",{class:"ml-2"},"正在加载字根数据...",-1)),ke=[ye,xe],be={key:1,class:"flex justify-between items-center mb-4"},ze=v(()=>l("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),Ce={key:0,class:"flex items-center space-x-2"},we=v(()=>l("span",{class:"text-xs text-gray-400"},"切換字根圖和字根表：",-1)),$e=["title"],Ze={key:0},Le={key:1},Se={key:2,class:"keyboard-layout"},Me={class:"key-label"},Ee=["onMouseenter","onClick"],Pe={class:"zigen-code"},Ue={key:0,class:"more-indicator"},De={key:1,class:"text-xs text-gray-400 no-zigen-text"},je={key:0,class:"vertical-text zigen-font"},Be=v(()=>l("div",null,"引導特殊符號",-1)),Fe=v(()=>l("div",null,"切換多重註解",-1)),Ie=[Be,Fe],Ke={key:1,class:"vertical-text zigen-font"},We=v(()=>l("div",null,"引導拼音反查",-1)),Ve=v(()=>l("div",null,"引導歷史輸入",-1)),Ae=[We,Ve],Ne={key:2,class:"vertical-text zigen-font"},qe=v(()=>l("div",null,null,-1)),He=v(()=>l("div",null,"一碼上屏字　了",-1)),Te=[qe,He],Xe={key:3,class:"vertical-text zigen-font"},Oe=v(()=>l("div",null,null,-1)),Ge=v(()=>l("div",null,"一碼上屏字　的",-1)),Qe=[Oe,Ge],Re={key:4,class:"vertical-text zigen-font"},Ye=v(()=>l("div",null,null,-1)),Je=v(()=>l("div",null,"一碼上屏字　是",-1)),es=[Ye,Je],ss={key:5,class:"vertical-text zigen-font"},ns=v(()=>l("div",null,null,-1)),ts=v(()=>l("div",null,"一碼上屏字　我",-1)),os=[ns,ts],ls={key:6,class:"vertical-text zigen-font"},is=v(()=>l("div",null,null,-1)),as=v(()=>l("div",null,"一碼上屏字　不",-1)),cs=[is,as],ds={key:7,class:"vertical-text single-line zigen-font"},us={class:"mobile-key-label"},rs={key:0,class:"mobile-zigen-container"},vs={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},hs=["onClick"],_s={class:"zigen-code"},fs={key:1,class:"mobile-no-zigen"},ps={key:0,class:"mobile-key-desc zigen-font"},gs={key:1,class:"mobile-key-desc zigen-font"},ms={key:2,class:"mobile-key-desc zigen-font"},ys={key:3,class:"mobile-key-desc"},xs={class:"popup-container"},ks={class:"popup-body"},bs={class:"popup-title"},zs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Cs={class:"zigen-header-inline current-zigen"},ws={key:0,class:"example-chars-same-line"},$s={key:1,class:"example-chars-same-line"},Zs=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ls=[Zs],Ss={class:"zigen-header-inline other-zigen"},Ms={key:0,class:"example-chars-same-line"},Es={key:1,class:"example-chars-same-line"},Ps=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Us=[Ps],Ds={key:5,class:"pinned-popup"},js={class:"popup-container"},Bs={class:"popup-body"},Fs={class:"popup-header"},Is={class:"popup-title"},Ks={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Ws={class:"zigen-header-inline current-zigen"},Vs={key:0,class:"example-chars-same-line"},As={key:1,class:"example-chars-same-line"},Ns=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),qs=[Ns],Hs={class:"zigen-header-inline other-zigen"},Ts={key:0,class:"example-chars-same-line"},Xs={key:1,class:"example-chars-same-line"},Os=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Gs=[Os],q=8,Qs=re({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(U){const F=U,Z=P(()=>F.zigenFontClass||"zigen-font"),te=ve(F,"columnMinWidth"),oe=P(()=>`repeat(auto-fill, minmax(${te.value||"2rem"}, max-content))`),H=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],L=["'"],D=f(!1),b=f(!1),K=()=>{D.value=window.innerWidth<1280},le=()=>{b.value=!b.value};ee(()=>{K(),window.addEventListener("resize",K)}),he(()=>{window.removeEventListener("resize",K)});const T=P(()=>H.flat()),ie=["joy","light","star","ming","wafel"];function W(a){const c=ie.includes(a);return{zigenUrl:`/zigen-${a}.csv`,chaifenUrl:c?"/chaifen.json":`/chaifen-${a}.json`}}const I=P(()=>F.defaultScheme||"star"),_=f(),z=f(),S=f(!1),j=f(null),C=f(null),V=f({x:0,y:0}),w=f({}),B=f(null),M=f(null),$=f({}),E=f(!1);se(()=>F.defaultScheme,()=>{z.value=null});const A=P(()=>{var r;if(!_.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",_.value.size);const a={},c=[];for(const[u,t]of _.value){const d=t.font,o=(r=t.ma)==null?void 0:r.trim();if(!o||o.length===0||d==null)continue;const n=o[0].toLowerCase(),i=o.slice(1);c.push({font:d,ma:o,firstLetter:n,code:i})}console.log(`Found ${c.length} valid zigens`);for(let u=0;u<c.length;u++){const t=c[u],{font:d,ma:o,firstLetter:n,code:i}=t;a[n]||(a[n]={visible:[],hidden:[]});const m=u>0?c[u-1]:null,k=m&&m.code===i&&m.firstLetter===n;a[n].visible.find(de=>de.code===i)?k?a[n].hidden.push({font:d,code:i}):a[n].visible.push({font:d,code:i}):a[n].visible.push({font:d,code:i})}return console.log("Final result:",a),a}),X=P(()=>{var c;if(!_.value)return{};const a={};for(const r of T.value)a[r]=[];for(const[r,u]of _.value){const t=u.font,d=(c=u.ma)==null?void 0:c.trim();if(!d||t===null||t===void 0)continue;const o=d[0].toLowerCase(),n=d.slice(1),i=a[o].some(m=>m.code===n);a[o].push({font:t,code:n,isHidden:i})}return a}),O=async a=>{var c;if(!z.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${a}" 搜索例字...`);const r=new Promise((i,m)=>{setTimeout(()=>m(new Error("數據加載超時")),1e4)}),u=await Promise.race([z.value.loadData(),r]),t=[],d=a.normalize("NFC");console.log(`搜索字根: "${d}"`);const o=Object.entries(u).slice(0,3);console.log("數據樣本:",o);let n=0;for(const[i,m]of Object.entries(u)){n++;const k=m;if(n<=5&&console.log(`字符 "${i}" 的拆分數據:`,k.d),(c=k.d)!=null&&c.includes(d)&&(console.log(`✅ 找到匹配: "${i}" 包含字根 "${d}", 拆分: "${k.d}"`),t.push(i),t.length>=q))break;n%1e3===0&&console.log(`已檢查 ${n} 個字符，找到 ${t.length} 個例字`)}return console.log(`字根 "${d}" 最終找到例字:`,t.slice(0,5),`(總共${t.length}個)`),t}catch(r){return console.error("获取例字失败:",r),r instanceof Error&&r.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function G(){S.value=!0;try{const a=W(I.value),c=await ue(a.zigenUrl);_.value=c,console.log(`已加載字根數據，文件: ${a.zigenUrl}`),console.log("注意：拆分數據將在第一次懸停字根時才加載")}catch(a){console.error("加载字根数据失败:",a)}finally{S.value=!1}}async function ae(a,c){var o;if(j.value=c.font,V.value={x:a.clientX,y:a.clientY},!z.value){console.log("第一次懸停，正在初始化拆分數據加載器...");const n=W(I.value);z.value=J.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}let r="";if(_.value){for(const[n,i]of _.value)if(i.font===c.font&&((o=i.ma)==null?void 0:o.slice(1))===c.code){r=i.ma;break}}const u=Y(c.font,r);C.value=u,console.log("開始獲取例字，字根數量:",[...u.visible,...u.hidden].length);const t={},d=[...u.visible,...u.hidden];for(const n of d){console.log(`正在獲取字根 "${n.font}" 的例字...`);const i=await O(n.font);console.log(`字根 "${n.font}" 找到例字:`,i.length,"個"),t[n.font]=i.slice(0,8)}w.value=t}function ce(){E.value||(j.value=null,C.value=null,w.value={})}function Q(a){switch(a){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function R(a,c){var o;if(a.stopPropagation(),!z.value){console.log("點擊時初始化拆分數據加載器...");const n=W(I.value);z.value=J.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}if(E.value&&B.value===c.font){N();return}B.value=c.font,E.value=!0;let r="";if(_.value){for(const[n,i]of _.value)if(i.font===c.font&&((o=i.ma)==null?void 0:o.slice(1))===c.code){r=i.ma;break}}const u=Y(c.font,r);M.value=u,console.log("開始獲取例字，字根數量:",[...u.visible,...u.hidden].length);const t={},d=[...u.visible,...u.hidden];for(const n of d){console.log(`正在獲取字根 "${n.font}" 的例字...`);const i=await O(n.font);console.log(`字根 "${n.font}" 找到例字:`,i.length,"個"),t[n.font]=i.slice(0,10)}$.value=t,console.log(`固定彈窗 - 字根 "${c.font}" 的最終例字:`,$.value),j.value=null,C.value=null,w.value={}}function N(){E.value=!1,B.value=null,M.value=null,$.value={}}function Y(a,c){var t;const r=[],u=[];if(!_.value||!c)return{visible:r,hidden:u};for(const[d,o]of _.value){const n=o.font,i=(t=o.ma)==null?void 0:t.trim();!i||!n||n===null||n===void 0||i===c&&(n===a?r.unshift({font:n,code:i}):u.push({font:n,code:i}))}return{visible:r,hidden:u}}return se(()=>I.value,G),ee(()=>{G(),document.addEventListener("click",a=>{if(E.value){const c=document.querySelector(".pinned-popup");c&&!c.contains(a.target)&&N()}})}),(a,c)=>{var r,u;return e(),s("div",ge,[S.value?(e(),s("div",me,ke)):x("",!0),S.value?x("",!0):(e(),s("div",be,[ze,D.value?x("",!0):(e(),s("div",Ce,[we,l("button",{onClick:le,class:y(["layout-toggle-btn",{"layout-toggle-active":b.value}]),title:b.value?"切換為網格布局":"切換為列表布局"},[b.value?(e(),s("span",Le,"⊞")):(e(),s("span",Ze,"☰"))],10,$e)]))])),!S.value&&_.value&&!D.value&&!b.value?(e(),s("div",Se,[(e(),s(p,null,g(H,(t,d)=>l("div",{key:d,class:"keyboard-row"},[(e(!0),s(p,null,g(t,o=>{var n;return e(),s("div",{key:o,class:y(["keyboard-key",{"empty-key":L.includes(o)}])},[l("div",Me,h(o.toUpperCase()),1),!L.includes(o)&&((n=A.value[o])==null?void 0:n.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:ne({gridTemplateColumns:oe.value})},[(e(!0),s(p,null,g(A.value[o].visible,(i,m)=>(e(),s("span",{key:m,class:"zigen-item",onMouseenter:k=>ae(k,i),onMouseleave:ce,onClick:k=>R(k,i)},[l("span",{class:y(Z.value)},h(i.font),3),l("span",Pe,h(i.code),1)],40,Ee))),128)),A.value[o].hidden.length>0?(e(),s("span",Ue,"⋯")):x("",!0)],4)):L.includes(o)?x("",!0):(e(),s("div",De,[o==="/"?(e(),s("div",je,Ie)):o==="z"?(e(),s("div",Ke,Ae)):o==="a"?(e(),s("div",Ne,Te)):o==="e"?(e(),s("div",Xe,Qe)):o==="i"?(e(),s("div",Re,es)):o==="o"?(e(),s("div",ss,os)):o==="u"?(e(),s("div",ls,cs)):(e(),s("div",ds,h(Q(o)),1))]))],2)}),128))])),64))])):x("",!0),!S.value&&_.value&&(D.value||b.value)?(e(),s("div",{key:3,class:y(["mobile-layout",{"desktop-list-layout":!D.value&&b.value}])},[(e(!0),s(p,null,g(T.value,t=>{var d;return e(),s("div",{key:t,class:y(["mobile-key-row",{"empty-mobile-key":L.includes(t)}])},[l("div",us,h(t.toUpperCase()),1),!L.includes(t)&&((d=X.value[t])==null?void 0:d.length)>0?(e(),s("div",rs,[l("div",vs,[(e(!0),s(p,null,g(X.value[t],(o,n)=>(e(),s("span",{key:`sorted-${n}`,class:y(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:i=>R(i,o)},[l("span",{class:y(Z.value)},h(o.font),3),l("span",_s,h(o.code),1)],10,hs))),128))])])):L.includes(t)?x("",!0):(e(),s("div",fs,[t==="/"?(e(),s("span",ps,"引導特殊符號")):t==="z"?(e(),s("span",gs,"引導拼音反查")):["a","e","i","o","u"].includes(t)?(e(),s("span",ms," 一碼上屏字 ")):(e(),s("span",ys,h(Q(t)),1))]))],2)}),128))],2)):x("",!0),j.value&&C.value?(e(),s("div",{key:4,class:"hover-card",style:ne({left:V.value.x+10+"px",top:V.value.y+10+"px"})},[l("div",xs,[l("div",ks,[l("h3",bs," 編碼 "+h(((r=C.value.visible[0])==null?void 0:r.code)||j.value)+" 上的字根 ",1),l("div",zs,[(e(!0),s(p,null,g(C.value.visible,(t,d)=>{var o;return e(),s("div",{key:`visible-${d}`,class:"zigen-row-inline"},[l("div",Cs,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=w.value[t.font])==null?void 0:o.length)>0?(e(),s("div",ws,[(e(!0),s(p,null,g(w.value[t.font].slice(0,q),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",$s,Ls))])}),128)),(e(!0),s(p,null,g(C.value.hidden,(t,d)=>{var o;return e(),s("div",{key:`hidden-${d}`,class:"zigen-row-inline"},[l("div",Ss,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=w.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Ms,[(e(!0),s(p,null,g(w.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Es,Us))])}),128))])])])],4)):x("",!0),E.value&&B.value&&M.value?(e(),s("div",Ds,[l("div",js,[l("div",Bs,[l("div",Fs,[l("h3",Is," 編碼 "+h(((u=M.value.visible[0])==null?void 0:u.code)||B.value)+" 上的字根 ",1),l("button",{onClick:N,class:"close-btn"},"✕")]),l("div",Ks,[(e(!0),s(p,null,g(M.value.visible,(t,d)=>{var o;return e(),s("div",{key:`pinned-visible-${d}`,class:"zigen-row-inline"},[l("div",Ws,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=$.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Vs,[(e(!0),s(p,null,g($.value[t.font].slice(0,q),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",As,qs))])}),128)),(e(!0),s(p,null,g(M.value.hidden,(t,d)=>{var o;return e(),s("div",{key:`pinned-hidden-${d}`,class:"zigen-row-inline"},[l("div",Hs,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=$.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Ts,[(e(!0),s(p,null,g($.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Xs,Gs))])}),128))])])])])):x("",!0)])}}}),sn=pe(Qs,[["__scopeId","data-v-712e9f15"]]);export{sn as Z};
