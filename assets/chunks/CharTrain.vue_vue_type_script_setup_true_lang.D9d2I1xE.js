var N=Object.defineProperty;var $=(n,t,s)=>t in n?N(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var w=(n,t,s)=>$(n,typeof t!="symbol"?t+"":t,s);import{c as T,f as U,m as A,d as C}from"./share.Bj6ex72H.js";import{d as M,E as v,l as S,v as E,c as h,o as u,m as l,t as m,n as k,e as b,b as z,p as L,a3 as V,a4 as O,a as _}from"./framework.D3o4Ln5n.js";import{f as j}from"./share.DRmL_k0C.js";import{_ as D}from"./MultiChaifen.vue_vue_type_script_setup_true_lang.CKbqv07g.js";function R(n,t){let s=null;return()=>{s||(s=setTimeout(()=>{n(),s=null},t))}}class B{constructor(t,s=""){w(this,"record");w(this,"progress",0);w(this,"saveLocal",R(()=>{window.localStorage.setItem(`yuhao_${this.name}_records`,JSON.stringify(this.record))},1e3));this.items=t,this.name=s;const e=window.localStorage.getItem(`yuhao_${this.name}_records`);e?this.record=JSON.parse(e):this.record=Array.from({length:this.items.length},(o,c)=>[-1,c]);let i=0;for(const o of this.record)o[0]!==-1&&++i;this.progress=i}first(){return{item:this.items[this.record[0][1]],isFirst:this.record[0][0]===-1}}nextSuccess(){const t=this.record.length-1,s=this.record[0],e=++s[0];e===0&&this.progress===s[1]&&this.progress++;let i=0;const o=[4,16,64,256];return e>o.length-1?(s[0]=8,i=t):(i=o[e],i>t&&(i=t)),this.record.copyWithin(0,1,i+1),this.record[i]=s,this.saveLocal(),this.first()}nextFail(){return this.record[0][0]=-1,this.saveLocal(),this.first()}}const J={key:0,class:"text-center py-16"},P={class:"mb-8"},W={class:"text-xl text-gray-600 mb-8"},Z={key:1},q={class:"flex justify-center mb-24"},G=["value","max"],H={class:"flex justify-around mb-8"},Q={key:0,class:"flex tracking-widest flex-col opacity-70"},X={key:1,class:"flex tracking-widest flex-col opacity-70"},Y={class:"font-bold text-xl"},K={class:"flex justify-center p-5"},ee={class:"font-mono"},te={key:0},se={key:1,class:"text-sm text-gray-500 mt-1"},ae={class:"font-mono text-blue-600"},ne={class:"text-gray-500 pb-16"},ie=M({__name:"TrainCard",props:{cards:{},name:{},chaifenMap:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(n){const t=n;let s;const e=v({name:"",key:""}),i=v(0),o=v(!0),c=v(!0),d=v(!1),f=v("");S(()=>{s=new B(t.cards,t.name);const r=s.first();e.value=r.item,o.value=r.isFirst,i.value=s.progress;const a=document.getElementById("input_el");a==null||a.focus()}),E(f,r=>{const a={的:"e",是:"i",我:"o",不:"u",了:"a"};(r.length>=e.value.key.length||t.ming&&a[e.value.name]&&r.toLowerCase()===a[e.value.name])&&(F(r),f.value="")});function F(r){const a=r.toLowerCase(),g=e.value.key.toLowerCase(),p={的:"e",是:"i",我:"o",不:"u",了:"a"};let x=a===g;!x&&t.ming&&p[e.value.name]&&(x=a===p[e.value.name]);let y;if(x?(y=s.nextSuccess(),c.value=!0):(y=s.nextFail(),c.value=!1),i.value>=t.cards.length){d.value=!0;return}e.value=y.item,o.value=y.isFirst,i.value=s.progress}function I(){s=new B(t.cards,t.name);const r=s.first();e.value=r.item,o.value=r.isFirst,i.value=s.progress,d.value=!1;const a=document.getElementById("input_el");a==null||a.focus()}return(r,a)=>{var g,p;return d.value?(u(),h("div",J,[l("div",P,[a[1]||(a[1]=l("div",{class:"text-6xl mb-4"},"🎉",-1)),a[2]||(a[2]=l("h2",{class:"text-4xl font-bold mb-2"},"恭喜你完成練習！",-1)),l("p",W,"你已经完成了 "+m(n.cards.length)+" 個項目的練習。感謝你的努力和堅持，爲中華文明和漢字的傳承又增添了一份力量！",1)]),l("div",{class:"space-y-4"},[l("button",{onClick:I,class:"btn btn-primary btn-lg px-8"}," 想要再訓練一輪嗎？ "),a[3]||(a[3]=l("div",{class:"text-sm text-gray-500"}," 繼續練習以巩固記憶 ",-1))])])):(u(),h("div",Z,[l("div",{class:k(["md:w-2/3 w-full shadow-sm my-12 pb-24 bg-opacity-10  rounded-md",{"bg-red-700":!c.value,"bg-slate-500":c.value}])},[l("div",q,[l("progress",{class:"progress w-full",value:i.value,max:n.cards.length},null,8,G)]),l("div",H,[l("div",{class:k(["text-6xl ",{"text-red-400":!c.value}])},m(e.value.name),3),n.mode==="z"?(u(),h("div",Q,[(u(),z(D,{chars:e.value.name,size:100,key:e.value.name,loc:""},null,8,["chars"]))])):b("",!0),n.mode==="g"&&n.chaifenMap?(u(),h("div",X,[a[4]||(a[4]=l("div",{class:"text-gray-500 text-sm"}," 相关的字： ",-1)),l("div",Y,m(L(j)(e.value.name,n.chaifenMap)),1)])):b("",!0)]),l("div",K,[V(l("input",{id:"input_el",type:"text",placeholder:"輸入編碼","onUpdate:modelValue":a[0]||(a[0]=x=>f.value=x),class:k(["input w-half max-w-xs input-bordered text-center input-sm dark:bg-slate-800 bg-white",{"input-error":!c.value}])},null,2),[[O,f.value]])]),l("div",{class:k(["text-center",{"opacity-0":!o.value}])},[a[7]||(a[7]=_("答案是 ",-1)),l("b",ee,m(e.value.key),1),n.mode==="z"?(u(),h("span",te,"（"+m((p=(g=n.chaifenMap)==null?void 0:g.get(e.value.name))==null?void 0:p.division)+"）",1)):b("",!0),t.ming&&["的","是","我","不","了"].includes(e.value.name)?(u(),h("div",se,[a[5]||(a[5]=_(" 也可直接使用韻碼 ",-1)),l("b",ae,m(e.value.name==="的"?"E":e.value.name==="是"?"I":e.value.name==="我"?"O":e.value.name==="不"?"U":e.value.name==="了"?"A":""),1),a[6]||(a[6]=_(" 直接上屏 ",-1))])):b("",!0)],2)],2),l("div",ne,"訓練進度："+m(i.value)+" / "+m(n.cards.length),1)]))}}}),le={key:1,class:"text-gray-700 text-center"},me=M({__name:"CharTrain",props:{name:{},chaifenUrl:{},zigenUrl:{},range:{},supplement:{type:Boolean},ming:{type:Boolean},wafel:{type:Boolean}},setup(n){const t=n;let s=t.name+"_char";const e=t.range;e&&(s+=`_${e[0]}_${e[1]}`);const i=v(C[s]),o=v();return S(async()=>{if(i.value&&o.value)return;o.value=await T(t.chaifenUrl);const c=await U(t.zigenUrl);let d=[...o.value.values()];e&&(d=d.slice(e[0],e[1])),i.value=d.map(f=>({name:f.char,key:A(f.division,c,t.supplement,t.ming,t.wafel)})),C[s]=i.value}),(c,d)=>i.value&&o.value?(u(),z(ie,{key:0,name:L(s),cards:i.value,chaifenMap:o.value,mode:"z",supplement:n.supplement,ming:n.ming},null,8,["name","cards","chaifenMap","supplement","ming"])):(u(),h("h2",le," 下载数据中…… "))}});export{me as _};
