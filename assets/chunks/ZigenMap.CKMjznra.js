import{f as ae}from"./share.Nrbaa2_l.js";import{C as ce}from"./ChaiDataLoader.DYi6iwdM.js";import{d as de,k as M,am as re,h as g,l as J,A as ue,y as Y,o as e,c as s,e as p,m as n,n as m,F as x,G as b,t as _,Q as ve,q as _e,s as he,_ as fe}from"./framework.rq0FYgLR.js";const v=A=>(_e("data-v-a5b5fe2e"),A=A(),he(),A),ge={class:"zigen-map-container"},pe={key:0,class:"flex justify-center items-center py-8"},me=v(()=>n("div",{class:"loading loading-spinner loading-lg"},null,-1)),ye=v(()=>n("span",{class:"ml-2"},"æ­£åœ¨åŠ è¼‰å­—æ ¹æ•¸æ“š...",-1)),ke=[me,ye],xe={key:1,class:"flex justify-between items-center mb-4"},be=v(()=>n("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," é»žæ“Šå­—æ ¹å¯æŸ¥çœ‹ä¾‹å­— ",-1)),ze={key:0,class:"flex items-center space-x-4"},Ce={class:"flex items-center space-x-2"},we=v(()=>n("span",{class:"text-xs text-gray-400"},"åˆ‡æ›å­—æ ¹åœ–å’Œå­—æ ¹è¡¨ï¼š",-1)),$e=["title"],Le={key:0},Se={key:1},Ze={key:0,class:"flex items-center space-x-2"},Me=v(()=>n("span",{class:"text-xs text-gray-400"},"æŒ‰éµæŽ’åºï¼š",-1)),Ae=["title"],Ee={key:0},Pe={key:1},Ue={key:1,class:"flex items-center space-x-2"},Be=v(()=>n("span",{class:"text-xs text-gray-400"},"æŒ‰éµæŽ’åºï¼š",-1)),De=["title"],je={key:0},Ke={key:1},Fe={key:2,class:"keyboard-layout"},We={class:"key-label"},Ie=["onClick"],Ve={class:"zigen-code"},Ne={key:0,class:"more-indicator"},qe={key:1,class:"text-xs text-gray-400 no-zigen-text"},Oe={key:0,class:"vertical-text zigen-font"},Te=v(()=>n("div",null,"å¼•å°Žç‰¹æ®Šç¬¦è™Ÿ",-1)),He=v(()=>n("div",null,"åˆ‡æ›å¤šé‡è¨»è§£",-1)),Xe=[Te,He],Ge={key:1,class:"vertical-text zigen-font"},Qe=v(()=>n("div",null,"å¼•å°Žæ‹¼éŸ³åæŸ¥",-1)),Re=v(()=>n("div",null,"å¼•å°Žæ­·å²è¼¸å…¥",-1)),Je=[Qe,Re],Ye={key:2,class:"vertical-text zigen-font"},es=v(()=>n("div",null,null,-1)),ss=v(()=>n("div",null,"ä¸€ç¢¼ä¸Šå±å­—ã€€äº†",-1)),ts=[es,ss],os={key:3,class:"vertical-text zigen-font"},ns=v(()=>n("div",null,null,-1)),ls=v(()=>n("div",null,"ä¸€ç¢¼ä¸Šå±å­—ã€€çš„",-1)),is=[ns,ls],as={key:4,class:"vertical-text zigen-font"},cs=v(()=>n("div",null,null,-1)),ds=v(()=>n("div",null,"ä¸€ç¢¼ä¸Šå±å­—ã€€æ˜¯",-1)),rs=[cs,ds],us={key:5,class:"vertical-text zigen-font"},vs=v(()=>n("div",null,null,-1)),_s=v(()=>n("div",null,"ä¸€ç¢¼ä¸Šå±å­—ã€€æˆ‘",-1)),hs=[vs,_s],fs={key:6,class:"vertical-text zigen-font"},gs=v(()=>n("div",null,null,-1)),ps=v(()=>n("div",null,"ä¸€ç¢¼ä¸Šå±å­—ã€€ä¸",-1)),ms=[gs,ps],ys={key:7,class:"vertical-text single-line zigen-font"},ks={class:"mobile-key-label"},xs={key:0,class:"mobile-zigen-container"},bs={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},zs=["onClick"],Cs={class:"zigen-code"},ws={key:1,class:"mobile-no-zigen"},$s={key:0,class:"mobile-key-desc zigen-font"},Ls={key:1,class:"mobile-key-desc zigen-font"},Ss={key:2,class:"mobile-key-desc zigen-font"},Zs={key:3,class:"mobile-key-desc"},Ms={key:4,class:"pinned-popup"},As={class:"popup-container"},Es={class:"popup-body"},Ps={class:"popup-header"},Us={class:"popup-title"},Bs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Ds={class:"zigen-header-inline current-zigen"},js={key:0,class:"example-chars-same-line"},Ks={key:1,class:"example-chars-same-line"},Fs=v(()=>n("span",{class:"loading-text"},"æ­£åœ¨åŠ è¼‰...",-1)),Ws=[Fs],Is={class:"zigen-header-inline other-zigen"},Vs={key:0,class:"example-chars-same-line"},Ns={key:1,class:"example-chars-same-line"},qs=v(()=>n("span",{class:"loading-text"},"æ­£åœ¨åŠ è¼‰...",-1)),Os=[qs],F=8,Ts=de({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(A){const B=A,D=M(()=>B.zigenFontClass||"zigen-font"),ee=re(B,"columnMinWidth"),se=M(()=>`repeat(auto-fill, minmax(${ee.value||"2rem"}, max-content))`),q=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],C=["'"],w=g(!1),y=g(!1),k=g(!1),W=()=>{w.value=window.innerWidth<1280},te=()=>{y.value=!y.value},O=()=>{k.value=!k.value};J(()=>{W(),window.addEventListener("resize",W)}),ue(()=>{window.removeEventListener("resize",W)});const T=M(()=>{const i=q.flat();return k.value?i.slice().sort((a,d)=>{const t=/^[a-zA-Z]$/.test(a),r=/^[a-zA-Z]$/.test(d);return t&&!r?-1:!t&&r?1:a.localeCompare(d)}):i}),oe=["joy","light","star","ming","wafel"];function H(i){const a=oe.includes(i);return{zigenUrl:`/zigen-${i}.csv`,chaifenUrl:a?"/chaifen.json":`/chaifen-${i}.json`}}const I=M(()=>B.defaultScheme||"star"),h=g(),E=g(),$=g(!1),L=g(new Map),j=g(0),P=g(null),S=g(null),z=g({}),U=g(!1);Y(()=>B.defaultScheme,()=>{E.value=null,L.value.clear(),j.value=0,console.log("æ–¹æ¡ˆå·²åˆ‡æ›ï¼Œå·²æ¸…é™¤ä¾‹å­—ç·©å­˜")});const V=M(()=>{var d;if(!h.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",h.value.size);const i={},a=[];for(const[t,r]of h.value){const o=r.font,c=(d=r.ma)==null?void 0:d.trim();if(!c||c.length===0||o==null)continue;const l=c[0].toLowerCase(),u=c.slice(1);a.push({font:o,ma:c,firstLetter:l,code:u})}console.log(`Found ${a.length} valid zigens`);for(let t=0;t<a.length;t++){const r=a[t],{font:o,ma:c,firstLetter:l,code:u}=r;i[l]||(i[l]={visible:[],hidden:[]});const f=t>0?a[t-1]:null,Z=f&&f.code===u&&f.firstLetter===l;i[l].visible.find(ie=>ie.code===u)?Z?i[l].hidden.push({font:o,code:u}):i[l].visible.push({font:o,code:u}):i[l].visible.push({font:o,code:u})}return console.log("Final result:",i),i}),X=M(()=>{var a;if(!h.value)return{};const i={};for(const d of T.value)i[d]=[];for(const[d,t]of h.value){const r=t.font,o=(a=t.ma)==null?void 0:a.trim();if(!o||r===null||r===void 0)continue;const c=o[0].toLowerCase(),l=o.slice(1),u=i[c].some(f=>f.code===l);i[c].push({font:r,code:l,isHidden:u})}return i}),ne=async i=>{const a=i.normalize("NFC");let d=new Set;if(L.value.has(a)&&(d=L.value.get(a),console.log(`âœ… å¾žç·©å­˜ä¸­ç²å–å­—æ ¹ "${a}" çš„ä¾‹å­— ${d.size} å€‹`),d.size>=F))return Array.from(d);if(!E.value)return console.log("chaifenLoader æœªåˆå§‹åŒ–"),[];try{console.log(`é–‹å§‹ç‚ºå­—æ ¹ "${i}(${a})" æœç´¢ä¾‹å­—, cachedCheckedCount=${j.value}...`);const t=new Promise((l,u)=>{setTimeout(()=>u(new Error("æ•¸æ“šåŠ è¼‰è¶…æ™‚")),1e4)}),r=await Promise.race([E.value.loadData(),t]),o=Object.entries(r).slice(0,3);console.log("æ•¸æ“šæ¨£æœ¬:",o);let c=0;for(const[l,u]of Object.entries(r).slice(j.value)){c++;const f=u;if(c<=5&&console.log(`å­—ç¬¦ "${l}" çš„æ‹†åˆ†æ•¸æ“š:`,f.d),f.d){for(const Z of f.d){L.value.has(Z)||L.value.set(Z,new Set);const K=L.value.get(Z);K.size<F&&K.add(l),Z===a&&(d=K,console.log(`âœ… æ‰¾åˆ°åŒ¹é…: "${l}" åŒ…å«å­—æ ¹ "${a}", æ‹†åˆ†: "${f.d}"`))}if(d.size>=F)break}c%1e3===0&&console.log(`å·²æª¢æŸ¥ ${c} å€‹å­—ç¬¦ï¼Œæ‰¾åˆ° ${d.size} å€‹ä¾‹å­—`)}return j.value+=c,console.log(`å­—æ ¹ "${a}" æœ€çµ‚æ‰¾åˆ°ä¾‹å­—:`,Array.from(d).slice(0,5),`(ç¸½å…±${d.size}å€‹)`),Array.from(d)}catch(t){return console.error("èŽ·å–ä¾‹å­—å¤±è´¥:",t),t instanceof Error&&t.message==="æ•¸æ“šåŠ è¼‰è¶…æ™‚"&&console.error("æ•¸æ“šåŠ è¼‰è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æŽ¥"),[]}};async function G(){$.value=!0;try{const i=H(I.value),a=await ae(i.zigenUrl);h.value=a,console.log("æˆ‘å°±çŸ¥é“ä½ æœƒå¿ä¸ä½æ‰“é–‹æŽ§åˆ¶è‡ºðŸ˜"),console.log(`å·²åŠ è¼‰å­—æ ¹æ•¸æ“šï¼Œæ–‡ä»¶: ${i.zigenUrl}`),console.log("æ³¨æ„ï¼šæ‹†åˆ†æ•¸æ“šå°‡åœ¨ç¬¬ä¸€æ¬¡é»žæ“Šå­—æ ¹æ™‚æ‰åŠ è¼‰")}catch(i){console.error("åŠ è¼‰å­—æ ¹æ•¸æ“šå¤±æ•—:",i)}finally{$.value=!1}}function Q(i){switch(i){case";":return"æ¬¡é¸";case",":return"é€—è™Ÿ";case".":return"å¥è™Ÿ";default:return"æ— å­—æ ¹"}}async function R(i,a){var c;if(i.stopPropagation(),!E.value){console.log("é»žæ“Šæ™‚åˆå§‹åŒ–æ‹†åˆ†æ•¸æ“šåŠ è¼‰å™¨...");const l=H(I.value);E.value=ce.getInstance(l.chaifenUrl),console.log(`å·²åˆå§‹åŒ– ChaiDataLoaderï¼Œä½¿ç”¨æ–‡ä»¶: ${l.chaifenUrl}`)}if(U.value&&P.value===a.font){N();return}P.value=a.font,U.value=!0;let d="";if(h.value){for(const[l,u]of h.value)if(u.font===a.font&&((c=u.ma)==null?void 0:c.slice(1))===a.code){d=u.ma;break}}const t=le(a.font,d);S.value=t,console.log("é–‹å§‹ç²å–ä¾‹å­—ï¼Œå­—æ ¹æ•¸é‡:",[...t.visible,...t.hidden].length);const r={},o=[...t.visible,...t.hidden];for(const l of o){console.log(`æ­£åœ¨ç²å–å­—æ ¹ "${l.font}" çš„ä¾‹å­—...`);const u=await ne(l.font);console.log(`å­—æ ¹ "${l.font}" æ‰¾åˆ°ä¾‹å­—:`,u.length,"å€‹"),r[l.font]=u.slice(0,10)}z.value=r,console.log(`å›ºå®šå½ˆçª— - å­—æ ¹ "${a.font}" çš„æœ€çµ‚ä¾‹å­—:`,z.value)}function N(){U.value=!1,P.value=null,S.value=null,z.value={}}function le(i,a){var r;const d=[],t=[];if(!h.value||!a)return{visible:d,hidden:t};for(const[o,c]of h.value){const l=c.font,u=(r=c.ma)==null?void 0:r.trim();!u||!l||l===null||l===void 0||u===a&&(l===i?d.unshift({font:l,code:u}):t.push({font:l,code:u}))}return{visible:d,hidden:t}}return Y(()=>I.value,G),J(()=>{G(),document.addEventListener("click",i=>{if(U.value){const a=document.querySelector(".pinned-popup");a&&!a.contains(i.target)&&N()}})}),(i,a)=>{var d;return e(),s("div",ge,[$.value?(e(),s("div",pe,ke)):p("",!0),$.value?p("",!0):(e(),s("div",xe,[be,w.value?p("",!0):(e(),s("div",ze,[n("div",Ce,[we,n("button",{onClick:te,class:m(["layout-toggle-btn",{"layout-toggle-active":y.value}]),title:y.value?"åˆ‡æ›ç‚ºç¶²æ ¼å¸ƒå±€":"åˆ‡æ›ç‚ºåˆ—è¡¨å¸ƒå±€"},[y.value?(e(),s("span",Se,"âŠž")):(e(),s("span",Le,"â˜°"))],10,$e)]),y.value?(e(),s("div",Ze,[Me,n("button",{onClick:O,class:m(["layout-toggle-btn",{"layout-toggle-active":k.value}]),title:k.value?"åˆ‡æ›ç‚ºéµç›¤é †åº":"åˆ‡æ›ç‚ºå­—æ¯é †åº"},[k.value?(e(),s("span",Pe,"âŒ¨ï¸")):(e(),s("span",Ee,"ðŸ”¤"))],10,Ae)])):p("",!0)])),w.value?(e(),s("div",Ue,[Be,n("button",{onClick:O,class:m(["layout-toggle-btn",{"layout-toggle-active":k.value}]),title:k.value?"åˆ‡æ›ç‚ºéµç›¤é †åº":"åˆ‡æ›ç‚ºå­—æ¯é †åº"},[k.value?(e(),s("span",Ke,"âŒ¨ï¸")):(e(),s("span",je,"ðŸ”¤"))],10,De)])):p("",!0)])),!$.value&&h.value&&!w.value&&!y.value?(e(),s("div",Fe,[(e(),s(x,null,b(q,(t,r)=>n("div",{key:r,class:"keyboard-row"},[(e(!0),s(x,null,b(t,o=>{var c;return e(),s("div",{key:o,class:m(["keyboard-key",{"empty-key":C.includes(o)}])},[n("div",We,_(o.toUpperCase()),1),!C.includes(o)&&((c=V.value[o])==null?void 0:c.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:ve({gridTemplateColumns:se.value})},[(e(!0),s(x,null,b(V.value[o].visible,(l,u)=>(e(),s("span",{key:u,class:"zigen-item",onClick:f=>R(f,l)},[n("span",{class:m(D.value)},_(l.font),3),n("span",Ve,_(l.code),1)],8,Ie))),128)),V.value[o].hidden.length>0?(e(),s("span",Ne,"â‹¯")):p("",!0)],4)):C.includes(o)?p("",!0):(e(),s("div",qe,[o==="/"?(e(),s("div",Oe,Xe)):o==="z"?(e(),s("div",Ge,Je)):o==="a"?(e(),s("div",Ye,ts)):o==="e"?(e(),s("div",os,is)):o==="i"?(e(),s("div",as,rs)):o==="o"?(e(),s("div",us,hs)):o==="u"?(e(),s("div",fs,ms)):(e(),s("div",ys,_(Q(o)),1))]))],2)}),128))])),64))])):p("",!0),!$.value&&h.value&&(w.value||y.value)?(e(),s("div",{key:3,class:m(["mobile-layout",{"desktop-list-layout":!w.value&&y.value}])},[(e(!0),s(x,null,b(T.value,t=>{var r;return e(),s("div",{key:t,class:m(["mobile-key-row",{"empty-mobile-key":C.includes(t)}])},[n("div",ks,_(t.toUpperCase()),1),!C.includes(t)&&((r=X.value[t])==null?void 0:r.length)>0?(e(),s("div",xs,[n("div",bs,[(e(!0),s(x,null,b(X.value[t],(o,c)=>(e(),s("span",{key:`sorted-${c}`,class:m(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:l=>R(l,o)},[n("span",{class:m(D.value)},_(o.font),3),n("span",Cs,_(o.code),1)],10,zs))),128))])])):C.includes(t)?p("",!0):(e(),s("div",ws,[t==="/"?(e(),s("span",$s,"å¼•å°Žç‰¹æ®Šç¬¦è™Ÿ")):t==="z"?(e(),s("span",Ls,"å¼•å°Žæ‹¼éŸ³åæŸ¥")):["a","e","i","o","u"].includes(t)?(e(),s("span",Ss," ä¸€ç¢¼ä¸Šå±å­— ")):(e(),s("span",Zs,_(Q(t)),1))]))],2)}),128))],2)):p("",!0),U.value&&P.value&&S.value?(e(),s("div",Ms,[n("div",As,[n("div",Es,[n("div",Ps,[n("h3",Us," ç·¨ç¢¼ "+_(((d=S.value.visible[0])==null?void 0:d.code)||P.value)+" ä¸Šçš„å­—æ ¹ ",1),n("button",{onClick:N,class:"close-btn"},"âœ•")]),n("div",Bs,[(e(!0),s(x,null,b(S.value.visible,(t,r)=>{var o;return e(),s("div",{key:`pinned-visible-${r}`,class:"zigen-row-inline"},[n("div",Ds,[n("span",{class:m(D.value)},_(t.font),3)]),((o=z.value[t.font])==null?void 0:o.length)>0?(e(),s("div",js,[(e(!0),s(x,null,b(z.value[t.font].slice(0,F),c=>(e(),s("span",{key:c,class:"example-char zigen-font"},_(c),1))),128))])):(e(),s("div",Ks,Ws))])}),128)),(e(!0),s(x,null,b(S.value.hidden,(t,r)=>{var o;return e(),s("div",{key:`pinned-hidden-${r}`,class:"zigen-row-inline"},[n("div",Is,[n("span",{class:m(D.value)},_(t.font),3)]),((o=z.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Vs,[(e(!0),s(x,null,b(z.value[t.font].slice(0,8),c=>(e(),s("span",{key:c,class:"example-char zigen-font"},_(c),1))),128))])):(e(),s("div",Ns,Os))])}),128))])])])])):p("",!0)])}}}),Qs=fe(Ts,[["__scopeId","data-v-a5b5fe2e"]]);export{Qs as Z};
