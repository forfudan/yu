import{f as ae}from"./share.Nrbaa2_l.js";import{C as ce}from"./ChaiDataLoader.DYi6iwdM.js";import{d as de,k as M,am as re,h as g,l as J,A as ue,y as Y,o as e,c as s,e as p,m as n,n as m,F as x,G as b,t as _,Q as ve,q as _e,s as he,_ as fe}from"./framework.rq0FYgLR.js";const v=A=>(_e("data-v-a5b5fe2e"),A=A(),he(),A),ge={class:"zigen-map-container"},pe={key:0,class:"flex justify-center items-center py-8"},me=v(()=>n("div",{class:"loading loading-spinner loading-lg"},null,-1)),ye=v(()=>n("span",{class:"ml-2"},"正在加載字根數據...",-1)),ke=[me,ye],xe={key:1,class:"flex justify-between items-center mb-4"},be=v(()=>n("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),ze={key:0,class:"flex items-center space-x-4"},Ce={class:"flex items-center space-x-2"},we=v(()=>n("span",{class:"text-xs text-gray-400"},"切換字根圖和字根表：",-1)),$e=["title"],Le={key:0},Se={key:1},Ze={key:0,class:"flex items-center space-x-2"},Me=v(()=>n("span",{class:"text-xs text-gray-400"},"按鍵排序：",-1)),Ae=["title"],Ee={key:0},Pe={key:1},Ue={key:1,class:"flex items-center space-x-2"},Be=v(()=>n("span",{class:"text-xs text-gray-400"},"按鍵排序：",-1)),De=["title"],je={key:0},Ke={key:1},Fe={key:2,class:"keyboard-layout"},We={class:"key-label"},Ie=["onClick"],Ve={class:"zigen-code"},Ne={key:0,class:"more-indicator"},qe={key:1,class:"text-xs text-gray-400 no-zigen-text"},Oe={key:0,class:"vertical-text zigen-font"},Te=v(()=>n("div",null,"引導特殊符號",-1)),He=v(()=>n("div",null,"切換多重註解",-1)),Xe=[Te,He],Ge={key:1,class:"vertical-text zigen-font"},Qe=v(()=>n("div",null,"引導拼音反查",-1)),Re=v(()=>n("div",null,"引導歷史輸入",-1)),Je=[Qe,Re],Ye={key:2,class:"vertical-text zigen-font"},es=v(()=>n("div",null,null,-1)),ss=v(()=>n("div",null,"一碼上屏字　了",-1)),ts=[es,ss],os={key:3,class:"vertical-text zigen-font"},ns=v(()=>n("div",null,null,-1)),ls=v(()=>n("div",null,"一碼上屏字　的",-1)),is=[ns,ls],as={key:4,class:"vertical-text zigen-font"},cs=v(()=>n("div",null,null,-1)),ds=v(()=>n("div",null,"一碼上屏字　是",-1)),rs=[cs,ds],us={key:5,class:"vertical-text zigen-font"},vs=v(()=>n("div",null,null,-1)),_s=v(()=>n("div",null,"一碼上屏字　我",-1)),hs=[vs,_s],fs={key:6,class:"vertical-text zigen-font"},gs=v(()=>n("div",null,null,-1)),ps=v(()=>n("div",null,"一碼上屏字　不",-1)),ms=[gs,ps],ys={key:7,class:"vertical-text single-line zigen-font"},ks={class:"mobile-key-label"},xs={key:0,class:"mobile-zigen-container"},bs={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},zs=["onClick"],Cs={class:"zigen-code"},ws={key:1,class:"mobile-no-zigen"},$s={key:0,class:"mobile-key-desc zigen-font"},Ls={key:1,class:"mobile-key-desc zigen-font"},Ss={key:2,class:"mobile-key-desc zigen-font"},Zs={key:3,class:"mobile-key-desc"},Ms={key:4,class:"pinned-popup"},As={class:"popup-container"},Es={class:"popup-body"},Ps={class:"popup-header"},Us={class:"popup-title"},Bs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Ds={class:"zigen-header-inline current-zigen"},js={key:0,class:"example-chars-same-line"},Ks={key:1,class:"example-chars-same-line"},Fs=v(()=>n("span",{class:"loading-text"},"正在加載...",-1)),Ws=[Fs],Is={class:"zigen-header-inline other-zigen"},Vs={key:0,class:"example-chars-same-line"},Ns={key:1,class:"example-chars-same-line"},qs=v(()=>n("span",{class:"loading-text"},"正在加載...",-1)),Os=[qs],F=8,Ts=de({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(A){const B=A,D=M(()=>B.zigenFontClass||"zigen-font"),ee=re(B,"columnMinWidth"),se=M(()=>`repeat(auto-fill, minmax(${ee.value||"2rem"}, max-content))`),q=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],C=["'"],w=g(!1),y=g(!1),k=g(!1),W=()=>{w.value=window.innerWidth<1280},te=()=>{y.value=!y.value},O=()=>{k.value=!k.value};J(()=>{W(),window.addEventListener("resize",W)}),ue(()=>{window.removeEventListener("resize",W)});const T=M(()=>{const i=q.flat();return k.value?i.slice().sort((a,d)=>{const t=/^[a-zA-Z]$/.test(a),r=/^[a-zA-Z]$/.test(d);return t&&!r?-1:!t&&r?1:a.localeCompare(d)}):i}),oe=["joy","light","star","ming","wafel"];function H(i){const a=oe.includes(i);return{zigenUrl:`/zigen-${i}.csv`,chaifenUrl:a?"/chaifen.json":`/chaifen-${i}.json`}}const I=M(()=>B.defaultScheme||"star"),h=g(),E=g(),$=g(!1),L=g(new Map),j=g(0),P=g(null),S=g(null),z=g({}),U=g(!1);Y(()=>B.defaultScheme,()=>{E.value=null,L.value.clear(),j.value=0,console.log("方案已切換，已清除例字緩存")});const V=M(()=>{var d;if(!h.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",h.value.size);const i={},a=[];for(const[t,r]of h.value){const o=r.font,c=(d=r.ma)==null?void 0:d.trim();if(!c||c.length===0||o==null)continue;const l=c[0].toLowerCase(),u=c.slice(1);a.push({font:o,ma:c,firstLetter:l,code:u})}console.log(`Found ${a.length} valid zigens`);for(let t=0;t<a.length;t++){const r=a[t],{font:o,ma:c,firstLetter:l,code:u}=r;i[l]||(i[l]={visible:[],hidden:[]});const f=t>0?a[t-1]:null,Z=f&&f.code===u&&f.firstLetter===l;i[l].visible.find(ie=>ie.code===u)?Z?i[l].hidden.push({font:o,code:u}):i[l].visible.push({font:o,code:u}):i[l].visible.push({font:o,code:u})}return console.log("Final result:",i),i}),X=M(()=>{var a;if(!h.value)return{};const i={};for(const d of T.value)i[d]=[];for(const[d,t]of h.value){const r=t.font,o=(a=t.ma)==null?void 0:a.trim();if(!o||r===null||r===void 0)continue;const c=o[0].toLowerCase(),l=o.slice(1),u=i[c].some(f=>f.code===l);i[c].push({font:r,code:l,isHidden:u})}return i}),ne=async i=>{const a=i.normalize("NFC");let d=new Set;if(L.value.has(a)&&(d=L.value.get(a),console.log(`✅ 從緩存中獲取字根 "${a}" 的例字 ${d.size} 個`),d.size>=F))return Array.from(d);if(!E.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${i}(${a})" 搜索例字, cachedCheckedCount=${j.value}...`);const t=new Promise((l,u)=>{setTimeout(()=>u(new Error("數據加載超時")),1e4)}),r=await Promise.race([E.value.loadData(),t]),o=Object.entries(r).slice(0,3);console.log("數據樣本:",o);let c=0;for(const[l,u]of Object.entries(r).slice(j.value)){c++;const f=u;if(c<=5&&console.log(`字符 "${l}" 的拆分數據:`,f.d),f.d){for(const Z of f.d){L.value.has(Z)||L.value.set(Z,new Set);const K=L.value.get(Z);K.size<F&&K.add(l),Z===a&&(d=K,console.log(`✅ 找到匹配: "${l}" 包含字根 "${a}", 拆分: "${f.d}"`))}if(d.size>=F)break}c%1e3===0&&console.log(`已檢查 ${c} 個字符，找到 ${d.size} 個例字`)}return j.value+=c,console.log(`字根 "${a}" 最終找到例字:`,Array.from(d).slice(0,5),`(總共${d.size}個)`),Array.from(d)}catch(t){return console.error("获取例字失败:",t),t instanceof Error&&t.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function G(){$.value=!0;try{const i=H(I.value),a=await ae(i.zigenUrl);h.value=a,console.log("我就知道你會忍不住打開控制臺😏"),console.log(`已加載字根數據，文件: ${i.zigenUrl}`),console.log("注意：拆分數據將在第一次點擊字根時才加載")}catch(i){console.error("加載字根數據失敗:",i)}finally{$.value=!1}}function Q(i){switch(i){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function R(i,a){var c;if(i.stopPropagation(),!E.value){console.log("點擊時初始化拆分數據加載器...");const l=H(I.value);E.value=ce.getInstance(l.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${l.chaifenUrl}`)}if(U.value&&P.value===a.font){N();return}P.value=a.font,U.value=!0;let d="";if(h.value){for(const[l,u]of h.value)if(u.font===a.font&&((c=u.ma)==null?void 0:c.slice(1))===a.code){d=u.ma;break}}const t=le(a.font,d);S.value=t,console.log("開始獲取例字，字根數量:",[...t.visible,...t.hidden].length);const r={},o=[...t.visible,...t.hidden];for(const l of o){console.log(`正在獲取字根 "${l.font}" 的例字...`);const u=await ne(l.font);console.log(`字根 "${l.font}" 找到例字:`,u.length,"個"),r[l.font]=u.slice(0,10)}z.value=r,console.log(`固定彈窗 - 字根 "${a.font}" 的最終例字:`,z.value)}function N(){U.value=!1,P.value=null,S.value=null,z.value={}}function le(i,a){var r;const d=[],t=[];if(!h.value||!a)return{visible:d,hidden:t};for(const[o,c]of h.value){const l=c.font,u=(r=c.ma)==null?void 0:r.trim();!u||!l||l===null||l===void 0||u===a&&(l===i?d.unshift({font:l,code:u}):t.push({font:l,code:u}))}return{visible:d,hidden:t}}return Y(()=>I.value,G),J(()=>{G(),document.addEventListener("click",i=>{if(U.value){const a=document.querySelector(".pinned-popup");a&&!a.contains(i.target)&&N()}})}),(i,a)=>{var d;return e(),s("div",ge,[$.value?(e(),s("div",pe,ke)):p("",!0),$.value?p("",!0):(e(),s("div",xe,[be,w.value?p("",!0):(e(),s("div",ze,[n("div",Ce,[we,n("button",{onClick:te,class:m(["layout-toggle-btn",{"layout-toggle-active":y.value}]),title:y.value?"切換為網格布局":"切換為列表布局"},[y.value?(e(),s("span",Se,"⊞")):(e(),s("span",Le,"☰"))],10,$e)]),y.value?(e(),s("div",Ze,[Me,n("button",{onClick:O,class:m(["layout-toggle-btn",{"layout-toggle-active":k.value}]),title:k.value?"切換為鍵盤順序":"切換為字母順序"},[k.value?(e(),s("span",Pe,"⌨️")):(e(),s("span",Ee,"🔤"))],10,Ae)])):p("",!0)])),w.value?(e(),s("div",Ue,[Be,n("button",{onClick:O,class:m(["layout-toggle-btn",{"layout-toggle-active":k.value}]),title:k.value?"切換為鍵盤順序":"切換為字母順序"},[k.value?(e(),s("span",Ke,"⌨️")):(e(),s("span",je,"🔤"))],10,De)])):p("",!0)])),!$.value&&h.value&&!w.value&&!y.value?(e(),s("div",Fe,[(e(),s(x,null,b(q,(t,r)=>n("div",{key:r,class:"keyboard-row"},[(e(!0),s(x,null,b(t,o=>{var c;return e(),s("div",{key:o,class:m(["keyboard-key",{"empty-key":C.includes(o)}])},[n("div",We,_(o.toUpperCase()),1),!C.includes(o)&&((c=V.value[o])==null?void 0:c.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:ve({gridTemplateColumns:se.value})},[(e(!0),s(x,null,b(V.value[o].visible,(l,u)=>(e(),s("span",{key:u,class:"zigen-item",onClick:f=>R(f,l)},[n("span",{class:m(D.value)},_(l.font),3),n("span",Ve,_(l.code),1)],8,Ie))),128)),V.value[o].hidden.length>0?(e(),s("span",Ne,"⋯")):p("",!0)],4)):C.includes(o)?p("",!0):(e(),s("div",qe,[o==="/"?(e(),s("div",Oe,Xe)):o==="z"?(e(),s("div",Ge,Je)):o==="a"?(e(),s("div",Ye,ts)):o==="e"?(e(),s("div",os,is)):o==="i"?(e(),s("div",as,rs)):o==="o"?(e(),s("div",us,hs)):o==="u"?(e(),s("div",fs,ms)):(e(),s("div",ys,_(Q(o)),1))]))],2)}),128))])),64))])):p("",!0),!$.value&&h.value&&(w.value||y.value)?(e(),s("div",{key:3,class:m(["mobile-layout",{"desktop-list-layout":!w.value&&y.value}])},[(e(!0),s(x,null,b(T.value,t=>{var r;return e(),s("div",{key:t,class:m(["mobile-key-row",{"empty-mobile-key":C.includes(t)}])},[n("div",ks,_(t.toUpperCase()),1),!C.includes(t)&&((r=X.value[t])==null?void 0:r.length)>0?(e(),s("div",xs,[n("div",bs,[(e(!0),s(x,null,b(X.value[t],(o,c)=>(e(),s("span",{key:`sorted-${c}`,class:m(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:l=>R(l,o)},[n("span",{class:m(D.value)},_(o.font),3),n("span",Cs,_(o.code),1)],10,zs))),128))])])):C.includes(t)?p("",!0):(e(),s("div",ws,[t==="/"?(e(),s("span",$s,"引導特殊符號")):t==="z"?(e(),s("span",Ls,"引導拼音反查")):["a","e","i","o","u"].includes(t)?(e(),s("span",Ss," 一碼上屏字 ")):(e(),s("span",Zs,_(Q(t)),1))]))],2)}),128))],2)):p("",!0),U.value&&P.value&&S.value?(e(),s("div",Ms,[n("div",As,[n("div",Es,[n("div",Ps,[n("h3",Us," 編碼 "+_(((d=S.value.visible[0])==null?void 0:d.code)||P.value)+" 上的字根 ",1),n("button",{onClick:N,class:"close-btn"},"✕")]),n("div",Bs,[(e(!0),s(x,null,b(S.value.visible,(t,r)=>{var o;return e(),s("div",{key:`pinned-visible-${r}`,class:"zigen-row-inline"},[n("div",Ds,[n("span",{class:m(D.value)},_(t.font),3)]),((o=z.value[t.font])==null?void 0:o.length)>0?(e(),s("div",js,[(e(!0),s(x,null,b(z.value[t.font].slice(0,F),c=>(e(),s("span",{key:c,class:"example-char zigen-font"},_(c),1))),128))])):(e(),s("div",Ks,Ws))])}),128)),(e(!0),s(x,null,b(S.value.hidden,(t,r)=>{var o;return e(),s("div",{key:`pinned-hidden-${r}`,class:"zigen-row-inline"},[n("div",Is,[n("span",{class:m(D.value)},_(t.font),3)]),((o=z.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Vs,[(e(!0),s(x,null,b(z.value[t.font].slice(0,8),c=>(e(),s("span",{key:c,class:"example-char zigen-font"},_(c),1))),128))])):(e(),s("div",Ns,Os))])}),128))])])])])):p("",!0)])}}}),Qs=fe(Ts,[["__scopeId","data-v-a5b5fe2e"]]);export{Qs as Z};
