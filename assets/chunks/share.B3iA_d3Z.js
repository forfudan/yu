var st=Object.defineProperty;var nt=(i,t,s)=>t in i?st(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var b=(i,t,s)=>nt(i,typeof t!="symbol"?t+"":t,s);import{g as ot}from"./framework.72Ik0KeM.js";const k=class k{constructor(t){b(this,"data",null);b(this,"loading",null);b(this,"dataUrl");b(this,"pakoLoaded",!1);this.dataUrl=t}async loadPako(){if(window.pako||this.pakoLoaded)return window.pako;try{const t=document.createElement("script");return t.src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js",t.crossOrigin="anonymous",await new Promise((s,e)=>{t.onload=s,t.onerror=e,document.head.appendChild(t)}),this.pakoLoaded=!0,window.pako}catch(t){return console.warn("Failed to load pako library:",t),null}}static getInstance(t="/chaifen.json"){return k.instances.has(t)||k.instances.set(t,new k(t)),k.instances.get(t)}async loadData(){return this.data?this.data:this.loading?this.loading:(this.loading=this.fetchOptimizedData(),this.data=await this.loading,this.loading=null,this.data)}async fetchOptimizedData(){const t=performance.now(),e=[{url:this.dataUrl.replace(".csv",".json"),compressed:!0},{url:this.dataUrl,compressed:!1,csv:!0}];for(const o of e)try{const r=await fetch(o.url,{headers:{Accept:"application/json, text/csv, */*","Accept-Charset":"utf-8"}});if(!r.ok)continue;let n;if(o.csv){const f=await r.arrayBuffer(),l=new TextDecoder("utf-8").decode(f);n=this.parseCsvToOptimized(l)}else if(o.compressed){const f=await r.arrayBuffer(),l=await this.decompressGzip(f),d=new TextDecoder("utf-8").decode(l);n=JSON.parse(d)}else{const f=await r.arrayBuffer(),l=new TextDecoder("utf-8").decode(f);n=JSON.parse(l)}const c=performance.now()-t;return console.log(`ğŸ“Š Loaded ${o.url} in ${c.toFixed(2)}ms`),console.log(`ğŸ“¦ Data contains ${Object.keys(n).length} characters`),n}catch(r){console.warn(`Failed to load ${o.url}:`,r);continue}throw new Error("Failed to load chaifen data from any source")}parseCsvToOptimized(t){const s=t.split(`
`),e={};for(let o=1;o<s.length;o++){const r=s[o].trim();if(!r)continue;const[n,c,f,l]=r.split(",");if(n){const d={};c&&(d.d=c),f&&(d.dt=f),l&&(d.r=l),e[n]=d}}return e}search(t){var o,r;if(!this.data)return console.warn("Data not loaded yet"),[];const s=[],e=t.toLowerCase();if(t.length===1&&this.data[t]){const n=this.data[t];s.push({char:t,division:n.d,division_tw:n.dt,region:n.r})}for(const[n,c]of Object.entries(this.data))(n.includes(e)||(o=c.d)!=null&&o.toLowerCase().includes(e)||(r=c.dt)!=null&&r.toLowerCase().includes(e))&&s.push({char:n,division:c.d,division_tw:c.dt,region:c.r});return s}getChar(t){if(!this.data||!this.data[t])return null;const s=this.data[t];return{char:t,division:s.d,division_tw:s.dt,region:s.r}}async decompressGzip(t){try{const s=await this.loadPako();if(s){console.log("ğŸ“¦ Using pako for gzip decompression");const d=new Uint8Array(t);return s.inflate(d).buffer}if(console.log("ğŸŒ Using browser DecompressionStream for gzip decompression"),typeof DecompressionStream>"u")throw new Error("DecompressionStream not supported and pako not available");const o=new ReadableStream({start(d){d.enqueue(new Uint8Array(t)),d.close()}}).pipeThrough(new DecompressionStream("gzip")),r=[],n=o.getReader();for(;;){const{done:d,value:y}=await n.read();if(d)break;r.push(y)}const c=r.reduce((d,y)=>d+y.length,0),f=new Uint8Array(c);let l=0;for(const d of r)f.set(d,l),l+=d.length;return f.buffer}catch(s){throw console.error("Failed to decompress gzip data:",s),new Error(`Gzip decompression failed: ${s.message}`)}}};b(k,"instances",new Map);let A=k,C={};function ct(i,t,s){var f,l,d,y,T,B,E,F,I,J,N,V,G,P,R,Y,K,_;const e=[...i],o=s==="star"||s==="light",r=s==="ming",n=s==="wafel";if(s==="ling"){const a=e.length,h=e[0],S=e[1]||"",j=e[2]||"",m=e[a-1],v=u=>{var q;return((q=t.get(u))==null?void 0:q.ma)||""},D=v(h),L=v(m),H=u=>u.length===2,O=u=>u[0]||"",Q=u=>u.length===3?u[1]:"",W=u=>u[u.length-1]||"",tt=H(D),Z=H(L),g=O(D),$=Q(D),X=W(D),x=O(v(S)),et=O(v(j)),w=O(L),z=Q(L),U=W(L);let p="";return tt?a===1?p=g+X:a===2?Z?p=g+w+U:p=g+w+z+U:a===3?Z?p=g+x+w+U:p=g+x+w+z:p=g+x+et+w:a===1?p=g+$+X:a===2?Z?p=g+$+w+U:p=g+$+w+z:p=g+$+x+w,p}else if(r){let a=[];const h=e[0],S=e[e.length-1];e.length==1?a.push((((l=(f=t.get(h))==null?void 0:f.ma)==null?void 0:l[0])||"?").toUpperCase()):a.push((((y=(d=t.get(h))==null?void 0:d.ma)==null?void 0:y.slice(0,-1))||"?").toUpperCase()),a.push(...e.slice(1).map(m=>{var v,D;return(((D=(v=t.get(m))==null?void 0:v.ma)==null?void 0:D[0])||"?").toUpperCase()}));const j=m=>m.length===2?m[0].toUpperCase()+m[1]:m;return a.push(j(((B=(T=t.get(S))==null?void 0:T.ma)==null?void 0:B.slice(1))||"?")),a.join("").slice(0,5)}else if(n){let a=[];if(e.length>=1&&a.push(((F=(E=t.get(e[0]))==null?void 0:E.ma)==null?void 0:F[0])||"?"),e.length>=2&&a.push(((J=(I=t.get(e[1]))==null?void 0:I.ma)==null?void 0:J[0])||"?"),e.length>=3){const h=e[e.length-1];a.push(((V=(N=t.get(h))==null?void 0:N.ma)==null?void 0:V[0])||"?")}if(a.length<3){const h=e[e.length-1];a.push(((P=(G=t.get(h))==null?void 0:G.ma)==null?void 0:P[1])||"?")}return a.join("")}else{let a=e.map(h=>{var S,j;return((j=(S=t.get(h))==null?void 0:S.ma)==null?void 0:j[0])||"?"});if(a.length<4){const h=e[e.length-1];a.push(((Y=(R=t.get(h))==null?void 0:R.ma)==null?void 0:Y[1])||"?")}if(a.length<4&&o){const h=e[0];a.push(((_=(K=t.get(h))==null?void 0:K.ma)==null?void 0:_[1])||"?")}return a.join("")}}async function M(i){if(i in C)return C[i];try{const s=await(await fetch(ot(i))).text(),e=at(s);return C[i]=e,e}catch(t){throw t instanceof Error&&alert(`ç„¡æ³•ä¸‹è¼‰æˆ–è§£æã€Š${i}ã€‹æ–‡ä»¶ï¼š${t.cause}`),t}}function at(i){const t=i.split(`
`),e=t.shift().split(",").map(n=>n.trim()),o=e.length,r=new Map;for(let n of t){if(n=n.trim(),!n)continue;const c=n.split(",").map(l=>l.trim());if(c.length<o)for(;c.length<o;)c.push("");else if(c.length>o)throw new Error(`CSVæ–‡ä»¶ä¸­ ${n} æ•¸æ“šéå¤šï¼ŒæœŸæœ› ${o} åˆ—ï¼Œå®é™… ${c.length} åˆ—ã€‚`);const f={};for(let l=0;l<o;l++)f[e[l]]=c[l]||"";r.set(c[0],f)}return r}async function lt(i){return await M(i)}async function dt(i){const t=`optimized_${i}`;if(t in C)return C[t];try{const e=await A.getInstance(i).loadData(),o=new Map;for(const[r,n]of Object.entries(e))o.set(r,{char:r,division:n.d||"",division_tw:n.dt||"",region:n.r||""});return console.log(`âœ… æˆåŠŸä½¿ç”¨å£“ç¸®JSONæ ¼å¼åŠ è¼‰æ‹†åˆ†æ•¸æ“š: ${o.size} ä¸ªå­—ç¬¦`),C[t]=o,o}catch(s){console.warn("JSONæ ¼å¼åŠ è¼‰å¤±æ•—ï¼Œå›é€€åˆ°CSVæ ¼å¼:",s);try{const e=await M(i);return console.log(`âš ï¸ ä½¿ç”¨CSVæ ¼å¼åŠ è¼‰æ‹†åˆ†æ•¸æ“š: ${e.size} å€‹å­—ç¬¦`),C[t]=e,e}catch(e){throw console.error("CSVæ ¼å¼ä¹ŸåŠ è¼‰å¤±æ•—:",e),e}}}export{A as C,lt as a,dt as b,C as c,M as f,ct as m};
