import{d as b,E as r,k as C,v as h,l as I,c,o as i,m as o,e as k,b as V,a3 as $,a4 as E,a as L,t as x}from"./framework.D5VGNaZP.js";import{_ as S}from"./Search.vue_vue_type_script_setup_true_lang.BNwft3ZV.js";import{f as T}from"./share.D5aqWrzv.js";import{C as F}from"./ChaiDataLoader.DswD24L6.js";const N={class:"input input-bordered bg-gray-100 dark:bg-slate-800 flex items-center gap-2 mt-2"},Z={key:0,class:"text-gray-600 text-center py-4"},j={key:1,class:"alert alert-error mt-2"},O={key:3,class:"opacity-40 text-center p-9 tracking-widest"},P={key:4,class:"text-gray-500 text-center py-4"},H=b({__name:"OptimizedFetchSearch",props:{chaifenUrl:{},zigenUrl:{},supplement:{type:Boolean},ming:{type:Boolean},modelValue:{}},emits:["update:modelValue"],setup(M,{emit:_}){const l=M,z=_,m=r(),p=r(),n=r(!1),s=r(!1),t=r(l.modelValue||""),d=r(null),y=["小樓一夜聽春雨　深巷明朝賣杏花","休對故人思故國　且將新火試新茶","三十功名塵與土　八千里路雲和月","落花人獨立　微雨燕雙飛","玲瓏骰子安紅豆　入骨相思知不知","兩情若是久長時　又豈在朝朝暮暮","身無彩鳳雙飛翼　心有靈犀一點通","自在飛花輕似夢　無邊絲雨細如愁","醉後不知天在水　滿船清夢壓星河","東風夜放花千樹　更吹落　星如雨","鳳蕭聲動　玉壸光轉　一夜魚龍舞","爲君持酒勸斜陽　且向花間留晚照","綠楊煙外曉寒輕　紅杏枝頭春意鬧","城中桃李愁風雨　春在溪頭薺菜花","未是秋光奇绝　看十五十六","無可奈何花落去　似曾相識燕歸來","但願人長久　千里共嬋娟","大江東去　浪淘盡千古風流人物","明月幾時有　把酒問青天","一蓑煙雨任平生　也無風雨也無晴","縱豆蔻詞工　青樓夢好　難賦深情","衣帶漸寬終不悔　為伊消得人憔悴"],D=C(()=>{const a=Math.floor(Math.random()*y.length);return y[a]});h(()=>l.modelValue,a=>{a!==void 0&&a!==t.value&&(t.value=a,a.trim().length>0&&!s.value&&v())},{immediate:!0}),h(t,a=>{z("update:modelValue",a),a.trim().length>0&&!s.value&&v()}),h([s,t],([a,e])=>{a&&e&&e.trim().length>0&&console.log(`🔍 Data loaded, ready to search for: "${e}"`)});const B=F.getInstance(l.chaifenUrl);async function v(){if(s.value||n.value)return;n.value=!0,d.value=null;const a=performance.now();try{const[e,u]=await Promise.all([B.loadData(),T(l.zigenUrl)]),g=new Map;for(const[w,f]of Object.entries(e))g.set(w,{char:w,division:f.d||"",division_tw:f.dt||"",region:f.r||""});m.value=g,p.value=u,s.value=!0;const U=performance.now()-a;console.log(`🚀 Search data loaded in ${U.toFixed(2)}ms`),console.log(`📦 Characters: ${g.size}`),console.log(`📁 Source: ${l.chaifenUrl}`)}catch(e){console.error("Failed to load search data:",e),d.value=e instanceof Error?e.message:"Unknown error"}finally{n.value=!1}}return I(()=>{t.value.trim().length>0&&v()}),(a,e)=>(i(),c("div",null,[o("label",N,[$(o("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>t.value=u),type:"text",class:"grow",placeholder:"輸入漢字查詢拆分和編碼"},null,512),[[E,t.value]]),e[2]||(e[2]=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"h-4 w-4 opacity-70"},[o("path",{"fill-rule":"evenodd",d:"M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z","clip-rule":"evenodd"})],-1))]),n.value?(i(),c("div",Z,[...e[3]||(e[3]=[o("div",{class:"loading loading-spinner loading-sm mr-2"},null,-1),L(" 正在加载拆分数据…… ",-1)])])):d.value?(i(),c("div",j,[e[4]||(e[4]=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),o("span",null,"加载失败："+x(d.value),1)])):k("",!0),s.value&&m.value&&p.value?(i(),V(S,{key:2,chaifenMap:m.value,zigenMap:p.value,supplement:l.supplement,ming:l.ming||!1,userInput:t.value,"onUpdate:userInput":e[1]||(e[1]=u=>t.value=u)},null,8,["chaifenMap","zigenMap","supplement","ming","userInput"])):!t.value.trim()&&!n.value&&!d.value?(i(),c("div",O,x(D.value),1)):t.value.trim().length>0&&!n.value?(i(),c("div",P," 开始输入以查看拆分…… ")):k("",!0)]))}});export{H as _};
