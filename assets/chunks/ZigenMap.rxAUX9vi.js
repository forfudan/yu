import{f as he}from"./share.Nrbaa2_l.js";import{C as ne}from"./ChaiDataLoader.DYi6iwdM.js";import{d as _e,k as U,am as fe,h as _,l as te,A as pe,y as oe,o as e,c as s,e as k,m as l,n as y,F as p,G as g,Q as le,t as h,q as ge,s as me,_ as ye}from"./framework.rq0FYgLR.js";const v=D=>(ge("data-v-1fe4b88e"),D=D(),me(),D),xe={class:"zigen-map-container"},ke={key:0,class:"flex justify-center items-center py-8"},be=v(()=>l("div",{class:"loading loading-spinner loading-lg"},null,-1)),ze=v(()=>l("span",{class:"ml-2"},"正在加载字根数据...",-1)),Ce=[be,ze],we={key:1,class:"flex justify-between items-center mb-4"},$e=v(()=>l("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),Ze={key:0,class:"flex items-center space-x-2"},Le=v(()=>l("span",{class:"text-xs text-gray-400"},"切換字根圖和字根表：",-1)),Se=["title"],Me={key:0},Ee={key:1},Pe={key:2,class:"keyboard-layout"},Ue={class:"key-label"},De=["onMouseenter","onClick"],je={class:"zigen-code"},Ae={key:0,class:"more-indicator"},Be={key:1,class:"text-xs text-gray-400 no-zigen-text"},Fe={key:0,class:"vertical-text zigen-font"},Ie=v(()=>l("div",null,"引導特殊符號",-1)),Ke=v(()=>l("div",null,"切換多重註解",-1)),We=[Ie,Ke],Ve={key:1,class:"vertical-text zigen-font"},Ne=v(()=>l("div",null,"引導拼音反查",-1)),qe=v(()=>l("div",null,"引導歷史輸入",-1)),He=[Ne,qe],Te={key:2,class:"vertical-text zigen-font"},Xe=v(()=>l("div",null,null,-1)),Oe=v(()=>l("div",null,"一碼上屏字　了",-1)),Ge=[Xe,Oe],Qe={key:3,class:"vertical-text zigen-font"},Re=v(()=>l("div",null,null,-1)),Ye=v(()=>l("div",null,"一碼上屏字　的",-1)),Je=[Re,Ye],es={key:4,class:"vertical-text zigen-font"},ss=v(()=>l("div",null,null,-1)),ns=v(()=>l("div",null,"一碼上屏字　是",-1)),ts=[ss,ns],os={key:5,class:"vertical-text zigen-font"},ls=v(()=>l("div",null,null,-1)),is=v(()=>l("div",null,"一碼上屏字　我",-1)),as=[ls,is],cs={key:6,class:"vertical-text zigen-font"},ds=v(()=>l("div",null,null,-1)),us=v(()=>l("div",null,"一碼上屏字　不",-1)),rs=[ds,us],vs={key:7,class:"vertical-text single-line zigen-font"},hs={class:"mobile-key-label"},_s={key:0,class:"mobile-zigen-container"},fs={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},ps=["onClick"],gs={class:"zigen-code"},ms={key:1,class:"mobile-no-zigen"},ys={key:0,class:"mobile-key-desc zigen-font"},xs={key:1,class:"mobile-key-desc zigen-font"},ks={key:2,class:"mobile-key-desc zigen-font"},bs={key:3,class:"mobile-key-desc"},zs={class:"popup-container"},Cs={class:"popup-body"},ws={class:"popup-title"},$s={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Zs={class:"zigen-header-inline current-zigen"},Ls={key:0,class:"example-chars-same-line"},Ss={key:1,class:"example-chars-same-line"},Ms=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Es=[Ms],Ps={class:"zigen-header-inline other-zigen"},Us={key:0,class:"example-chars-same-line"},Ds={key:1,class:"example-chars-same-line"},js=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),As=[js],Bs={key:5,class:"pinned-popup"},Fs={class:"popup-container"},Is={class:"popup-body"},Ks={class:"popup-header"},Ws={class:"popup-title"},Vs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Ns={class:"zigen-header-inline current-zigen"},qs={key:0,class:"example-chars-same-line"},Hs={key:1,class:"example-chars-same-line"},Ts=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Xs=[Ts],Os={class:"zigen-header-inline other-zigen"},Gs={key:0,class:"example-chars-same-line"},Qs={key:1,class:"example-chars-same-line"},Rs=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ys=[Rs],F=8,Js=_e({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(D){const I=D,Z=U(()=>I.zigenFontClass||"zigen-font"),ie=fe(I,"columnMinWidth"),ae=U(()=>`repeat(auto-fill, minmax(${ie.value||"2rem"}, max-content))`),O=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],L=["'"],j=_(!1),b=_(!1),N=()=>{j.value=window.innerWidth<1280},ce=()=>{b.value=!b.value};te(()=>{N(),window.addEventListener("resize",N)}),pe(()=>{window.removeEventListener("resize",N)});const G=U(()=>O.flat()),de=["joy","light","star","ming","wafel"];function q(c){const i=de.includes(c);return{zigenUrl:`/zigen-${c}.csv`,chaifenUrl:i?"/chaifen.json":`/chaifen-${c}.json`}}const K=U(()=>I.defaultScheme||"star"),f=_(),z=_(),S=_(!1),A=_(null),C=_(null),H=_({x:0,y:0}),w=_({}),M=_(new Map),W=_(0),B=_(null),E=_(null),$=_({}),P=_(!1);oe(()=>I.defaultScheme,()=>{z.value=null,M.value.clear(),W.value=0,console.log("方案已切換，已清除例字緩存")});const T=U(()=>{var r;if(!f.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",f.value.size);const c={},i=[];for(const[d,o]of f.value){const u=o.font,t=(r=o.ma)==null?void 0:r.trim();if(!t||t.length===0||u==null)continue;const n=t[0].toLowerCase(),a=t.slice(1);i.push({font:u,ma:t,firstLetter:n,code:a})}console.log(`Found ${i.length} valid zigens`);for(let d=0;d<i.length;d++){const o=i[d],{font:u,ma:t,firstLetter:n,code:a}=o;c[n]||(c[n]={visible:[],hidden:[]});const m=d>0?i[d-1]:null,x=m&&m.code===a&&m.firstLetter===n;c[n].visible.find(ve=>ve.code===a)?x?c[n].hidden.push({font:u,code:a}):c[n].visible.push({font:u,code:a}):c[n].visible.push({font:u,code:a})}return console.log("Final result:",c),c}),Q=U(()=>{var i;if(!f.value)return{};const c={};for(const r of G.value)c[r]=[];for(const[r,d]of f.value){const o=d.font,u=(i=d.ma)==null?void 0:i.trim();if(!u||o===null||o===void 0)continue;const t=u[0].toLowerCase(),n=u.slice(1),a=c[t].some(m=>m.code===n);c[t].push({font:o,code:n,isHidden:a})}return c}),R=async c=>{const i=c.normalize("NFC");let r=new Set;if(M.value.has(i)&&(r=M.value.get(i),console.log(`✅ 從緩存中獲取字根 "${i}" 的例字 ${r.size} 個`),r.size>=F))return Array.from(r);if(!z.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${c}(${i})" 搜索例字, cachedCheckedCount=${W.value}...`);const d=new Promise((n,a)=>{setTimeout(()=>a(new Error("數據加載超時")),1e4)}),o=await Promise.race([z.value.loadData(),d]),u=Object.entries(o).slice(0,3);console.log("數據樣本:",u);let t=0;for(const[n,a]of Object.entries(o).slice(W.value)){t++;const m=a;if(t<=5&&console.log(`字符 "${n}" 的拆分數據:`,m.d),m.d){for(const x of m.d){M.value.has(x)||M.value.set(x,new Set);const V=M.value.get(x);V.size<F&&V.add(n),x===i&&(r=V,console.log(`✅ 找到匹配: "${n}" 包含字根 "${i}", 拆分: "${m.d}"`))}if(r.size>=F)break}t%1e3===0&&console.log(`已檢查 ${t} 個字符，找到 ${r.size} 個例字`)}return W.value+=t,console.log(`字根 "${i}" 最終找到例字:`,Array.from(r).slice(0,5),`(總共${r.size}個)`),Array.from(r)}catch(d){return console.error("获取例字失败:",d),d instanceof Error&&d.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function Y(){S.value=!0;try{const c=q(K.value),i=await he(c.zigenUrl);f.value=i,console.log(`已加載字根數據，文件: ${c.zigenUrl}`),console.log("注意：拆分數據將在第一次懸停字根時才加載")}catch(c){console.error("加载字根数据失败:",c)}finally{S.value=!1}}async function ue(c,i){var t;if(A.value=i.font,H.value={x:c.clientX,y:c.clientY},!z.value){console.log("第一次懸停，正在初始化拆分數據加載器...");const n=q(K.value);z.value=ne.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}let r="";if(f.value){for(const[n,a]of f.value)if(a.font===i.font&&((t=a.ma)==null?void 0:t.slice(1))===i.code){r=a.ma;break}}const d=se(i.font,r);C.value=d,console.log("開始獲取例字，字根數量:",[...d.visible,...d.hidden].length);const o={},u=[...d.visible,...d.hidden];for(const n of u){console.log(`正在獲取字根 "${n.font}" 的例字...`);const a=await R(n.font);console.log(`字根 "${n.font}" 找到例字:`,a.length,"個"),o[n.font]=a.slice(0,8)}w.value=o}function re(){P.value||(A.value=null,C.value=null,w.value={})}function J(c){switch(c){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function ee(c,i){var t;if(c.stopPropagation(),!z.value){console.log("點擊時初始化拆分數據加載器...");const n=q(K.value);z.value=ne.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}if(P.value&&B.value===i.font){X();return}B.value=i.font,P.value=!0;let r="";if(f.value){for(const[n,a]of f.value)if(a.font===i.font&&((t=a.ma)==null?void 0:t.slice(1))===i.code){r=a.ma;break}}const d=se(i.font,r);E.value=d,console.log("開始獲取例字，字根數量:",[...d.visible,...d.hidden].length);const o={},u=[...d.visible,...d.hidden];for(const n of u){console.log(`正在獲取字根 "${n.font}" 的例字...`);const a=await R(n.font);console.log(`字根 "${n.font}" 找到例字:`,a.length,"個"),o[n.font]=a.slice(0,10)}$.value=o,console.log(`固定彈窗 - 字根 "${i.font}" 的最終例字:`,$.value),A.value=null,C.value=null,w.value={}}function X(){P.value=!1,B.value=null,E.value=null,$.value={}}function se(c,i){var o;const r=[],d=[];if(!f.value||!i)return{visible:r,hidden:d};for(const[u,t]of f.value){const n=t.font,a=(o=t.ma)==null?void 0:o.trim();!a||!n||n===null||n===void 0||a===i&&(n===c?r.unshift({font:n,code:a}):d.push({font:n,code:a}))}return{visible:r,hidden:d}}return oe(()=>K.value,Y),te(()=>{Y(),document.addEventListener("click",c=>{if(P.value){const i=document.querySelector(".pinned-popup");i&&!i.contains(c.target)&&X()}})}),(c,i)=>{var r,d;return e(),s("div",xe,[S.value?(e(),s("div",ke,Ce)):k("",!0),S.value?k("",!0):(e(),s("div",we,[$e,j.value?k("",!0):(e(),s("div",Ze,[Le,l("button",{onClick:ce,class:y(["layout-toggle-btn",{"layout-toggle-active":b.value}]),title:b.value?"切換為網格布局":"切換為列表布局"},[b.value?(e(),s("span",Ee,"⊞")):(e(),s("span",Me,"☰"))],10,Se)]))])),!S.value&&f.value&&!j.value&&!b.value?(e(),s("div",Pe,[(e(),s(p,null,g(O,(o,u)=>l("div",{key:u,class:"keyboard-row"},[(e(!0),s(p,null,g(o,t=>{var n;return e(),s("div",{key:t,class:y(["keyboard-key",{"empty-key":L.includes(t)}])},[l("div",Ue,h(t.toUpperCase()),1),!L.includes(t)&&((n=T.value[t])==null?void 0:n.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:le({gridTemplateColumns:ae.value})},[(e(!0),s(p,null,g(T.value[t].visible,(a,m)=>(e(),s("span",{key:m,class:"zigen-item",onMouseenter:x=>ue(x,a),onMouseleave:re,onClick:x=>ee(x,a)},[l("span",{class:y(Z.value)},h(a.font),3),l("span",je,h(a.code),1)],40,De))),128)),T.value[t].hidden.length>0?(e(),s("span",Ae,"⋯")):k("",!0)],4)):L.includes(t)?k("",!0):(e(),s("div",Be,[t==="/"?(e(),s("div",Fe,We)):t==="z"?(e(),s("div",Ve,He)):t==="a"?(e(),s("div",Te,Ge)):t==="e"?(e(),s("div",Qe,Je)):t==="i"?(e(),s("div",es,ts)):t==="o"?(e(),s("div",os,as)):t==="u"?(e(),s("div",cs,rs)):(e(),s("div",vs,h(J(t)),1))]))],2)}),128))])),64))])):k("",!0),!S.value&&f.value&&(j.value||b.value)?(e(),s("div",{key:3,class:y(["mobile-layout",{"desktop-list-layout":!j.value&&b.value}])},[(e(!0),s(p,null,g(G.value,o=>{var u;return e(),s("div",{key:o,class:y(["mobile-key-row",{"empty-mobile-key":L.includes(o)}])},[l("div",hs,h(o.toUpperCase()),1),!L.includes(o)&&((u=Q.value[o])==null?void 0:u.length)>0?(e(),s("div",_s,[l("div",fs,[(e(!0),s(p,null,g(Q.value[o],(t,n)=>(e(),s("span",{key:`sorted-${n}`,class:y(["mobile-zigen-item",{"mobile-hidden-zigen":t.isHidden}]),onClick:a=>ee(a,t)},[l("span",{class:y(Z.value)},h(t.font),3),l("span",gs,h(t.code),1)],10,ps))),128))])])):L.includes(o)?k("",!0):(e(),s("div",ms,[o==="/"?(e(),s("span",ys,"引導特殊符號")):o==="z"?(e(),s("span",xs,"引導拼音反查")):["a","e","i","o","u"].includes(o)?(e(),s("span",ks," 一碼上屏字 ")):(e(),s("span",bs,h(J(o)),1))]))],2)}),128))],2)):k("",!0),A.value&&C.value?(e(),s("div",{key:4,class:"hover-card",style:le({left:H.value.x+10+"px",top:H.value.y+10+"px"})},[l("div",zs,[l("div",Cs,[l("h3",ws," 編碼 "+h(((r=C.value.visible[0])==null?void 0:r.code)||A.value)+" 上的字根 ",1),l("div",$s,[(e(!0),s(p,null,g(C.value.visible,(o,u)=>{var t;return e(),s("div",{key:`visible-${u}`,class:"zigen-row-inline"},[l("div",Zs,[l("span",{class:y(Z.value)},h(o.font),3)]),((t=w.value[o.font])==null?void 0:t.length)>0?(e(),s("div",Ls,[(e(!0),s(p,null,g(w.value[o.font].slice(0,F),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Ss,Es))])}),128)),(e(!0),s(p,null,g(C.value.hidden,(o,u)=>{var t;return e(),s("div",{key:`hidden-${u}`,class:"zigen-row-inline"},[l("div",Ps,[l("span",{class:y(Z.value)},h(o.font),3)]),((t=w.value[o.font])==null?void 0:t.length)>0?(e(),s("div",Us,[(e(!0),s(p,null,g(w.value[o.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Ds,As))])}),128))])])])],4)):k("",!0),P.value&&B.value&&E.value?(e(),s("div",Bs,[l("div",Fs,[l("div",Is,[l("div",Ks,[l("h3",Ws," 編碼 "+h(((d=E.value.visible[0])==null?void 0:d.code)||B.value)+" 上的字根 ",1),l("button",{onClick:X,class:"close-btn"},"✕")]),l("div",Vs,[(e(!0),s(p,null,g(E.value.visible,(o,u)=>{var t;return e(),s("div",{key:`pinned-visible-${u}`,class:"zigen-row-inline"},[l("div",Ns,[l("span",{class:y(Z.value)},h(o.font),3)]),((t=$.value[o.font])==null?void 0:t.length)>0?(e(),s("div",qs,[(e(!0),s(p,null,g($.value[o.font].slice(0,F),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Hs,Xs))])}),128)),(e(!0),s(p,null,g(E.value.hidden,(o,u)=>{var t;return e(),s("div",{key:`pinned-hidden-${u}`,class:"zigen-row-inline"},[l("div",Os,[l("span",{class:y(Z.value)},h(o.font),3)]),((t=$.value[o.font])==null?void 0:t.length)>0?(e(),s("div",Gs,[(e(!0),s(p,null,g($.value[o.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Qs,Ys))])}),128))])])])])):k("",!0)])}}}),tn=ye(Js,[["__scopeId","data-v-1fe4b88e"]]);export{tn as Z};
