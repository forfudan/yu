import{f as de}from"./share.Nrbaa2_l.js";import{C as Y}from"./ChaiDataLoader.DYi6iwdM.js";import{d as ue,k as U,am as re,h as f,l as J,A as ve,y as ee,o as e,c as s,e as x,m as l,n as y,F as p,G as g,Q as se,t as h,q as he,s as _e,_ as fe}from"./framework.rq0FYgLR.js";const v=P=>(he("data-v-c582abdd"),P=P(),_e(),P),pe={class:"zigen-map-container"},ge={key:0,class:"flex justify-center items-center py-8"},me=v(()=>l("div",{class:"loading loading-spinner loading-lg"},null,-1)),ye=v(()=>l("span",{class:"ml-2"},"正在加载字根数据...",-1)),xe=[me,ye],ke={key:1,class:"flex justify-between items-center mb-4"},be=v(()=>l("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),ze={key:0,class:"flex items-center space-x-2"},Ce=v(()=>l("span",{class:"text-xs text-gray-400"},"切換字根圖和字根表：",-1)),we=["title"],$e={key:0},Ze={key:1},Le={key:2,class:"keyboard-layout"},Se={class:"key-label"},Me=["onMouseenter","onClick"],Ee={class:"zigen-code"},Ue={key:0,class:"more-indicator"},Pe={key:1,class:"text-xs text-gray-400 no-zigen-text"},De={key:0,class:"vertical-text zigen-font"},je=v(()=>l("div",null,"引導特殊符號",-1)),Be=v(()=>l("div",null,"切換多重註解",-1)),Fe=[je,Be],Ie={key:1,class:"vertical-text zigen-font"},Ke=v(()=>l("div",null,"引導拼音反查",-1)),We=v(()=>l("div",null,"引導歷史輸入",-1)),Ve=[Ke,We],Ne={key:2,class:"vertical-text zigen-font"},qe=v(()=>l("div",null,null,-1)),He=v(()=>l("div",null,"一碼上屏字　了",-1)),Te=[qe,He],Ae={key:3,class:"vertical-text zigen-font"},Oe=v(()=>l("div",null,null,-1)),Ge=v(()=>l("div",null,"一碼上屏字　的",-1)),Qe=[Oe,Ge],Re={key:4,class:"vertical-text zigen-font"},Xe=v(()=>l("div",null,null,-1)),Ye=v(()=>l("div",null,"一碼上屏字　是",-1)),Je=[Xe,Ye],es={key:5,class:"vertical-text zigen-font"},ss=v(()=>l("div",null,null,-1)),ns=v(()=>l("div",null,"一碼上屏字　我",-1)),ts=[ss,ns],os={key:6,class:"vertical-text zigen-font"},ls=v(()=>l("div",null,null,-1)),is=v(()=>l("div",null,"一碼上屏字　不",-1)),as=[ls,is],cs={key:7,class:"vertical-text single-line zigen-font"},ds={class:"mobile-key-label"},us={key:0,class:"mobile-zigen-container"},rs={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},vs=["onClick"],hs={class:"zigen-code"},_s={key:1,class:"mobile-no-zigen"},fs={key:0,class:"mobile-key-desc zigen-font"},ps={key:1,class:"mobile-key-desc zigen-font"},gs={key:2,class:"mobile-key-desc zigen-font"},ms={key:3,class:"mobile-key-desc"},ys={class:"popup-container"},xs={class:"popup-body"},ks={class:"popup-title"},bs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},zs={class:"zigen-header-inline current-zigen"},Cs={key:0,class:"example-chars-same-line"},ws={key:1,class:"example-chars-same-line"},$s=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Zs=[$s],Ls={class:"zigen-header-inline other-zigen"},Ss={key:0,class:"example-chars-same-line"},Ms={key:1,class:"example-chars-same-line"},Es=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Us=[Es],Ps={key:5,class:"pinned-popup"},Ds={class:"popup-container"},js={class:"popup-body"},Bs={class:"popup-header"},Fs={class:"popup-title"},Is={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Ks={class:"zigen-header-inline current-zigen"},Ws={key:0,class:"example-chars-same-line"},Vs={key:1,class:"example-chars-same-line"},Ns=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),qs=[Ns],Hs={class:"zigen-header-inline other-zigen"},Ts={key:0,class:"example-chars-same-line"},As={key:1,class:"example-chars-same-line"},Os=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Gs=[Os],Qs=ue({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(P){const F=P,Z=U(()=>F.zigenFontClass||"zigen-font"),ne=re(F,"columnMinWidth"),te=U(()=>`repeat(auto-fill, minmax(${ne.value||"2rem"}, max-content))`),H=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],L=["'"],D=f(!1),b=f(!1),K=()=>{D.value=window.innerWidth<1280},oe=()=>{b.value=!b.value};J(()=>{K(),window.addEventListener("resize",K)}),ve(()=>{window.removeEventListener("resize",K)});const T=U(()=>H.flat()),le=["joy","light","star","ming","wafel"];function W(a){const c=le.includes(a);return{zigenUrl:`/zigen-${a}.csv`,chaifenUrl:c?"/chaifen.json":`/chaifen-${a}.json`}}const I=U(()=>F.defaultScheme||"star"),_=f(),z=f(),S=f(!1),j=f(null),C=f(null),V=f({x:0,y:0}),w=f({}),B=f(null),M=f(null),$=f({}),E=f(!1);ee(()=>F.defaultScheme,()=>{z.value=null});const N=U(()=>{var r;if(!_.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",_.value.size);const a={},c=[];for(const[u,t]of _.value){const d=t.font,o=(r=t.ma)==null?void 0:r.trim();if(!o||o.length===0||d==null)continue;const n=o[0].toLowerCase(),i=o.slice(1);c.push({font:d,ma:o,firstLetter:n,code:i})}console.log(`Found ${c.length} valid zigens`);for(let u=0;u<c.length;u++){const t=c[u],{font:d,ma:o,firstLetter:n,code:i}=t;a[n]||(a[n]={visible:[],hidden:[]});const m=u>0?c[u-1]:null,k=m&&m.code===i&&m.firstLetter===n;a[n].visible.find(ce=>ce.code===i)?k?a[n].hidden.push({font:d,code:i}):a[n].visible.push({font:d,code:i}):a[n].visible.push({font:d,code:i})}return console.log("Final result:",a),a}),A=U(()=>{var c;if(!_.value)return{};const a={};for(const r of T.value)a[r]=[];for(const[r,u]of _.value){const t=u.font,d=(c=u.ma)==null?void 0:c.trim();if(!d||t===null||t===void 0)continue;const o=d[0].toLowerCase(),n=d.slice(1),i=a[o].some(m=>m.code===n);a[o].push({font:t,code:n,isHidden:i})}return a}),O=async a=>{var c;if(!z.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${a}" 搜索例字...`);const r=new Promise((i,m)=>{setTimeout(()=>m(new Error("數據加載超時")),1e4)}),u=await Promise.race([z.value.loadData(),r]),t=[],d=a.normalize("NFC");console.log(`搜索字根: "${d}"`);const o=Object.entries(u).slice(0,3);console.log("數據樣本:",o);let n=0;for(const[i,m]of Object.entries(u)){n++;const k=m;if(n<=5&&console.log(`字符 "${i}" 的拆分數據:`,k.d),(c=k.d)!=null&&c.includes(d)&&(console.log(`✅ 找到匹配: "${i}" 包含字根 "${d}", 拆分: "${k.d}"`),t.push(i),t.length>=20))break;n%1e3===0&&console.log(`已檢查 ${n} 個字符，找到 ${t.length} 個例字`)}return console.log(`字根 "${d}" 最終找到例字:`,t.slice(0,5),`(總共${t.length}個)`),t}catch(r){return console.error("获取例字失败:",r),r instanceof Error&&r.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function G(){S.value=!0;try{const a=W(I.value),c=await de(a.zigenUrl);_.value=c,console.log(`已加載字根數據，文件: ${a.zigenUrl}`),console.log("注意：拆分數據將在第一次懸停字根時才加載")}catch(a){console.error("加载字根数据失败:",a)}finally{S.value=!1}}async function ie(a,c){var o;if(j.value=c.font,V.value={x:a.clientX,y:a.clientY},!z.value){console.log("第一次懸停，正在初始化拆分數據加載器...");const n=W(I.value);z.value=Y.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}let r="";if(_.value){for(const[n,i]of _.value)if(i.font===c.font&&((o=i.ma)==null?void 0:o.slice(1))===c.code){r=i.ma;break}}const u=X(c.font,r);C.value=u,console.log("開始獲取例字，字根數量:",[...u.visible,...u.hidden].length);const t={},d=[...u.visible,...u.hidden];for(const n of d){console.log(`正在獲取字根 "${n.font}" 的例字...`);const i=await O(n.font);console.log(`字根 "${n.font}" 找到例字:`,i.length,"個"),t[n.font]=i.slice(0,8)}w.value=t}function ae(){E.value||(j.value=null,C.value=null,w.value={})}function Q(a){switch(a){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function R(a,c){var o;if(a.stopPropagation(),!z.value){console.log("點擊時初始化拆分數據加載器...");const n=W(I.value);z.value=Y.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}if(E.value&&B.value===c.font){q();return}B.value=c.font,E.value=!0;let r="";if(_.value){for(const[n,i]of _.value)if(i.font===c.font&&((o=i.ma)==null?void 0:o.slice(1))===c.code){r=i.ma;break}}const u=X(c.font,r);M.value=u,console.log("開始獲取例字，字根數量:",[...u.visible,...u.hidden].length);const t={},d=[...u.visible,...u.hidden];for(const n of d){console.log(`正在獲取字根 "${n.font}" 的例字...`);const i=await O(n.font);console.log(`字根 "${n.font}" 找到例字:`,i.length,"個"),t[n.font]=i.slice(0,10)}$.value=t,console.log(`固定彈窗 - 字根 "${c.font}" 的最終例字:`,$.value),j.value=null,C.value=null,w.value={}}function q(){E.value=!1,B.value=null,M.value=null,$.value={}}function X(a,c){var t;const r=[],u=[];if(!_.value||!c)return{visible:r,hidden:u};for(const[d,o]of _.value){const n=o.font,i=(t=o.ma)==null?void 0:t.trim();!i||!n||n===null||n===void 0||i===c&&(n===a?r.unshift({font:n,code:i}):u.push({font:n,code:i}))}return{visible:r,hidden:u}}return ee(()=>I.value,G),J(()=>{G(),document.addEventListener("click",a=>{if(E.value){const c=document.querySelector(".pinned-popup");c&&!c.contains(a.target)&&q()}})}),(a,c)=>{var r,u;return e(),s("div",pe,[S.value?(e(),s("div",ge,xe)):x("",!0),S.value?x("",!0):(e(),s("div",ke,[be,D.value?x("",!0):(e(),s("div",ze,[Ce,l("button",{onClick:oe,class:y(["layout-toggle-btn",{"layout-toggle-active":b.value}]),title:b.value?"切換為網格布局":"切換為列表布局"},[b.value?(e(),s("span",Ze,"⊞")):(e(),s("span",$e,"☰"))],10,we)]))])),!S.value&&_.value&&!D.value&&!b.value?(e(),s("div",Le,[(e(),s(p,null,g(H,(t,d)=>l("div",{key:d,class:"keyboard-row"},[(e(!0),s(p,null,g(t,o=>{var n;return e(),s("div",{key:o,class:y(["keyboard-key",{"empty-key":L.includes(o)}])},[l("div",Se,h(o.toUpperCase()),1),!L.includes(o)&&((n=N.value[o])==null?void 0:n.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:se({gridTemplateColumns:te.value})},[(e(!0),s(p,null,g(N.value[o].visible,(i,m)=>(e(),s("span",{key:m,class:"zigen-item",onMouseenter:k=>ie(k,i),onMouseleave:ae,onClick:k=>R(k,i)},[l("span",{class:y(Z.value)},h(i.font),3),l("span",Ee,h(i.code),1)],40,Me))),128)),N.value[o].hidden.length>0?(e(),s("span",Ue,"⋯")):x("",!0)],4)):L.includes(o)?x("",!0):(e(),s("div",Pe,[o==="/"?(e(),s("div",De,Fe)):o==="z"?(e(),s("div",Ie,Ve)):o==="a"?(e(),s("div",Ne,Te)):o==="e"?(e(),s("div",Ae,Qe)):o==="i"?(e(),s("div",Re,Je)):o==="o"?(e(),s("div",es,ts)):o==="u"?(e(),s("div",os,as)):(e(),s("div",cs,h(Q(o)),1))]))],2)}),128))])),64))])):x("",!0),!S.value&&_.value&&(D.value||b.value)?(e(),s("div",{key:3,class:y(["mobile-layout",{"desktop-list-layout":!D.value&&b.value}])},[(e(!0),s(p,null,g(T.value,t=>{var d;return e(),s("div",{key:t,class:y(["mobile-key-row",{"empty-mobile-key":L.includes(t)}])},[l("div",ds,h(t.toUpperCase()),1),!L.includes(t)&&((d=A.value[t])==null?void 0:d.length)>0?(e(),s("div",us,[l("div",rs,[(e(!0),s(p,null,g(A.value[t],(o,n)=>(e(),s("span",{key:`sorted-${n}`,class:y(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:i=>R(i,o)},[l("span",{class:y(Z.value)},h(o.font),3),l("span",hs,h(o.code),1)],10,vs))),128))])])):L.includes(t)?x("",!0):(e(),s("div",_s,[t==="/"?(e(),s("span",fs,"引導特殊符號")):t==="z"?(e(),s("span",ps,"引導拼音反查")):["a","e","i","o","u"].includes(t)?(e(),s("span",gs," 一碼上屏字 ")):(e(),s("span",ms,h(Q(t)),1))]))],2)}),128))],2)):x("",!0),j.value&&C.value?(e(),s("div",{key:4,class:"hover-card",style:se({left:V.value.x+10+"px",top:V.value.y+10+"px"})},[l("div",ys,[l("div",xs,[l("h3",ks," 編碼 "+h(((r=C.value.visible[0])==null?void 0:r.code)||j.value)+" 上的字根 ",1),l("div",bs,[(e(!0),s(p,null,g(C.value.visible,(t,d)=>{var o;return e(),s("div",{key:`visible-${d}`,class:"zigen-row-inline"},[l("div",zs,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=w.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Cs,[(e(!0),s(p,null,g(w.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",ws,Zs))])}),128)),(e(!0),s(p,null,g(C.value.hidden,(t,d)=>{var o;return e(),s("div",{key:`hidden-${d}`,class:"zigen-row-inline"},[l("div",Ls,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=w.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Ss,[(e(!0),s(p,null,g(w.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Ms,Us))])}),128))])])])],4)):x("",!0),E.value&&B.value&&M.value?(e(),s("div",Ps,[l("div",Ds,[l("div",js,[l("div",Bs,[l("h3",Fs," 編碼 "+h(((u=M.value.visible[0])==null?void 0:u.code)||B.value)+" 上的字根 ",1),l("button",{onClick:q,class:"close-btn"},"✕")]),l("div",Is,[(e(!0),s(p,null,g(M.value.visible,(t,d)=>{var o;return e(),s("div",{key:`pinned-visible-${d}`,class:"zigen-row-inline"},[l("div",Ks,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=$.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Ws,[(e(!0),s(p,null,g($.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Vs,qs))])}),128)),(e(!0),s(p,null,g(M.value.hidden,(t,d)=>{var o;return e(),s("div",{key:`pinned-hidden-${d}`,class:"zigen-row-inline"},[l("div",Hs,[l("span",{class:y(Z.value)},h(t.font),3)]),((o=$.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Ts,[(e(!0),s(p,null,g($.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",As,Gs))])}),128))])])])])):x("",!0)])}}}),en=fe(Qs,[["__scopeId","data-v-c582abdd"]]);export{en as Z};
