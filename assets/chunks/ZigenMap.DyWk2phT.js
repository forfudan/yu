import{f as ae}from"./share.DAxIUpi5.js";import{C as X}from"./ChaiDataLoader.DYi6iwdM.js";import{d as ce,am as de,k as I,h as _,l as Y,A as ue,y as G,o as e,c as s,e as m,m as l,n as j,F as f,E as p,Q as J,t as h,q as re,s as ve,_ as he}from"./framework.DTi27XpN.js";const v=E=>(re("data-v-2cad5497"),E=E(),ve(),E),_e={class:"zigen-map-container"},fe={key:0,class:"flex justify-center items-center py-8"},pe=v(()=>l("div",{class:"loading loading-spinner loading-lg"},null,-1)),ge=v(()=>l("span",{class:"ml-2"},"正在加载字根数据...",-1)),me=[pe,ge],ye={key:1,class:"flex justify-between items-center mb-4"},xe=v(()=>l("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),ke={key:0,class:"flex items-center space-x-2"},be=v(()=>l("span",{class:"text-xs text-gray-400"},"布局：",-1)),ze=["title"],Ce={key:0},we={key:1},$e={key:2,class:"keyboard-layout"},Ze={class:"key-label"},Le=["onMouseenter","onClick"],Se={class:"zigen-font"},Ee={class:"zigen-code"},Me={key:0,class:"more-indicator"},Ue={key:1,class:"text-xs text-gray-400 no-zigen-text"},Pe={key:0,class:"vertical-text zigen-font"},De=v(()=>l("div",null,"引導特殊符號",-1)),Ie=v(()=>l("div",null,"切換多重註解",-1)),je=[De,Ie],Be={key:1,class:"vertical-text zigen-font"},He=v(()=>l("div",null,"引導拼音反查",-1)),Ke=v(()=>l("div",null,"引導歷史輸入",-1)),We=[He,Ke],Ve={key:2,class:"vertical-text zigen-font"},Fe=v(()=>l("div",null,null,-1)),Ne=v(()=>l("div",null,"一碼上屏字　了",-1)),qe=[Fe,Ne],Oe={key:3,class:"vertical-text zigen-font"},Te=v(()=>l("div",null,null,-1)),Ae=v(()=>l("div",null,"一碼上屏字　的",-1)),Qe=[Te,Ae],Re={key:4,class:"vertical-text zigen-font"},Xe=v(()=>l("div",null,null,-1)),Ye=v(()=>l("div",null,"一碼上屏字　是",-1)),Ge=[Xe,Ye],Je={key:5,class:"vertical-text zigen-font"},es=v(()=>l("div",null,null,-1)),ss=v(()=>l("div",null,"一碼上屏字　我",-1)),ns=[es,ss],ts={key:6,class:"vertical-text zigen-font"},os=v(()=>l("div",null,null,-1)),ls=v(()=>l("div",null,"一碼上屏字　不",-1)),is=[os,ls],as={key:7,class:"vertical-text single-line zigen-font"},cs={class:"mobile-key-label"},ds={key:0,class:"mobile-zigen-container"},us={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},rs=["onClick"],vs={class:"zigen-font"},hs={class:"zigen-code"},_s={key:1,class:"mobile-no-zigen"},fs={key:0,class:"mobile-key-desc zigen-font"},ps={key:1,class:"mobile-key-desc zigen-font"},gs={key:2,class:"mobile-key-desc zigen-font"},ms={key:3,class:"mobile-key-desc zigen-font"},ys={class:"popup-container"},xs={class:"popup-body"},ks={class:"popup-title"},bs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},zs={class:"zigen-header-inline current-zigen"},Cs={class:"zigen-font"},ws={key:0,class:"example-chars-same-line"},$s={key:1,class:"example-chars-same-line"},Zs=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ls=[Zs],Ss={class:"zigen-header-inline other-zigen"},Es={class:"zigen-font"},Ms={key:0,class:"example-chars-same-line"},Us={key:1,class:"example-chars-same-line"},Ps=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ds=[Ps],Is={key:5,class:"pinned-popup"},js={class:"popup-container"},Bs={class:"popup-body"},Hs={class:"popup-header"},Ks={class:"popup-title"},Ws={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Vs={class:"zigen-header-inline current-zigen"},Fs={class:"zigen-font"},Ns={key:0,class:"example-chars-same-line"},qs={key:1,class:"example-chars-same-line"},Os=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ts=[Os],As={class:"zigen-header-inline other-zigen"},Qs={class:"zigen-font"},Rs={key:0,class:"example-chars-same-line"},Xs={key:1,class:"example-chars-same-line"},Ys=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Gs=[Ys],Js=ce({__name:"ZigenMap",props:{defaultScheme:{},hideSchemeButtons:{type:Boolean},columnMinWidth:{}},setup(E){const H=E,ee=de(H,"columnMinWidth"),se=I(()=>`repeat(auto-fill, minmax(${ee.value||"2rem"}, max-content))`),N=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],$=["'"],M=_(!1),k=_(!1),K=()=>{M.value=window.innerWidth<1280},ne=()=>{k.value=!k.value};Y(()=>{K(),window.addEventListener("resize",K)}),ue(()=>{window.removeEventListener("resize",K)});const te=I(()=>N.flat());function W(a){return{zigenUrl:`/zigen-${a}.csv`,chaifenUrl:"/chaifen.json"}}const B=I(()=>H.defaultScheme||"star"),g=_(),b=_(),Z=_(!1),U=_(null),z=_(null),V=_({x:0,y:0}),C=_({}),P=_(null),L=_(null),w=_({}),S=_(!1);G(()=>H.defaultScheme,()=>{b.value=null});const D=I(()=>{var r;if(!g.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",g.value.size);const a={},u=[];for(const[d,n]of g.value){const c=n.font,o=(r=n.ma)==null?void 0:r.trim();if(!o||o.length===0||c==null)continue;const t=o[0].toLowerCase(),i=o.slice(1);u.push({font:c,ma:o,firstLetter:t,code:i})}console.log(`Found ${u.length} valid zigens`);for(let d=0;d<u.length;d++){const n=u[d],{font:c,ma:o,firstLetter:t,code:i}=n;a[t]||(a[t]={visible:[],hidden:[]});const y=d>0?u[d-1]:null,x=y&&y.code===i&&y.firstLetter===t;a[t].visible.find(ie=>ie.code===i)?x?a[t].hidden.push({font:c,code:i}):a[t].visible.push({font:c,code:i}):a[t].visible.push({font:c,code:i})}return console.log("Final result:",a),a}),q=I(()=>{if(!D.value)return{};const a={};for(const[u,r]of Object.entries(D.value)){const d=[];r.visible.forEach(n=>{d.push({...n,isHidden:!1})}),r.hidden.forEach(n=>{d.push({...n,isHidden:!0})}),d.sort((n,c)=>n.code!==c.code?n.code.localeCompare(c.code):(n.isHidden?1:0)-(c.isHidden?1:0)),a[u]=d}return a}),O=async a=>{var u;if(!b.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${a}" 搜索例字...`);const r=new Promise((i,y)=>{setTimeout(()=>y(new Error("數據加載超時")),1e4)}),d=await Promise.race([b.value.loadData(),r]),n=[],c=a.normalize("NFC");console.log(`搜索字根: "${c}"`);const o=Object.entries(d).slice(0,3);console.log("數據樣本:",o);let t=0;for(const[i,y]of Object.entries(d)){t++;const x=y;if(t<=5&&console.log(`字符 "${i}" 的拆分數據:`,x.d),(u=x.d)!=null&&u.includes(c)&&(console.log(`✅ 找到匹配: "${i}" 包含字根 "${c}", 拆分: "${x.d}"`),n.push(i),n.length>=20))break;t%1e3===0&&console.log(`已檢查 ${t} 個字符，找到 ${n.length} 個例字`)}return console.log(`字根 "${c}" 最終找到例字:`,n.slice(0,5),`(總共${n.length}個)`),n}catch(r){return console.error("获取例字失败:",r),r instanceof Error&&r.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function T(){Z.value=!0;try{const a=W(B.value),u=await ae(a.zigenUrl);g.value=u,console.log(`已加載字根數據，文件: ${a.zigenUrl}`),console.log("注意：拆分數據將在第一次懸停字根時才加載")}catch(a){console.error("加载字根数据失败:",a)}finally{Z.value=!1}}async function oe(a,u){var o;if(U.value=u.font,V.value={x:a.clientX,y:a.clientY},!b.value){console.log("第一次懸停，正在初始化拆分數據加載器...");const t=W(B.value);b.value=X.getInstance(t.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${t.chaifenUrl}`)}let r="";if(g.value){for(const[t,i]of g.value)if(i.font===u.font&&((o=i.ma)==null?void 0:o.slice(1))===u.code){r=i.ma;break}}const d=R(u.font,r);z.value=d,console.log("開始獲取例字，字根數量:",[...d.visible,...d.hidden].length);const n={},c=[...d.visible,...d.hidden];for(const t of c){console.log(`正在獲取字根 "${t.font}" 的例字...`);const i=await O(t.font);console.log(`字根 "${t.font}" 找到例字:`,i.length,"個"),n[t.font]=i.slice(0,8)}C.value=n}function le(){S.value||(U.value=null,z.value=null,C.value={})}function A(a){switch(a){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function Q(a,u){var o;if(a.stopPropagation(),!b.value){console.log("點擊時初始化拆分數據加載器...");const t=W(B.value);b.value=X.getInstance(t.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${t.chaifenUrl}`)}if(S.value&&P.value===u.font){F();return}P.value=u.font,S.value=!0;let r="";if(g.value){for(const[t,i]of g.value)if(i.font===u.font&&((o=i.ma)==null?void 0:o.slice(1))===u.code){r=i.ma;break}}const d=R(u.font,r);L.value=d,console.log("開始獲取例字，字根數量:",[...d.visible,...d.hidden].length);const n={},c=[...d.visible,...d.hidden];for(const t of c){console.log(`正在獲取字根 "${t.font}" 的例字...`);const i=await O(t.font);console.log(`字根 "${t.font}" 找到例字:`,i.length,"個"),n[t.font]=i.slice(0,10)}w.value=n,console.log(`固定彈窗 - 字根 "${u.font}" 的最終例字:`,w.value),U.value=null,z.value=null,C.value={}}function F(){S.value=!1,P.value=null,L.value=null,w.value={}}function R(a,u){var n;const r=[],d=[];if(!g.value||!u)return{visible:r,hidden:d};for(const[c,o]of g.value){const t=o.font,i=(n=o.ma)==null?void 0:n.trim();!i||!t||t===null||t===void 0||i===u&&(t===a?r.unshift({font:t,code:i}):d.push({font:t,code:i}))}return{visible:r,hidden:d}}return G(()=>B.value,T),Y(()=>{T(),document.addEventListener("click",a=>{if(S.value){const u=document.querySelector(".pinned-popup");u&&!u.contains(a.target)&&F()}})}),(a,u)=>{var r,d;return e(),s("div",_e,[Z.value?(e(),s("div",fe,me)):m("",!0),Z.value?m("",!0):(e(),s("div",ye,[xe,M.value?m("",!0):(e(),s("div",ke,[be,l("button",{onClick:ne,class:j(["layout-toggle-btn",{"layout-toggle-active":k.value}]),title:k.value?"切換為網格布局":"切換為列表布局"},[k.value?(e(),s("span",we,"⊞")):(e(),s("span",Ce,"☰"))],10,ze)]))])),!Z.value&&g.value&&!M.value&&!k.value?(e(),s("div",$e,[(e(),s(f,null,p(N,(n,c)=>l("div",{key:c,class:"keyboard-row"},[(e(!0),s(f,null,p(n,o=>{var t;return e(),s("div",{key:o,class:j(["keyboard-key",{"empty-key":$.includes(o)}])},[l("div",Ze,h(o.toUpperCase()),1),!$.includes(o)&&((t=D.value[o])==null?void 0:t.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:J({gridTemplateColumns:se.value})},[(e(!0),s(f,null,p(D.value[o].visible,(i,y)=>(e(),s("span",{key:y,class:"zigen-item",onMouseenter:x=>oe(x,i),onMouseleave:le,onClick:x=>Q(x,i)},[l("span",Se,h(i.font),1),l("span",Ee,h(i.code),1)],40,Le))),128)),D.value[o].hidden.length>0?(e(),s("span",Me,"⋯")):m("",!0)],4)):$.includes(o)?m("",!0):(e(),s("div",Ue,[o==="/"?(e(),s("div",Pe,je)):o==="z"?(e(),s("div",Be,We)):o==="a"?(e(),s("div",Ve,qe)):o==="e"?(e(),s("div",Oe,Qe)):o==="i"?(e(),s("div",Re,Ge)):o==="o"?(e(),s("div",Je,ns)):o==="u"?(e(),s("div",ts,is)):(e(),s("div",as,h(A(o)),1))]))],2)}),128))])),64))])):m("",!0),!Z.value&&g.value&&(M.value||k.value)?(e(),s("div",{key:3,class:j(["mobile-layout",{"desktop-list-layout":!M.value&&k.value}])},[(e(!0),s(f,null,p(te.value,n=>{var c;return e(),s("div",{key:n,class:j(["mobile-key-row",{"empty-mobile-key":$.includes(n)}])},[l("div",cs,h(n.toUpperCase()),1),!$.includes(n)&&((c=q.value[n])==null?void 0:c.length)>0?(e(),s("div",ds,[l("div",us,[(e(!0),s(f,null,p(q.value[n],(o,t)=>(e(),s("span",{key:`sorted-${t}`,class:j(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:i=>Q(i,o)},[l("span",vs,h(o.font),1),l("span",hs,h(o.code),1)],10,rs))),128))])])):$.includes(n)?m("",!0):(e(),s("div",_s,[n==="/"?(e(),s("span",fs,"引導特殊符號")):n==="z"?(e(),s("span",ps,"引導拼音反查")):["a","e","i","o","u"].includes(n)?(e(),s("span",gs," 一碼上屏字 ")):(e(),s("span",ms,h(A(n)),1))]))],2)}),128))],2)):m("",!0),U.value&&z.value?(e(),s("div",{key:4,class:"hover-card",style:J({left:V.value.x+10+"px",top:V.value.y+10+"px"})},[l("div",ys,[l("div",xs,[l("h3",ks," 編碼 "+h(((r=z.value.visible[0])==null?void 0:r.code)||U.value)+" 上的字根 ",1),l("div",bs,[(e(!0),s(f,null,p(z.value.visible,(n,c)=>{var o;return e(),s("div",{key:`visible-${c}`,class:"zigen-row-inline"},[l("div",zs,[l("span",Cs,h(n.font),1)]),((o=C.value[n.font])==null?void 0:o.length)>0?(e(),s("div",ws,[(e(!0),s(f,null,p(C.value[n.font].slice(0,8),t=>(e(),s("span",{key:t,class:"example-char zigen-font"},h(t),1))),128))])):(e(),s("div",$s,Ls))])}),128)),(e(!0),s(f,null,p(z.value.hidden,(n,c)=>{var o;return e(),s("div",{key:`hidden-${c}`,class:"zigen-row-inline"},[l("div",Ss,[l("span",Es,h(n.font),1)]),((o=C.value[n.font])==null?void 0:o.length)>0?(e(),s("div",Ms,[(e(!0),s(f,null,p(C.value[n.font].slice(0,8),t=>(e(),s("span",{key:t,class:"example-char zigen-font"},h(t),1))),128))])):(e(),s("div",Us,Ds))])}),128))])])])],4)):m("",!0),S.value&&P.value&&L.value?(e(),s("div",Is,[l("div",js,[l("div",Bs,[l("div",Hs,[l("h3",Ks," 編碼 "+h(((d=L.value.visible[0])==null?void 0:d.code)||P.value)+" 上的字根 ",1),l("button",{onClick:F,class:"close-btn"},"✕")]),l("div",Ws,[(e(!0),s(f,null,p(L.value.visible,(n,c)=>{var o;return e(),s("div",{key:`pinned-visible-${c}`,class:"zigen-row-inline"},[l("div",Vs,[l("span",Fs,h(n.font),1)]),((o=w.value[n.font])==null?void 0:o.length)>0?(e(),s("div",Ns,[(e(!0),s(f,null,p(w.value[n.font].slice(0,8),t=>(e(),s("span",{key:t,class:"example-char zigen-font"},h(t),1))),128))])):(e(),s("div",qs,Ts))])}),128)),(e(!0),s(f,null,p(L.value.hidden,(n,c)=>{var o;return e(),s("div",{key:`pinned-hidden-${c}`,class:"zigen-row-inline"},[l("div",As,[l("span",Qs,h(n.font),1)]),((o=w.value[n.font])==null?void 0:o.length)>0?(e(),s("div",Rs,[(e(!0),s(f,null,p(w.value[n.font].slice(0,8),t=>(e(),s("span",{key:t,class:"example-char zigen-font"},h(t),1))),128))])):(e(),s("div",Xs,Gs))])}),128))])])])])):m("",!0)])}}}),on=he(Js,[["__scopeId","data-v-2cad5497"]]);export{on as Z};
