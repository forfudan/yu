var ne=Object.defineProperty;var oe=(h,t,e)=>t in h?ne(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var b=(h,t,e)=>oe(h,typeof t!="symbol"?t+"":t,e);import{b as se,f as le}from"./share.D5aqWrzv.js";import{d as te,h as k,l as Z,R as U,aa as Q,k as j,v as ie,c as v,o as f,F as X,e as O,n as i,m as s,t as R,O as ce,p as z,C as ue,a3 as de,a4 as ge,a as ee,a0 as ve,a2 as fe,_ as pe,E as K,H as me}from"./framework.D5VGNaZP.js";import{f as xe}from"./share.BaGPHDUM.js";class re{constructor(t){b(this,"items",new Map);b(this,"storageKey");b(this,"practiceCount",0);b(this,"NEW_CARD_RATIO",.3);b(this,"INITIAL_INTERVALS",[3,8,20]);b(this,"GRADUATION_THRESHOLD",3);b(this,"EASY_MULTIPLIER",2);b(this,"GOOD_MULTIPLIER",1.8);b(this,"HARD_MULTIPLIER",1.3);this.storageKey=`spaced_repetition_${t}`,this.loadFromStorage()}recordSuccess(t){const e=this.getOrCreateItem(t);if(this.practiceCount++,e.consecutiveCorrect++,e.totalReviews++,e.lastPracticed=this.practiceCount,e.isNew=!1,e.consecutiveCorrect<=this.INITIAL_INTERVALS.length){const a=e.consecutiveCorrect-1;e.currentInterval=this.INITIAL_INTERVALS[a]||this.INITIAL_INTERVALS[this.INITIAL_INTERVALS.length-1]}else e.currentInterval=Math.floor(e.currentInterval*this.GOOD_MULTIPLIER),e.currentInterval=Math.min(e.currentInterval,50);e.nextReviewAt=this.practiceCount+e.currentInterval,this.items.set(t,e),this.saveToStorage()}recordFailure(t){const e=this.getOrCreateItem(t);this.practiceCount++,e.consecutiveCorrect=0,e.totalReviews++,e.errorCount++,e.lastPracticed=this.practiceCount,e.isNew=!1,e.currentInterval=1,e.nextReviewAt=this.practiceCount+e.currentInterval,this.items.set(t,e),this.saveToStorage()}getNext(t){const e=[],a=[];for(const y of t){const g=this.items.get(y.code);g?this.practiceCount>=g.nextReviewAt&&g.consecutiveCorrect<this.GRADUATION_THRESHOLD&&a.push(y):e.push(y)}return a.length>0?a[0]:e.length>0?e[0]:null}calculatePriority(t){let e=1e3;e+=t.errorCount*500;const a=this.practiceCount-t.nextReviewAt;return e+=Math.max(0,a)*100,t.consecutiveCorrect===0&&(e+=200),e}getStats(){let t=0,e=0,a=0;for(const y of this.items.values())y.consecutiveCorrect>=this.GRADUATION_THRESHOLD?t++:y.errorCount>=3?a++:e++;return{total:this.items.size,mastered:t,learning:e,difficult:a}}getItemStats(t){return this.items.get(t)||null}isFirstTime(t){const e=this.items.get(t);return!e||e.isNew||e.totalReviews===0}getCurrentProgress(){const t=this.items.size,a=Math.max(t*4,this.practiceCount+50);return{practiceCount:this.practiceCount,estimatedTotal:a}}getOrCreateItem(t){const e=this.items.get(t);if(e)return e;const a={id:t,nextReviewAt:this.practiceCount+1,consecutiveCorrect:0,totalReviews:0,errorCount:0,lastPracticed:0,isNew:!0,currentInterval:1};return this.items.set(t,a),a}loadFromStorage(){try{const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t);this.items=new Map(Object.entries(e.items||{})),this.practiceCount=e.practiceCount||0}}catch(t){console.warn("載入調度數據失敗:",t)}}saveToStorage(){try{const t={items:Object.fromEntries(this.items),practiceCount:this.practiceCount};localStorage.setItem(this.storageKey,JSON.stringify(t))}catch(t){console.warn("保存調度數據失敗:",t)}}reset(){this.items.clear(),this.practiceCount=0,localStorage.removeItem(this.storageKey)}}const he={class:"relative"},ye={key:0,class:"text-red-600 dark:text-red-400"},we=["title"],be={class:"flex items-center gap-1"},ke={class:"flex items-center gap-1"},Ce={key:1,class:"text-blue-600 dark:text-blue-400 font-medium"},Ie=te({__name:"TrainCardGroup",props:{name:{},cardGroups:{},chaifenMap:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean},isFrequencyOrder:{type:Boolean},onToggleSort:{type:Function},onReset:{type:Function}},setup(h){const t=h,{name:e,cardGroups:a,mode:y,supplement:g,ming:M,isFrequencyOrder:w,onToggleSort:E,onReset:B}=t;console.log(`載入分組練習會話: ${e}`);const C=new re(e),G=k(0),T=k(),S=k(""),p=k(!1),x=k(!0),F=k(0),_=k(!1),D=k(0),q=()=>{_.value=!0},l=()=>{B&&(B(),_.value=!1,setTimeout(()=>{window.location.reload()},100))},c=()=>{_.value=!1},r=k(typeof window<"u"?window.innerWidth:1024),L=()=>{r.value=window.innerWidth};Z(()=>{typeof window<"u"&&window.addEventListener("resize",L),U(()=>{var n;(n=T.value)==null||n.focus()}),document.addEventListener("keydown",V),H()}),Q(()=>{typeof window<"u"&&window.removeEventListener("resize",L),document.removeEventListener("keydown",V)});const I=j(()=>{if(!d.value)return"text-8xl";const n=d.value.zigens.length,o=r.value<768,u=r.value<1024;return o?n<=2?"text-6xl":n<=4?"text-5xl":"text-4xl":u?n<=2?"text-8xl":n<=4?"text-7xl":"text-6xl":n<=2?"text-9xl":n<=4?"text-8xl":"text-7xl"}),P=j(()=>{if(!d.value)return"gap-8 lg:gap-12";const n=d.value.zigens.length;return r.value<768?n>4?"gap-1":n>2?"gap-2":"gap-3":n>4?"gap-6":"gap-8 lg:gap-12"}),d=j(()=>a[G.value]||null);j(()=>a.length);const A=j(()=>{D.value;const o=C.getStats().total,u=a.length;return{current:o,total:u,percentage:u>0?(o/u*100).toFixed(1):"0"}}),W=j(()=>A.value.percentage);ie(S,n=>{if(!d.value)return;const o=n.trim().toLowerCase(),u=d.value.code.toLowerCase();o.length>=u.length&&(o===u?ae():p.value||J())});const ae=()=>{d.value&&(x.value=!0,C.recordSuccess(d.value.code),D.value++,H())},J=()=>{d.value&&(x.value=!1,F.value++,p.value=!0,C.recordFailure(d.value.code),D.value++,S.value="",U(()=>{var n;(n=T.value)==null||n.focus()}))},H=()=>{var u;const n=C.getNext(a);if(n)G.value=a.findIndex(m=>m.code===n.code);else{const m=a.filter(N=>{const $=C.getItemStats(N.code);return!$||$.consecutiveCorrect<3||$.errorCount>0});if(m.length>0){const N=m[Math.floor(Math.random()*m.length)];G.value=a.findIndex($=>$.code===N.code)}else G.value=Math.floor(Math.random()*a.length)}x.value=!0,F.value=0,S.value="";const o=(u=d.value)==null?void 0:u.code;o&&C.isFirstTime(o)?(p.value=!0,console.log(`字根組 "${o}" 第一次出現，直接顯示答案`)):p.value=!1,U(()=>{var m;(m=T.value)==null||m.focus()})},V=n=>{n.key==="Escape"&&!p.value&&(J(),n.preventDefault())},Y=n=>{const o=xe(n,t.chaifenMap),u=r.value<768,m=r.value<1024;let N=4;return u?N=2:m&&(N=3),o.slice(0,N).split("").join("")};return Z(()=>{U(()=>{var n;(n=T.value)==null||n.focus()}),document.addEventListener("keydown",V),H()}),Q(()=>{document.removeEventListener("keydown",V)}),(n,o)=>(f(),v(X,null,[d.value?(f(),v("div",{key:0,class:i(["mx-auto p-6 space-y-6",r.value<768?"max-w-sm p-3 space-y-3":"max-w-2xl"])},[s("div",he,[s("div",{class:i(["text-center text-gray-600 dark:text-gray-400",r.value<768?"text-xs":"text-sm"])},[s("div",{class:i(["flex justify-between items-center",r.value<768?"mb-1":"mb-2"])},[s("span",null,"已練習字根組: "+R(A.value.current)+" / "+R(A.value.total)+" (進度 "+R(A.value.percentage)+"%)",1),F.value>0?(f(),v("span",ye,"錯誤次數: "+R(F.value),1)):O("",!0)],2),s("div",{class:i(["w-full bg-gray-200 dark:bg-gray-700 rounded-full",r.value<768?"h-1.5":"h-2"])},[s("div",{class:i(["bg-blue-500 dark:bg-blue-400 rounded-full transition-all duration-300",r.value<768?"h-1.5":"h-2"]),style:ce(`width: ${W.value}%`)},null,6)],2)],2)]),s("div",{class:i(["w-full shadow-lg rounded-2xl transition-all duration-300 transform relative",{"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":!x.value,"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":x.value},"border-2 hover:shadow-xl"])},[s("div",{class:i(["absolute flex gap-2 z-10",r.value<768?"bottom-2 right-2":"bottom-4 right-4"])},[z(E)?(f(),v("button",{key:0,onClick:o[0]||(o[0]=()=>{console.log("排序按鈕被點擊，當前狀態:",z(w)),z(E)()}),class:i(["rounded-full font-medium transition-all duration-200 flex items-center justify-center shadow-md",r.value<768?"w-6 h-6 text-xs":"w-8 h-8 text-xs",z(w)?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200"]),title:z(w)?"字頻序 (點擊切換到字典序)":"字典序 (點擊切換到字頻序)"},[(f(),v("svg",{class:i(r.value<768?"w-2 h-2":"w-3 h-3"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[3]||(o[3]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"},null,-1)])],2))],10,we)):O("",!0),z(B)?(f(),v("button",{key:1,onClick:q,class:i(["rounded-full bg-red-500 hover:bg-red-600 text-white font-medium transition-all duration-200 flex items-center justify-center shadow-md",r.value<768?"w-6 h-6 text-xs":"w-8 h-8 text-xs"]),title:"重新開始訓練"},[(f(),v("svg",{class:i(r.value<768?"w-2 h-2":"w-3 h-3"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[4]||(o[4]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],2)):O("",!0)],2),s("div",{class:i(["text-center",r.value<768?"py-4":"py-12"])},[s("div",{class:i(["flex justify-center items-center flex-wrap",r.value<768?"mb-4":"mb-12",P.value])},[(f(!0),v(X,null,ue(d.value.zigens,(u,m)=>(f(),v("div",{key:m,class:"flex flex-col items-center group"},[s("div",{class:i(["zigen-font transform transition-all duration-300 group-hover:scale-110",r.value<768?"mb-1":"mb-4",I.value,{"text-red-500 dark:text-red-400":!x.value,"text-blue-700 dark:text-blue-300":x.value}])},R(u.font),3),p.value?(f(),v("div",{key:0,class:i(["text-sm text-gray-600 dark:text-gray-300 font-mono bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",r.value<768?"text-xs px-1 py-0.5":""])},R(u.ma),3)):O("",!0),Y(u.font)?(f(),v("div",{key:1,class:i(["text-gray-600 dark:text-gray-300 font-medium tracking-tight zigen-font",r.value<768?"mt-0.5":"mt-2",{"text-xs":r.value<768,"text-base":r.value>=768&&r.value<1024,"text-lg":r.value>=1024}])},R(Y(u.font)),3)):O("",!0)]))),128))],2)],2),s("div",{class:i(["flex justify-center",r.value<768?"pb-3":"pb-8"])},[de(s("input",{ref_key:"inputElement",ref:T,"onUpdate:modelValue":o[1]||(o[1]=u=>S.value=u),type:"text",placeholder:"編碼",class:i(["text-center border-2 rounded-xl font-mono","transition-all duration-300 focus:outline-none focus:ring-4",r.value<768?"px-3 py-2 text-lg w-32":"px-6 py-4 text-2xl w-48",{"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50 dark:border-red-700 dark:focus:border-red-500 dark:focus:ring-red-900/50 dark:bg-red-900/20 dark:text-white":!x.value,"border-blue-300 focus:border-blue-500 focus:ring-blue-200 bg-white dark:border-blue-700 dark:focus:border-blue-500 dark:focus:ring-blue-900/50 dark:bg-gray-800 dark:text-white":x.value}])},null,2),[[ge,S.value]])],2),s("div",{class:i(["text-center transition-all duration-300",r.value<768?"pb-3":"pb-8",{"opacity-0 transform translate-y-2":!p.value,"opacity-100":p.value}])},[s("div",{class:i(["inline-block bg-gray-100 dark:bg-gray-800 rounded-lg",r.value<768?"px-2 py-1":"px-4 py-2"])},[s("span",{class:i(["text-gray-800 dark:text-gray-200",r.value<768?"text-sm":""])},"答案是",2),s("span",{class:i(["font-mono font-bold text-blue-600 dark:text-blue-400",r.value<768?"text-lg":"text-xl"])},R(d.value.code),3)],2)],2)],2),s("div",{class:i(["text-center text-gray-500 dark:text-gray-400 space-y-1",r.value<768?"text-xs":"text-sm"])},[p.value?(f(),v("div",Ce," 繼續輸入正確編碼 ")):(f(),v("div",{key:0,class:i(["flex items-center justify-center",r.value<768?"gap-2 flex-col":"gap-4"])},[s("span",be,[s("kbd",{class:i(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",r.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"輸入",2),o[5]||(o[5]=ee(" 自動檢查 ",-1))]),s("span",ke,[s("kbd",{class:i(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",r.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"Esc",2),o[6]||(o[6]=ee(" 顯示答案 ",-1))])],2))],2)],2)):O("",!0),_.value?(f(),v("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:c},[s("div",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm mx-4 shadow-xl",onClick:o[2]||(o[2]=ve(()=>{},["stop"]))},[o[7]||(o[7]=fe('<div class="flex items-center gap-3 mb-4" data-v-1f961a76><div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center" data-v-1f961a76><svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-1f961a76><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-1f961a76></path></svg></div><div data-v-1f961a76><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100" data-v-1f961a76>確認重置</h3><p class="text-sm text-gray-600 dark:text-gray-400" data-v-1f961a76>您確定要重新開始訓練嗎？</p></div></div><p class="text-sm text-gray-600 dark:text-gray-400 mb-6" data-v-1f961a76> 這將清除當前的學習進度和統計數據，無法恢復。 </p>',2)),s("div",{class:"flex gap-3 justify-end"},[s("button",{onClick:c,class:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"}," 取消 "),s("button",{onClick:l,class:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors"}," 確認重置 ")])])])):O("",!0)],64))}}),Se=pe(Ie,[["__scopeId","data-v-1f961a76"]]),_e={key:0},Re={key:1,class:"text-gray-700 dark:text-gray-300 text-center"},Oe=te({__name:"ZigenTrain",props:{name:{},zigenUrl:{},range:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(h){const t=h;let e=t.name+"_zigen_grouped";const a=t.range;a&&(e+=`_${a[0]}_${a[1]}`);const y=`zigen_sort_order_${t.name}`,g=k(!1),M=K(),w=K(),E=K();function B(){try{const l=localStorage.getItem(y);if(l!==null){const c=JSON.parse(l);g.value=c,console.log("載入保存的排序狀態:",c)}}catch(l){console.warn("載入排序狀態失敗:",l)}}function C(){try{localStorage.setItem(y,JSON.stringify(g.value)),console.log("排序狀態已保存:",g.value)}catch(l){console.warn("保存排序狀態失敗:",l)}}const G=["口","一","月","丶","日","人","亻","扌","白","土","丷","二","又","丿","宀","木","尚","辶","小","冖","厶","心","氵","八","女","大","艹","𠂇","匕","寸","也","乙","戈","目","讠","不","龰","阝","竹","了","十","夂","王","刂","儿","力","凵","冂","子","斤","火","米","丁","彐","纟","文","立","士","夕","乂","门","卜","自","尤","彳","羊","止","禾","贝","尸","工","乚","上","囗","至","手","𬺰","艮","车","石","田","己","几","牛","见","走","甲","且","彡","犬","巾","西","方","刀","殳","七","弓","巴","矢","示"],T=["鳥","烏","魚","馬","風","來","車","長","門","鬥","齒","飛","見","貝","鹵","僉","韋","咼","黽"],S=l=>{switch(t.mode){case"A":return l[0];case"a":return l[1];case"both":return l}};function p(l){for(const c of l.zigens){const r=G.indexOf(c.font);if(r!==-1)return r}for(const c of l.zigens){const r=T.indexOf(c.font);if(r!==-1)return 1e4+r}return 5e3}function x(l){return[...l].sort((c,r)=>{const L=p(c),I=p(r);return L-I})}function F(){console.log("切換排序模式被調用，當前狀態:",g.value),g.value=!g.value,console.log("切換後狀態:",g.value),C(),_(),console.log("排序應用完成，按鈕應該顯示為:",g.value?"橙色（字頻序）":"灰色（字典序）"),setTimeout(()=>{window.location.reload()},100)}function _(){M.value?(g.value?(w.value=x(M.value),console.log("已切換到字頻序，重新排序了",w.value.length,"個字根組")):(w.value=[...M.value],console.log("已切換到字典序，恢復原始順序")),U(()=>{console.log("排序更新完成，當前順序:",w.value.slice(0,3).map(l=>l.code))})):console.warn("originalCardGroups 未初始化，無法應用排序")}function D(l){var r,L;const c=[];for(let I=0;I<l.length;I++){const P=l[I],d=(r=S(P.ma))==null?void 0:r.toLowerCase();if(!d)continue;const A=I>0?l[I-1]:null;(A?(L=S(A.ma))==null?void 0:L.toLowerCase():null)===d&&c.length>0&&c[c.length-1].code===d?c[c.length-1].zigens.push(P):c.push({code:d,zigens:[P]})}return c}function q(){M.value&&(new re(e).reset(),g.value=!1,C(),_(),console.log("訓練已重置，排序狀態重置為字典序"))}return Z(async()=>{B(),E.value=await se("/chaifen.csv");let c=[...(await le(t.zigenUrl)).values()];a&&(c=c.slice(a[0],a[1]));const r=D(c);M.value=r,_(),console.log(`字根練習：共 ${r.length} 個編碼組，包含 ${c.length} 個字根，當前${g.value?"字頻序":"字典序"}`)}),(l,c)=>w.value&&E.value?(f(),v("div",_e,[me(Se,{name:z(e),"card-groups":w.value,"chaifen-map":E.value,mode:"g",supplement:t.supplement??!1,ming:t.ming??!1,"is-frequency-order":g.value,"on-toggle-sort":F,"on-reset":q},null,8,["name","card-groups","chaifen-map","supplement","ming","is-frequency-order"])])):(f(),v("h2",Re," 下載資料中…… "))}});export{Oe as _};
