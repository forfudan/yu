var se=Object.defineProperty;var oe=(i,e,s)=>e in i?se(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var j=(i,e,s)=>oe(i,typeof e!="symbol"?e+"":e,s);import{g as ne}from"./framework.D-Vjga6a.js";const v=class v{constructor(e){j(this,"data",null);j(this,"loading",null);j(this,"dataUrl");j(this,"pakoLoaded",!1);this.dataUrl=e}async loadPako(){if(window.pako||this.pakoLoaded)return window.pako;try{const e=document.createElement("script");return e.src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js",e.crossOrigin="anonymous",await new Promise((s,t)=>{e.onload=s,e.onerror=t,document.head.appendChild(e)}),this.pakoLoaded=!0,window.pako}catch(e){return console.warn("Failed to load pako library:",e),null}}static getInstance(e="/chaifen.json"){return v.instances.has(e)||v.instances.set(e,new v(e)),v.instances.get(e)}async loadData(){return this.data?this.data:this.loading?this.loading:(this.loading=this.fetchOptimizedData(),this.data=await this.loading,this.loading=null,this.data)}async fetchOptimizedData(){const e=performance.now(),t=[{url:this.dataUrl.replace(".csv",".json"),compressed:!0},{url:this.dataUrl,compressed:!1,csv:!0}];for(const n of t)try{const r=await fetch(n.url,{headers:{Accept:"application/json, text/csv, */*","Accept-Charset":"utf-8"}});if(!r.ok)continue;let o;if(n.csv){const d=await r.arrayBuffer(),l=new TextDecoder("utf-8").decode(d);o=this.parseCsvToOptimized(l)}else if(n.compressed){const d=await r.arrayBuffer(),l=await this.decompressGzip(d),p=new TextDecoder("utf-8").decode(l);o=JSON.parse(p)}else{const d=await r.arrayBuffer(),l=new TextDecoder("utf-8").decode(d);o=JSON.parse(l)}const c=performance.now()-e;return console.log(`ğŸ“Š Loaded ${n.url} in ${c.toFixed(2)}ms`),console.log(`ğŸ“¦ Data contains ${Object.keys(o).length} characters`),o}catch(r){console.warn(`Failed to load ${n.url}:`,r);continue}throw new Error("Failed to load chaifen data from any source")}parseCsvToOptimized(e){const s=e.split(`
`),t={};for(let n=1;n<s.length;n++){const r=s[n].trim();if(!r)continue;const[o,c,d,l]=r.split(",");if(o){const p={};c&&(p.d=c),d&&(p.dt=d),l&&(p.r=l),t[o]=p}}return t}search(e){var n,r;if(!this.data)return console.warn("Data not loaded yet"),[];const s=[],t=e.toLowerCase();if(e.length===1&&this.data[e]){const o=this.data[e];s.push({char:e,division:o.d,division_tw:o.dt,region:o.r})}for(const[o,c]of Object.entries(this.data))(o.includes(t)||(n=c.d)!=null&&n.toLowerCase().includes(t)||(r=c.dt)!=null&&r.toLowerCase().includes(t))&&s.push({char:o,division:c.d,division_tw:c.dt,region:c.r});return s}getChar(e){if(!this.data||!this.data[e])return null;const s=this.data[e];return{char:e,division:s.d,division_tw:s.dt,region:s.r}}async decompressGzip(e){try{const s=await this.loadPako();if(s){console.log("ğŸ“¦ Using pako for gzip decompression");const p=new Uint8Array(e);return s.inflate(p).buffer}if(console.log("ğŸŒ Using browser DecompressionStream for gzip decompression"),typeof DecompressionStream>"u")throw new Error("DecompressionStream not supported and pako not available");const n=new ReadableStream({start(p){p.enqueue(new Uint8Array(e)),p.close()}}).pipeThrough(new DecompressionStream("gzip")),r=[],o=n.getReader();for(;;){const{done:p,value:C}=await o.read();if(p)break;r.push(C)}const c=r.reduce((p,C)=>p+C.length,0),d=new Uint8Array(c);let l=0;for(const p of r)d.set(p,l),l+=p.length;return d.buffer}catch(s){throw console.error("Failed to decompress gzip data:",s),new Error(`Gzip decompression failed: ${s.message}`)}}};j(v,"instances",new Map);let A=v,D={};function ce(i,e,s){var d,l,p,C,T,B,E,F,I,J,N,V,G,P,R,Y,K,_;const t=[...i],n=s==="star"||s==="light",r=s==="ming",o=s==="wafel";if(s==="ling"){const a=t.length,f=t[0],k=t[1]||"",S=t[2]||"",m=t[a-1],U=u=>{var q;return((q=e.get(u))==null?void 0:q.ma)||""},y=U(f),b=U(m),H=u=>u.length===2,L=u=>u[0]||"",Q=u=>u.length===3?u[1]:"",W=u=>u[u.length-1]||"",ee=H(y),Z=H(b),g=L(y),O=Q(y),X=W(y),$=L(U(k)),te=L(U(S)),w=L(b),z=Q(b),x=W(b);let h="";return ee?a===1?h=g.toUpperCase()+X:a===2?Z?h=g.toUpperCase()+w.toUpperCase()+x:h=g.toUpperCase()+w.toUpperCase()+z+x:a===3?Z?h=g.toUpperCase()+$.toUpperCase()+w.toUpperCase()+x:h=g.toUpperCase()+$.toUpperCase()+w.toUpperCase()+z:h=g.toUpperCase()+$.toUpperCase()+te.toUpperCase()+w.toUpperCase():a===1?h=g.toUpperCase()+O+X:a===2?Z?h=g.toUpperCase()+O+w.toUpperCase()+x:h=g.toUpperCase()+O+w.toUpperCase()+z:h=g.toUpperCase()+O+$.toUpperCase()+w.toUpperCase(),h}else if(r){let a=[];const f=t[0],k=t[t.length-1];t.length==1?a.push((((l=(d=e.get(f))==null?void 0:d.ma)==null?void 0:l[0])||"?").toUpperCase()):a.push((((C=(p=e.get(f))==null?void 0:p.ma)==null?void 0:C.slice(0,-1))||"?").toUpperCase()),a.push(...t.slice(1).map(m=>{var U,y;return(((y=(U=e.get(m))==null?void 0:U.ma)==null?void 0:y[0])||"?").toUpperCase()}));const S=m=>m.length===2?m[0].toUpperCase()+m[1]:m;return a.push(S(((B=(T=e.get(k))==null?void 0:T.ma)==null?void 0:B.slice(1))||"?")),a.join("").slice(0,5)}else if(o){let a=[];if(t.length>=1&&a.push(((F=(E=e.get(t[0]))==null?void 0:E.ma)==null?void 0:F[0])||"?"),t.length>=2&&a.push(((J=(I=e.get(t[1]))==null?void 0:I.ma)==null?void 0:J[0])||"?"),t.length>=3){const f=t[t.length-1];a.push(((V=(N=e.get(f))==null?void 0:N.ma)==null?void 0:V[0])||"?")}if(a.length<3){const f=t[t.length-1];a.push(((P=(G=e.get(f))==null?void 0:G.ma)==null?void 0:P[1])||"?")}return a.join("")}else{let a=t.map(f=>{var k,S;return((S=(k=e.get(f))==null?void 0:k.ma)==null?void 0:S[0])||"?"});if(a.length<4){const f=t[t.length-1];a.push(((Y=(R=e.get(f))==null?void 0:R.ma)==null?void 0:Y[1])||"?")}if(a.length<4&&n){const f=t[0];a.push(((_=(K=e.get(f))==null?void 0:K.ma)==null?void 0:_[1])||"?")}return a.join("")}}async function M(i){if(i in D)return D[i];try{const s=await(await fetch(ne(i))).text(),t=ae(s);return D[i]=t,t}catch(e){throw e instanceof Error&&alert(`ç„¡æ³•ä¸‹è¼‰æˆ–è§£æã€Š${i}ã€‹æ–‡ä»¶ï¼š${e.cause}`),e}}function ae(i){const e=i.split(`
`),t=e.shift().split(",").map(o=>o.trim()),n=t.length,r=new Map;for(let o of e){if(o=o.trim(),!o)continue;const c=o.split(",").map(l=>l.trim());if(c.length<n)for(;c.length<n;)c.push("");else if(c.length>n)throw new Error(`CSVæ–‡ä»¶ä¸­ ${o} æ•¸æ“šéå¤šï¼ŒæœŸæœ› ${n} åˆ—ï¼Œå®é™… ${c.length} åˆ—ã€‚`);const d={};for(let l=0;l<n;l++)d[t[l]]=c[l]||"";r.set(c[0],d)}return r}async function le(i){return await M(i)}async function pe(i){const e=`optimized_${i}`;if(e in D)return D[e];try{const t=await A.getInstance(i).loadData(),n=new Map;for(const[r,o]of Object.entries(t))n.set(r,{char:r,division:o.d||"",division_tw:o.dt||"",region:o.r||""});return console.log(`âœ… æˆåŠŸä½¿ç”¨å£“ç¸®JSONæ ¼å¼åŠ è¼‰æ‹†åˆ†æ•¸æ“š: ${n.size} ä¸ªå­—ç¬¦`),D[e]=n,n}catch(s){console.warn("JSONæ ¼å¼åŠ è¼‰å¤±æ•—ï¼Œå›é€€åˆ°CSVæ ¼å¼:",s);try{const t=await M(i);return console.log(`âš ï¸ ä½¿ç”¨CSVæ ¼å¼åŠ è¼‰æ‹†åˆ†æ•¸æ“š: ${t.size} å€‹å­—ç¬¦`),D[e]=t,t}catch(t){throw console.error("CSVæ ¼å¼ä¹ŸåŠ è¼‰å¤±æ•—:",t),t}}}export{A as C,le as a,pe as b,D as c,M as f,ce as m};
