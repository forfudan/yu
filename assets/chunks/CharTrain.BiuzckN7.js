import{d as me,E as y,h as k,k as S,l as ye,R as $,ab as be,v as he,c as d,o as u,F as H,e as F,m as t,t as x,n,O as R,p as A,C as re,b as ke,a5 as we,a6 as Ce,a as W,a0 as ze,a2 as _e,_ as Le}from"./framework.Cer6JMjx.js";import{b as Me,f as Ve,m as je,c as ne}from"./share.BY2UUWNL.js";import{A as le}from"./advancedSchedule.ChzbWpT_.js";import{_ as Ee}from"./MultiChaifen.vue_vue_type_script_setup_true_lang.D7r_G_eT.js";import{u as Ie,a as Se,b as Fe,c as Ae,d as Te,i as Ue}from"./cascadeStyles.Dn7anMP-.js";/* empty css                                                                  */const $e={key:0,class:"text-gray-700 dark:text-gray-300 text-center"},Re={key:1,class:"text-center py-16"},We={class:"mb-8"},Ne={class:"text-xl text-gray-600 dark:text-gray-400 mb-8"},Be={class:"relative"},Pe={key:0,class:"text-red-600 dark:text-red-400"},De={class:"relative h-full flex items-center overflow-visible"},Oe={class:"flex tracking-widest flex-col opacity-80"},Ge={class:"font-mono text-blue-600 dark:text-blue-400"},He={class:"flex items-center gap-1"},Ke={class:"flex items-center gap-1"},Ze={key:1,class:"text-blue-600 dark:text-blue-400 font-medium"},Xe={class:"zigen-font"},qe={class:"font-mono"},Je=me({__name:"CharTrain",props:{name:{},chaifenUrl:{},zigenUrl:{},range:{},rule:{},mabiaoUrl:{},popLevel:{}},setup(oe){const g=oe;let C=g.name+"_char";const w=g.range;w&&(C+=`_${w[0]}_${w[1]}`);const c=y(ne[C]),p=y(),z=y(),_=y(new Map);let i;const o=y({name:"",key:""}),b=k(0),L=k(),f=y(!0),m=y(!0),N=y(!1),M=y(""),T=k(0),V=k(!1),U=k(0);async function ie(){if(!g.mabiaoUrl)return;const s=g.popLevel??0;if(s===0)return;const e=new Set(["a","e","i","o","u"]),l=new Map;try{const P=(await(await fetch(g.mabiaoUrl)).text()).split(`
`);for(const E of P){const D=E.trim();if(!D)continue;const[h,I]=D.split("	");if(!h||!I)continue;const O=h.toLowerCase();if(O.length<=s&&e.has(O[O.length-1])&&I.length===1){const G=I;(!l.has(G)||h.length<l.get(G).length)&&l.set(G,h)}}_.value=l}catch(a){console.error("Failed to load mabiao:",a)}}const r=k(typeof window<"u"?window.innerWidth:1024),K=k(),Z=()=>{r.value=window.innerWidth},X=Ie(K,r),ue=Se(r),de=Fe(r),q=Ae(c,b),ce=Te(q),J=s=>Ue(s,ue.value),ve=S(()=>{const s=r.value<768,e=r.value<1024;return s?"text-6xl":e?"text-8xl":"text-9xl"}),j=S(()=>{var e;T.value;const s=(i==null?void 0:i.getProgressStats())||{practiced:0,total:((e=c.value)==null?void 0:e.length)||0,mastered:0,percentage:0};return{current:s.practiced,total:s.total,mastered:s.mastered,percentage:s.percentage.toFixed(1)}}),Q=S(()=>{if(!o.value||!p.value||!z.value)return!1;const s=p.value.get(o.value.name);return!s||!s.division?!1:Array.from(s.division).some(l=>{var v;const a=(v=z.value)==null?void 0:v.get(l);return(a==null?void 0:a.pinyin)&&a.pinyin.trim()!==""&&a.pinyin!=="Ã˜"})}),xe=S(()=>{if(!Q.value||!o.value||!p.value||!z.value)return[];const s=p.value.get(o.value.name);return!s||!s.division?[]:Array.from(s.division).map(l=>{var v;const a=(v=z.value)==null?void 0:v.get(l);return{font:l,pinyin:(a==null?void 0:a.pinyin)||""}}).filter(l=>l.pinyin&&l.pinyin.trim()!==""&&l.pinyin!=="Ã˜")}),Y=S(()=>{if(!o.value||!_.value||_.value.size===0)return null;const s=_.value.get(o.value.name);return s&&s.toLowerCase()!==o.value.key.toLowerCase()&&s.length!==o.value.key.length?s:null});ye(async()=>{if(await ie(),c.value&&p.value){i=new le(C),i.initializeWithGroupCount(c.value.length);const a=i.getNextIndex();a!==null&&(b.value=a,o.value=c.value[a],f.value=i.isFirstTime(a)),$(()=>{var v;(v=L.value)==null||v.focus()});return}p.value=await Me(g.chaifenUrl);const s=await Ve(g.zigenUrl);z.value=s;let e=[...p.value.values()];w&&(e=e.slice(w[0],w[1])),c.value=e.map(a=>({name:a.char,key:je(a.division,s,g.rule)})),ne[C]=c.value,i=new le(C),i.initializeWithGroupCount(c.value.length);const l=i.getNextIndex();l!==null&&(b.value=l,o.value=c.value[l],f.value=i.isFirstTime(l)),$(()=>{var a;(a=L.value)==null||a.focus()}),typeof window<"u"&&window.addEventListener("resize",Z),document.addEventListener("keydown",se)}),be(()=>{typeof window<"u"&&window.removeEventListener("resize",Z),document.removeEventListener("keydown",se)}),he(M,s=>{var h;if(!o.value)return;const e=s.trim().toLowerCase(),l=o.value.key.toLowerCase(),a=(h=_.value.get(o.value.name))==null?void 0:h.toLowerCase(),v=a&&a!==l,P=g.popLevel??0;let E=!1;if(P>0){const I=/[aeiou]/.test(e);E=e.length>=l.length||I}else E=e.length>=l.length||v&&e.length>=a.length;if(!E)return;e===l||v&&e===a?fe():f.value||pe()});const fe=()=>{o.value&&(m.value=!0,i.recordSuccess(b.value),T.value++,ee())},pe=()=>{o.value&&(m.value=!1,U.value++,f.value=!1,i.recordFailure(b.value),T.value++,M.value="",$(()=>{var s;(s=L.value)==null||s.focus()}))},ee=()=>{const s=i.getNextIndex();if(s!==null)b.value=s,o.value=c.value[s];else{N.value=!0;return}m.value=!0,U.value=0,M.value="",i.isFirstTime(b.value)?f.value=!0:f.value=!1,$(()=>{var e;(e=L.value)==null||e.focus()})};function te(){c.value&&(i.reset(),i.initializeWithGroupCount(c.value.length),N.value=!1,T.value++,ee())}const ge=()=>{V.value=!0},ae=()=>{te(),V.value=!1},B=()=>{V.value=!1},se=s=>{if(V.value){s.key==="Enter"?ae():s.key==="Escape"&&B();return}s.key==="Escape"&&!f.value&&(f.value=!0,s.preventDefault())};return(s,e)=>{var l;return u(),d(H,null,[!c.value||!p.value?(u(),d("h2",$e," ä¸‹è¼‰æ•¸æ“šä¸­â€¦â€¦ ")):N.value?(u(),d("div",Re,[t("div",We,[e[2]||(e[2]=t("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),e[3]||(e[3]=t("h2",{class:"text-4xl font-bold mb-2"},"æ­å–œä½ å®Œæˆç·´ç¿’ï¼",-1)),t("p",Ne," ä½ å·²ç¶“å®Œæˆäº† "+x(c.value.length)+" å€‹å–®å­—çš„ç·´ç¿’ã€‚ æ„Ÿè¬ä½ çš„åŠªåŠ›å’Œå …æŒï¼Œç‚ºä¸­è¯æ–‡æ˜å’Œæ¼¢å­—çš„å‚³æ‰¿åˆå¢æ·»äº†ä¸€ä»½åŠ›é‡ï¼ ",1)]),t("div",{class:"space-y-4"},[t("button",{onClick:te,class:"px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 font-medium"}," æƒ³è¦å†è¨“ç·´ä¸€è¼ªå—ï¼Ÿ "),e[4]||(e[4]=t("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," ç¹¼çºŒç·´ç¿’ä»¥éå›ºè¨˜æ†¶ ",-1))])])):(u(),d("div",{key:2,class:n(["mx-auto p-6 space-y-6",r.value<768?"max-w-sm p-3 space-y-3":"max-w-2xl"])},[t("div",Be,[t("div",{class:n(["text-center text-gray-600 dark:text-gray-400",r.value<768?"text-xs":"text-sm"])},[t("div",{class:n(["flex justify-between items-center",r.value<768?"mb-1":"mb-2"])},[t("span",null,"å·²ç·´ç¿’: "+x(j.value.current)+" / "+x(j.value.total)+" ("+x(j.value.percentage)+"%) | å·²æŒæ¡: "+x(j.value.mastered),1),U.value>0?(u(),d("span",Pe,"éŒ¯èª¤æ¬¡æ•¸: "+x(U.value),1)):F("",!0)],2),t("div",{class:n(["w-full bg-gray-200 dark:bg-gray-700 rounded-full",r.value<768?"h-1.5":"h-2"])},[t("div",{class:n(["bg-blue-500 dark:bg-blue-400 rounded-full transition-all duration-300",r.value<768?"h-1.5":"h-2"]),style:R(`width: ${j.value.percentage}%`)},null,6)],2)],2)]),t("div",{class:n(["w-full shadow-lg rounded-2xl transition-all duration-300 transform relative overflow-hidden",{"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":!m.value,"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":m.value},"border-2 hover:shadow-xl"])},[t("div",{ref_key:"cascadeContainer",ref:K,class:"relative overflow-hidden py-3",style:R({height:r.value<768?"60px":"70px"})},[t("div",De,[t("div",{class:"flex items-center h-full transition-transform duration-500 ease-out",style:R({transform:`translateX(${(A(de)-A(ce))*A(X)}px)`})},[(u(!0),d(H,null,re(A(q),a=>(u(),d("div",{key:a.index,class:n(["flex-shrink-0 flex items-center justify-center transition-all duration-500","cascade-item",{"cascade-current scale-110 font-bold":a.isCurrent,"cascade-side opacity-40 scale-75":!a.isCurrent&&J(a.offset),"opacity-0 scale-50":!J(a.offset)}]),style:R({width:`${A(X)}px`})},[t("span",{class:n(["zigen-font text-2xl md:text-3xl select-none",{"text-blue-700 dark:text-blue-300":a.isCurrent,"text-gray-500 dark:text-gray-500":!a.isCurrent}])},x(a.item.name),3)],6))),128))],4)])],4),e[8]||(e[8]=t("div",{class:"border-b border-gray-200 dark:border-gray-700"},null,-1)),t("div",{class:n(["absolute flex gap-2 z-10",r.value<768?"bottom-2 right-2":"bottom-4 right-4"])},[t("button",{onClick:ge,class:n(["rounded-full bg-red-500 hover:bg-red-600 text-white font-medium transition-all duration-200 flex items-center justify-center shadow-md",r.value<768?"w-6 h-6 text-xs":"w-8 h-8 text-xs"]),title:"é‡æ–°é–‹å§‹è¨“ç·´"},[(u(),d("svg",{class:n(r.value<768?"w-2 h-2":"w-3 h-3"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[5]||(e[5]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],2)],2),t("div",{class:n(["text-center flex items-center justify-center",r.value<768?"h-40 py-4":"h-56 py-8"])},[t("div",{class:n(["flex items-center justify-center",r.value<768?"gap-4":"gap-8"])},[t("div",{class:n(["zigen-font transform transition-all duration-300",ve.value,{"text-red-500 dark:text-red-400":!m.value,"text-blue-700 dark:text-blue-300":m.value}])},x(o.value.name),3),t("div",Oe,[(u(),ke(Ee,{chars:o.value.name,size:r.value<768?80:120,key:o.value.name,loc:""},null,8,["chars","size"]))])],2)],2),t("div",{class:n(["flex justify-center",r.value<768?"pt-2 pb-3":"pt-4 pb-8"])},[we(t("input",{ref_key:"inputElement",ref:L,"onUpdate:modelValue":e[0]||(e[0]=a=>M.value=a),type:"text",placeholder:"ç·¨ç¢¼",class:n(["text-center border-2 rounded-xl font-mono","transition-all duration-300 focus:outline-none focus:ring-4",r.value<768?"px-3 py-2 text-lg w-32":"px-6 py-4 text-2xl w-48",{"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50 dark:border-red-700 dark:focus:border-red-500 dark:focus:ring-red-900/50 dark:bg-red-900/20 dark:text-white":!m.value,"border-blue-300 focus:border-blue-500 focus:ring-blue-200 bg-white dark:border-blue-700 dark:focus:border-blue-500 dark:focus:ring-blue-900/50 dark:bg-gray-800 dark:text-white":m.value}])},null,2),[[Ce,M.value]])],2),t("div",{class:n(["text-center transition-all duration-300",r.value<768?"pb-3":"pb-8",{"opacity-0 transform translate-y-2":!f.value,"opacity-100":f.value}])},[t("div",{class:n(["inline-block bg-gray-100 dark:bg-gray-800 rounded-lg",r.value<768?"px-2 py-1":"px-4 py-2"])},[t("span",{class:n(["text-gray-800 dark:text-gray-200",r.value<768?"text-sm":""])},"ç­”æ¡ˆæ˜¯ ",2),t("span",{class:n(["font-mono font-bold text-blue-600 dark:text-blue-400",r.value<768?"text-lg":"text-xl"])},x(o.value.key),3),p.value?(u(),d("span",{key:0,class:n(["text-gray-600 dark:text-gray-400 ml-2",r.value<768?"text-xs":"text-sm"])},"ï¼ˆ"+x((l=p.value.get(o.value.name))==null?void 0:l.division)+"ï¼‰",3)):F("",!0)],2),Y.value?(u(),d("div",{key:0,class:n(["text-gray-500 dark:text-gray-400 mt-2",r.value<768?"text-xs":"text-sm"])},[e[6]||(e[6]=W(" ä¹Ÿå¯ä»¥ä½¿ç”¨ç°¡ç¢¼ ",-1)),t("b",Ge,x(Y.value),1),e[7]||(e[7]=W(" ç›´æ¥ä¸Šå± ",-1))],2)):F("",!0)],2)],2),t("div",{class:n(["text-center text-gray-500 dark:text-gray-400 space-y-1",r.value<768?"text-xs":"text-sm"])},[f.value?(u(),d("div",Ze," ç¹¼çºŒè¼¸å…¥æ­£ç¢ºç·¨ç¢¼ ")):(u(),d("div",{key:0,class:n(["flex items-center justify-center",r.value<768?"gap-2 flex-col":"gap-4"])},[t("span",He,[t("kbd",{class:n(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",r.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"è¼¸å…¥",2),e[9]||(e[9]=W(" è‡ªå‹•æª¢æŸ¥ ",-1))]),t("span",Ke,[t("kbd",{class:n(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",r.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"Esc",2),e[10]||(e[10]=W(" é¡¯ç¤ºç­”æ¡ˆ ",-1))])],2))],2),Q.value?(u(),d("div",{key:0,class:n(["mx-auto max-w-md mt-4",r.value<768?"max-w-xs mt-2":"max-w-md mt-4"])},[t("div",{class:n(["border-2 border-dashed border-blue-300 dark:border-blue-600 rounded-lg bg-blue-50 dark:bg-blue-900/20 p-3 transition-all duration-300",r.value<768?"p-2":"p-3"])},[t("div",{class:n(["text-center font-medium text-blue-800 dark:text-blue-300 mb-2",r.value<768?"text-xs mb-1":"text-sm mb-2"])}," æ‹¼éŸ³åˆ°éŸ³æ‰˜ä¹‹é—œä¿‚è§£æ ",2),t("div",{class:n(["text-center space-y-1",r.value<768?"text-xs space-y-0.5":"text-sm space-y-1"])},[(u(!0),d(H,null,re(xe.value,(a,v)=>(u(),d("div",{key:`${a.font}-${a.pinyin}-${v}`,class:n(["text-blue-700 dark:text-blue-300"])},[t("span",Xe,x(a.font),1),t("span",qe," ("+x(a.pinyin)+")",1)]))),128))],2)],2)],2)):F("",!0)],2)),V.value?(u(),d("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:B},[t("div",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm mx-4 shadow-xl",onClick:e[1]||(e[1]=ze(()=>{},["stop"]))},[e[11]||(e[11]=_e('<div class="flex items-center gap-3 mb-4" data-v-affa72d7><div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center" data-v-affa72d7><svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-affa72d7><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-affa72d7></path></svg></div><div data-v-affa72d7><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100" data-v-affa72d7>ç¢ºèªé‡ç½®</h3><p class="text-sm text-gray-600 dark:text-gray-400" data-v-affa72d7>æ‚¨ç¢ºå®šè¦é‡æ–°é–‹å§‹è¨“ç·´å—ï¼Ÿ</p></div></div><p class="text-sm text-gray-600 dark:text-gray-400 mb-6" data-v-affa72d7> é€™å°‡æ¸…é™¤ç•¶å‰çš„å­¸ç¿’é€²åº¦å’Œçµ±è¨ˆæ•¸æ“šï¼Œç„¡æ³•æ¢å¾©ã€‚ </p>',2)),t("div",{class:"flex gap-3 justify-end"},[t("button",{onClick:B,class:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"}," å–æ¶ˆ "),t("button",{onClick:ae,class:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors"}," ç¢ºèªé‡ç½® ")])])])):F("",!0)],64)}}}),rt=Le(Je,[["__scopeId","data-v-affa72d7"]]);export{rt as T};
