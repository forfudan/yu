import{f as ae}from"./share.DAxIUpi5.js";import{C as Y}from"./ChaiDataLoader.DYi6iwdM.js";import{d as ce,am as de,k as D,h as f,l as G,A as ue,y as J,o as e,c as s,e as y,m as l,n as I,F as p,E as g,Q as ee,t as h,q as re,s as ve,_ as he}from"./framework.DTi27XpN.js";const v=M=>(re("data-v-94185533"),M=M(),ve(),M),_e={class:"zigen-map-container"},fe={key:0,class:"flex justify-center items-center py-8"},pe=v(()=>l("div",{class:"loading loading-spinner loading-lg"},null,-1)),ge=v(()=>l("span",{class:"ml-2"},"正在加载字根数据...",-1)),me=[pe,ge],ye={key:1,class:"flex justify-between items-center mb-4"},xe=v(()=>l("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),ke={key:0,class:"flex items-center space-x-2"},be=v(()=>l("span",{class:"text-xs text-gray-400"},"布局：",-1)),ze=["title"],we={key:0},Ce={key:1},$e={key:2,class:"keyboard-layout"},Ze={class:"key-label"},Le=["onMouseenter","onClick"],Se={class:"zigen-font"},Me={class:"zigen-code"},Ee={key:0,class:"more-indicator"},Ue={key:1,class:"text-xs text-gray-400 no-zigen-text"},Pe={key:0,class:"vertical-text zigen-font"},De=v(()=>l("div",null,"引導特殊符號",-1)),Ie=v(()=>l("div",null,"切換多重註解",-1)),Be=[De,Ie],je={key:1,class:"vertical-text zigen-font"},Ke=v(()=>l("div",null,"引導拼音反查",-1)),We=v(()=>l("div",null,"引導歷史輸入",-1)),Ve=[Ke,We],Fe={key:2,class:"vertical-text zigen-font"},Ne=v(()=>l("div",null,null,-1)),qe=v(()=>l("div",null,"一碼上屏字　了",-1)),He=[Ne,qe],Te={key:3,class:"vertical-text zigen-font"},Ae=v(()=>l("div",null,null,-1)),Oe=v(()=>l("div",null,"一碼上屏字　的",-1)),Qe=[Ae,Oe],Re={key:4,class:"vertical-text zigen-font"},Xe=v(()=>l("div",null,null,-1)),Ye=v(()=>l("div",null,"一碼上屏字　是",-1)),Ge=[Xe,Ye],Je={key:5,class:"vertical-text zigen-font"},es=v(()=>l("div",null,null,-1)),ss=v(()=>l("div",null,"一碼上屏字　我",-1)),ns=[es,ss],ts={key:6,class:"vertical-text zigen-font"},os=v(()=>l("div",null,null,-1)),ls=v(()=>l("div",null,"一碼上屏字　不",-1)),is=[os,ls],as={key:7,class:"vertical-text single-line zigen-font"},cs={class:"mobile-key-label"},ds={key:0,class:"mobile-zigen-container"},us={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},rs=["onClick"],vs={class:"zigen-font"},hs={class:"zigen-code"},_s={key:1,class:"mobile-no-zigen"},fs={key:0,class:"mobile-key-desc zigen-font"},ps={key:1,class:"mobile-key-desc zigen-font"},gs={key:2,class:"mobile-key-desc zigen-font"},ms={key:3,class:"mobile-key-desc zigen-font"},ys={class:"popup-container"},xs={class:"popup-body"},ks={class:"popup-title"},bs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},zs={class:"zigen-header-inline current-zigen"},ws={class:"zigen-font"},Cs={key:0,class:"example-chars-same-line"},$s={key:1,class:"example-chars-same-line"},Zs=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ls=[Zs],Ss={class:"zigen-header-inline other-zigen"},Ms={class:"zigen-font"},Es={key:0,class:"example-chars-same-line"},Us={key:1,class:"example-chars-same-line"},Ps=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Ds=[Ps],Is={key:5,class:"pinned-popup"},Bs={class:"popup-container"},js={class:"popup-body"},Ks={class:"popup-header"},Ws={class:"popup-title"},Vs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},Fs={class:"zigen-header-inline current-zigen"},Ns={class:"zigen-font"},qs={key:0,class:"example-chars-same-line"},Hs={key:1,class:"example-chars-same-line"},Ts=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),As=[Ts],Os={class:"zigen-header-inline other-zigen"},Qs={class:"zigen-font"},Rs={key:0,class:"example-chars-same-line"},Xs={key:1,class:"example-chars-same-line"},Ys=v(()=>l("span",{class:"loading-text"},"正在加載...",-1)),Gs=[Ys],Js=ce({__name:"ZigenMap",props:{defaultScheme:{},hideSchemeButtons:{type:Boolean},columnMinWidth:{}},setup(M){const j=M,se=de(j,"columnMinWidth"),ne=D(()=>`repeat(auto-fill, minmax(${se.value||"2rem"}, max-content))`),q=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],$=["'"],E=f(!1),k=f(!1),K=()=>{E.value=window.innerWidth<1280},te=()=>{k.value=!k.value};G(()=>{K(),window.addEventListener("resize",K)}),ue(()=>{window.removeEventListener("resize",K)});const H=D(()=>q.flat());function W(a){return{zigenUrl:`/zigen-${a}.csv`,chaifenUrl:"/chaifen.json"}}const B=D(()=>j.defaultScheme||"star"),_=f(),b=f(),Z=f(!1),U=f(null),z=f(null),V=f({x:0,y:0}),w=f({}),P=f(null),L=f(null),C=f({}),S=f(!1);J(()=>j.defaultScheme,()=>{b.value=null});const F=D(()=>{var r;if(!_.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",_.value.size);const a={},d=[];for(const[u,t]of _.value){const c=t.font,o=(r=t.ma)==null?void 0:r.trim();if(!o||o.length===0||c==null)continue;const n=o[0].toLowerCase(),i=o.slice(1);d.push({font:c,ma:o,firstLetter:n,code:i})}console.log(`Found ${d.length} valid zigens`);for(let u=0;u<d.length;u++){const t=d[u],{font:c,ma:o,firstLetter:n,code:i}=t;a[n]||(a[n]={visible:[],hidden:[]});const m=u>0?d[u-1]:null,x=m&&m.code===i&&m.firstLetter===n;a[n].visible.find(ie=>ie.code===i)?x?a[n].hidden.push({font:c,code:i}):a[n].visible.push({font:c,code:i}):a[n].visible.push({font:c,code:i})}return console.log("Final result:",a),a}),T=D(()=>{var d;if(!_.value)return{};const a={};for(const r of H.value)a[r]=[];for(const[r,u]of _.value){const t=u.font,c=(d=u.ma)==null?void 0:d.trim();if(!c||t===null||t===void 0)continue;const o=c[0].toLowerCase(),n=c.slice(1),i=a[o].some(m=>m.code===n);a[o].push({font:t,code:n,isHidden:i})}return a}),A=async a=>{var d;if(!b.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${a}" 搜索例字...`);const r=new Promise((i,m)=>{setTimeout(()=>m(new Error("數據加載超時")),1e4)}),u=await Promise.race([b.value.loadData(),r]),t=[],c=a.normalize("NFC");console.log(`搜索字根: "${c}"`);const o=Object.entries(u).slice(0,3);console.log("數據樣本:",o);let n=0;for(const[i,m]of Object.entries(u)){n++;const x=m;if(n<=5&&console.log(`字符 "${i}" 的拆分數據:`,x.d),(d=x.d)!=null&&d.includes(c)&&(console.log(`✅ 找到匹配: "${i}" 包含字根 "${c}", 拆分: "${x.d}"`),t.push(i),t.length>=20))break;n%1e3===0&&console.log(`已檢查 ${n} 個字符，找到 ${t.length} 個例字`)}return console.log(`字根 "${c}" 最終找到例字:`,t.slice(0,5),`(總共${t.length}個)`),t}catch(r){return console.error("获取例字失败:",r),r instanceof Error&&r.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function O(){Z.value=!0;try{const a=W(B.value),d=await ae(a.zigenUrl);_.value=d,console.log(`已加載字根數據，文件: ${a.zigenUrl}`),console.log("注意：拆分數據將在第一次懸停字根時才加載")}catch(a){console.error("加载字根数据失败:",a)}finally{Z.value=!1}}async function oe(a,d){var o;if(U.value=d.font,V.value={x:a.clientX,y:a.clientY},!b.value){console.log("第一次懸停，正在初始化拆分數據加載器...");const n=W(B.value);b.value=Y.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}let r="";if(_.value){for(const[n,i]of _.value)if(i.font===d.font&&((o=i.ma)==null?void 0:o.slice(1))===d.code){r=i.ma;break}}const u=X(d.font,r);z.value=u,console.log("開始獲取例字，字根數量:",[...u.visible,...u.hidden].length);const t={},c=[...u.visible,...u.hidden];for(const n of c){console.log(`正在獲取字根 "${n.font}" 的例字...`);const i=await A(n.font);console.log(`字根 "${n.font}" 找到例字:`,i.length,"個"),t[n.font]=i.slice(0,8)}w.value=t}function le(){S.value||(U.value=null,z.value=null,w.value={})}function Q(a){switch(a){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function R(a,d){var o;if(a.stopPropagation(),!b.value){console.log("點擊時初始化拆分數據加載器...");const n=W(B.value);b.value=Y.getInstance(n.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${n.chaifenUrl}`)}if(S.value&&P.value===d.font){N();return}P.value=d.font,S.value=!0;let r="";if(_.value){for(const[n,i]of _.value)if(i.font===d.font&&((o=i.ma)==null?void 0:o.slice(1))===d.code){r=i.ma;break}}const u=X(d.font,r);L.value=u,console.log("開始獲取例字，字根數量:",[...u.visible,...u.hidden].length);const t={},c=[...u.visible,...u.hidden];for(const n of c){console.log(`正在獲取字根 "${n.font}" 的例字...`);const i=await A(n.font);console.log(`字根 "${n.font}" 找到例字:`,i.length,"個"),t[n.font]=i.slice(0,10)}C.value=t,console.log(`固定彈窗 - 字根 "${d.font}" 的最終例字:`,C.value),U.value=null,z.value=null,w.value={}}function N(){S.value=!1,P.value=null,L.value=null,C.value={}}function X(a,d){var t;const r=[],u=[];if(!_.value||!d)return{visible:r,hidden:u};for(const[c,o]of _.value){const n=o.font,i=(t=o.ma)==null?void 0:t.trim();!i||!n||n===null||n===void 0||i===d&&(n===a?r.unshift({font:n,code:i}):u.push({font:n,code:i}))}return{visible:r,hidden:u}}return J(()=>B.value,O),G(()=>{O(),document.addEventListener("click",a=>{if(S.value){const d=document.querySelector(".pinned-popup");d&&!d.contains(a.target)&&N()}})}),(a,d)=>{var r,u;return e(),s("div",_e,[Z.value?(e(),s("div",fe,me)):y("",!0),Z.value?y("",!0):(e(),s("div",ye,[xe,E.value?y("",!0):(e(),s("div",ke,[be,l("button",{onClick:te,class:I(["layout-toggle-btn",{"layout-toggle-active":k.value}]),title:k.value?"切換為網格布局":"切換為列表布局"},[k.value?(e(),s("span",Ce,"⊞")):(e(),s("span",we,"☰"))],10,ze)]))])),!Z.value&&_.value&&!E.value&&!k.value?(e(),s("div",$e,[(e(),s(p,null,g(q,(t,c)=>l("div",{key:c,class:"keyboard-row"},[(e(!0),s(p,null,g(t,o=>{var n;return e(),s("div",{key:o,class:I(["keyboard-key",{"empty-key":$.includes(o)}])},[l("div",Ze,h(o.toUpperCase()),1),!$.includes(o)&&((n=F.value[o])==null?void 0:n.visible.length)>0?(e(),s("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:ee({gridTemplateColumns:ne.value})},[(e(!0),s(p,null,g(F.value[o].visible,(i,m)=>(e(),s("span",{key:m,class:"zigen-item",onMouseenter:x=>oe(x,i),onMouseleave:le,onClick:x=>R(x,i)},[l("span",Se,h(i.font),1),l("span",Me,h(i.code),1)],40,Le))),128)),F.value[o].hidden.length>0?(e(),s("span",Ee,"⋯")):y("",!0)],4)):$.includes(o)?y("",!0):(e(),s("div",Ue,[o==="/"?(e(),s("div",Pe,Be)):o==="z"?(e(),s("div",je,Ve)):o==="a"?(e(),s("div",Fe,He)):o==="e"?(e(),s("div",Te,Qe)):o==="i"?(e(),s("div",Re,Ge)):o==="o"?(e(),s("div",Je,ns)):o==="u"?(e(),s("div",ts,is)):(e(),s("div",as,h(Q(o)),1))]))],2)}),128))])),64))])):y("",!0),!Z.value&&_.value&&(E.value||k.value)?(e(),s("div",{key:3,class:I(["mobile-layout",{"desktop-list-layout":!E.value&&k.value}])},[(e(!0),s(p,null,g(H.value,t=>{var c;return e(),s("div",{key:t,class:I(["mobile-key-row",{"empty-mobile-key":$.includes(t)}])},[l("div",cs,h(t.toUpperCase()),1),!$.includes(t)&&((c=T.value[t])==null?void 0:c.length)>0?(e(),s("div",ds,[l("div",us,[(e(!0),s(p,null,g(T.value[t],(o,n)=>(e(),s("span",{key:`sorted-${n}`,class:I(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:i=>R(i,o)},[l("span",vs,h(o.font),1),l("span",hs,h(o.code),1)],10,rs))),128))])])):$.includes(t)?y("",!0):(e(),s("div",_s,[t==="/"?(e(),s("span",fs,"引導特殊符號")):t==="z"?(e(),s("span",ps,"引導拼音反查")):["a","e","i","o","u"].includes(t)?(e(),s("span",gs," 一碼上屏字 ")):(e(),s("span",ms,h(Q(t)),1))]))],2)}),128))],2)):y("",!0),U.value&&z.value?(e(),s("div",{key:4,class:"hover-card",style:ee({left:V.value.x+10+"px",top:V.value.y+10+"px"})},[l("div",ys,[l("div",xs,[l("h3",ks," 編碼 "+h(((r=z.value.visible[0])==null?void 0:r.code)||U.value)+" 上的字根 ",1),l("div",bs,[(e(!0),s(p,null,g(z.value.visible,(t,c)=>{var o;return e(),s("div",{key:`visible-${c}`,class:"zigen-row-inline"},[l("div",zs,[l("span",ws,h(t.font),1)]),((o=w.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Cs,[(e(!0),s(p,null,g(w.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",$s,Ls))])}),128)),(e(!0),s(p,null,g(z.value.hidden,(t,c)=>{var o;return e(),s("div",{key:`hidden-${c}`,class:"zigen-row-inline"},[l("div",Ss,[l("span",Ms,h(t.font),1)]),((o=w.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Es,[(e(!0),s(p,null,g(w.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Us,Ds))])}),128))])])])],4)):y("",!0),S.value&&P.value&&L.value?(e(),s("div",Is,[l("div",Bs,[l("div",js,[l("div",Ks,[l("h3",Ws," 編碼 "+h(((u=L.value.visible[0])==null?void 0:u.code)||P.value)+" 上的字根 ",1),l("button",{onClick:N,class:"close-btn"},"✕")]),l("div",Vs,[(e(!0),s(p,null,g(L.value.visible,(t,c)=>{var o;return e(),s("div",{key:`pinned-visible-${c}`,class:"zigen-row-inline"},[l("div",Fs,[l("span",Ns,h(t.font),1)]),((o=C.value[t.font])==null?void 0:o.length)>0?(e(),s("div",qs,[(e(!0),s(p,null,g(C.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Hs,As))])}),128)),(e(!0),s(p,null,g(L.value.hidden,(t,c)=>{var o;return e(),s("div",{key:`pinned-hidden-${c}`,class:"zigen-row-inline"},[l("div",Os,[l("span",Qs,h(t.font),1)]),((o=C.value[t.font])==null?void 0:o.length)>0?(e(),s("div",Rs,[(e(!0),s(p,null,g(C.value[t.font].slice(0,8),n=>(e(),s("span",{key:n,class:"example-char zigen-font"},h(n),1))),128))])):(e(),s("div",Xs,Gs))])}),128))])])])])):y("",!0)])}}}),on=he(Js,[["__scopeId","data-v-94185533"]]);export{on as Z};
