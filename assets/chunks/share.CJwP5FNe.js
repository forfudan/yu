var Nt=Object.defineProperty;var qt=(v,f,y)=>f in v?Nt(v,f,{enumerable:!0,configurable:!0,writable:!0,value:y}):v[f]=y;var c=(v,f,y)=>qt(v,typeof f!="symbol"?f+"":f,y);function Ut(v){let f="";const y="ABCDEFGHIJKLMNOPQRSTVWXYUZbcdefghaoijklmnpqrstuvwxyz0123456789",S=y.length;let M=0;for(;M<v;)f+=y.charAt(Math.floor(Math.random()*S)),M+=1;return f}function Bt(v,f,y,S,M,C){var w=document.createElementNS("http://www.w3.org/2000/svg","svg");w.id=f,w.style.width=C+"px",w.style.height=C+"px",v.appendChild(w);var b=document.createElementNS("http://www.w3.org/2000/svg","g"),z=St.getScalingTransform(C,C);b.setAttributeNS(null,"transform",z.transform),w.appendChild(b);var T=0;let x=["#CECECE","#E53935","#FFA000","#2C96FF","#689F38","#F48FB1","#7E57C2","#BF360C","#00796B"];for(var P=0;P<S.length;P++)y.slice(T,T+S[P]).forEach(function(H){var I=document.createElementNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d",H),I.style.fill=x[M[P]],b.appendChild(I)}),T+=S[P]}function Vt(v,f,y=[99],S=[1,2,3,4,5,6,7,8,9,0],M=75){typeof window>"u"||typeof document>"u"||St.loadCharacterData(f).then(function(C){const w=document.getElementById(v);w&&Bt(w,f,C.strokes,y,S,M)}).catch(function(C){console.warn("Failed to load character data for:",f,C)})}var St=function(){var v;const f=typeof window>"u"?global:window,y=f.performance&&(()=>f.performance.now())||(()=>Date.now()),S=f.requestAnimationFrame||(s=>setTimeout(()=>s(y()),1e3/60)),M=f.cancelAnimationFrame||clearTimeout;function C(s){return s[s.length-1]}function w(s,t){const e={...s};for(const r in t){const i=s[r],o=t[r];i!==o&&(i&&o&&typeof i=="object"&&typeof o=="object"&&!Array.isArray(o)?e[r]=w(i,o):e[r]=o)}return e}let b=0;function z(){return b++,b}function T(s){return s.reduce((t,e)=>e+t,0)/s.length}function x(s){const t=s.toUpperCase().trim();if(/^#([A-F0-9]{3}){1,2}$/.test(t)){let r=t.substring(1).split("");r.length===3&&(r=[r[0],r[0],r[1],r[1],r[2],r[2]]);const i="".concat(r.join(""));return{r:parseInt(i.slice(0,2),16),g:parseInt(i.slice(2,4),16),b:parseInt(i.slice(4,6),16),a:1}}const e=t.match(/^RGBA?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d*\.?\d+))?\)$/);if(e)return{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10),a:parseFloat(e[4]||"1")};throw new Error("Invalid color: ".concat(s))}function P(s,t){const e={};for(let r=0;r<t;r++)e[r]=s;return e}const H=((v=f.navigator)===null||v===void 0?void 0:v.userAgent)||"",I=H.indexOf("MSIE ")>0||H.indexOf("Trident/")>0||H.indexOf("Edge/")>0,tt=()=>{};class wt{constructor(t,e,r=tt){c(this,"_mutationChains");c(this,"_onStateChange");c(this,"state");this._mutationChains=[],this._onStateChange=r,this.state={options:{drawingFadeDuration:e.drawingFadeDuration,drawingWidth:e.drawingWidth,drawingColor:x(e.drawingColor),strokeColor:x(e.strokeColor),outlineColor:x(e.outlineColor),radicalColor:x(e.radicalColor||e.strokeColor),highlightColor:x(e.highlightColor)},character:{main:{opacity:e.showCharacter?1:0,strokes:{}},outline:{opacity:e.showOutline?1:0,strokes:{}},highlight:{opacity:1,strokes:{}}},userStrokes:null};for(let i=0;i<t.strokes.length;i++)this.state.character.main.strokes[i]={opacity:1,displayPortion:1},this.state.character.outline.strokes[i]={opacity:1,displayPortion:1},this.state.character.highlight.strokes[i]={opacity:0,displayPortion:1}}updateState(t){const e=w(this.state,t);this._onStateChange(e,this.state),this.state=e}run(t,e={}){const r=t.map(i=>i.scope);return this.cancelMutations(r),new Promise(i=>{const o={_isActive:!0,_index:0,_resolve:i,_mutations:t,_loop:e.loop,_scopes:r};this._mutationChains.push(o),this._run(o)})}_run(t){if(!t._isActive)return;const e=t._mutations;if(t._index>=e.length){if(!t._loop)return t._isActive=!1,this._mutationChains=this._mutationChains.filter(r=>r!==t),void t._resolve({canceled:!1});t._index=0}t._mutations[t._index].run(this).then(()=>{t._isActive&&(t._index++,this._run(t))})}_getActiveMutations(){return this._mutationChains.map(t=>t._mutations[t._index])}pauseAll(){this._getActiveMutations().forEach(t=>t.pause())}resumeAll(){this._getActiveMutations().forEach(t=>t.resume())}cancelMutations(t){for(const e of this._mutationChains)for(const r of e._scopes)for(const i of t)(r.startsWith(i)||i.startsWith(r))&&this._cancelMutationChain(e)}cancelAll(){this.cancelMutations([""])}_cancelMutationChain(t){var e;t._isActive=!1;for(let r=t._index;r<t._mutations.length;r++)t._mutations[r].cancel(this);(e=t._resolve)===null||e===void 0||e.call(t,{canceled:!0}),this._mutationChains=this._mutationChains.filter(r=>r!==t)}}const E=(s,t)=>({x:s.x-t.x,y:s.y-t.y}),N=s=>Math.sqrt(Math.pow(s.x,2)+Math.pow(s.y,2)),D=(s,t)=>N(E(s,t)),V=(s,t=1)=>{const e=10*t;return{x:Math.round(e*s.x)/e,y:Math.round(e*s.y)/e}},Q=s=>{let t=s[0];return s.slice(1).reduce((e,r)=>{const i=D(r,t);return t=r,e+i},0)},G=(s,t,e)=>{const r=E(t,s),i=e/N(r);return{x:t.x+i*r.x,y:t.y+i*r.y}},et=s=>{const t=((o,n=30)=>{const a=Q(o)/(n-1),h=[o[0]],d=C(o),l=o.slice(1);for(let u=0;u<n-2;u++){let _=C(h),p=a,m=!1;for(;!m;){const g=D(_,l[0]);if(g<p)p-=g,_=l.shift();else{const R=G(_,l[0],p-g);h.push(R),m=!0}}}return h.push(d),h})(s),e={x:T(t.map(o=>o.x)),y:T(t.map(o=>o.y))},r=t.map(o=>E(o,e)),i=Math.sqrt(T([Math.pow(r[0].x,2)+Math.pow(r[0].y,2),Math.pow(C(r).x,2)+Math.pow(C(r).y,2)]));return((o,n=.05)=>{const a=o.slice(0,1);for(const h of o.slice(1)){const d=a[a.length-1],l=D(h,d);if(l>n){const u=Math.ceil(l/n),_=l/u;for(let p=0;p<u;p++)a.push(G(h,d,-1*_*(p+1)))}else a.push(h)}return a})(r.map(o=>({x:o.x/i,y:o.y/i})))};function K(s,t=!1){const e=V(s[0]),r=s.slice(1);let i="M ".concat(e.x.toString()," ").concat(e.y.toString());return r.forEach(o=>{const n=V(o);i+=" L ".concat(n.x.toString()," ").concat(n.y.toString())}),t&&(i+="Z"),i}const rt=(s,t)=>{const e=(a=>{if(a.length<3)return a;const h=[a[0],a[1]];return a.slice(2).forEach(d=>{const l=h.length,u=E(d,h[l-1]),_=E(h[l-1],h[l-2]);u.y*_.x-u.x*_.y==0&&h.pop(),h.push(d)}),h})(s);if(e.length<2)return e;const r=e[1],i=e[0],o=G(r,i,t),n=e.slice(1);return n.unshift(o),n};class Pt{constructor(t,e,r,i=!1){c(this,"path");c(this,"points");c(this,"strokeNum");c(this,"isInRadical");this.path=t,this.points=e,this.strokeNum=r,this.isInRadical=i}getStartingPoint(){return this.points[0]}getEndingPoint(){return this.points[this.points.length-1]}getLength(){return Q(this.points)}getVectors(){let t=this.points[0];return this.points.slice(1).map(e=>{const r=E(e,t);return t=e,r})}getDistance(t){const e=this.points.map(r=>D(r,t));return Math.min(...e)}getAverageDistance(t){return t.reduce((e,r)=>e+this.getDistance(r),0)/t.length}}class xt{constructor(t,e){c(this,"symbol");c(this,"strokes");this.symbol=t,this.strokes=e}}function Dt({radStrokes:s,strokes:t,medians:e}){return t.map((r,i)=>{const o=e[i].map(h=>{const[d,l]=h;return{x:d,y:l}});return new Pt(r,o,i,(n=i,((a=s==null?void 0:s.indexOf(n))!==null&&a!==void 0?a:-1)>=0));var n,a})}const[q,it]=[{x:0,y:-124},{x:1024,y:900}],ot=it.x-q.x,st=it.y-q.y;class nt{constructor(t){c(this,"padding");c(this,"width");c(this,"height");c(this,"scale");c(this,"xOffset");c(this,"yOffset");const{padding:e,width:r,height:i}=t;this.padding=e,this.width=r,this.height=i;const o=r-2*e,n=i-2*e,a=o/ot,h=n/st;this.scale=Math.min(a,h);const d=e+(o-this.scale*ot)/2,l=e+(n-this.scale*st)/2;this.xOffset=-1*q.x*this.scale+d,this.yOffset=-1*q.y*this.scale+l}convertExternalPoint(t){return{x:(t.x-this.xOffset)/this.scale,y:(this.height-this.yOffset-t.y)/this.scale}}}const Mt=(s,t)=>{const e=(i=>{const o=[];let n=i[0];return i.slice(1).forEach(a=>{o.push(E(a,n)),n=a}),o})(s),r=t.getVectors();return T(e.map(i=>{const o=r.map(n=>{return h=i,((a=n).x*h.x+a.y*h.y)/N(a)/N(h);var a,h});return Math.max(...o)}))>0},Rt=s=>{if(s.length<2)return s;const[t,...e]=s,r=[t];for(const n of e)i=n,o=r[r.length-1],(i.x!==o.x||i.y!==o.y)&&r.push(n);var i,o;return r},Tt=[Math.PI/16,Math.PI/32,0,-1*Math.PI/32,-1*Math.PI/16],At=(s,t,e)=>{const r=et(s),i=et(t);let o=1/0;return Tt.forEach(n=>{const a=((h,d)=>{const l=h.length>=d.length?h:d,u=h.length>=d.length?d:h,_=(m,g,R,yt)=>{if(m===0&&g===0)return D(l[0],u[0]);if(m>0&&g===0)return Math.max(R[0],D(l[m],u[0]));const Ct=yt[yt.length-1];return m===0&&g>0?Math.max(Ct,D(l[0],u[g])):Math.max(Math.min(R[g],R[g-1],Ct),D(l[m],u[g]))};let p=[];for(let m=0;m<l.length;m++){const g=[];for(let R=0;R<u.length;R++)g.push(_(m,R,p,g));p=g}return p[u.length-1]})(r,((h,d)=>h.map(l=>({x:Math.cos(d)*l.x-Math.sin(d)*l.y,y:Math.sin(d)*l.x+Math.cos(d)*l.y})))(i,n));a<o&&(o=a)}),o<=.4*e},X=(s,t,e)=>{const{leniency:r=1,isOutlineVisible:i=!1}=e,o=t.getAverageDistance(s),n=o<=350*(i||t.strokeNum>0?.5:1)*r;if(!n)return{isMatch:!1,avgDist:o};const a=((u,_,p)=>{const m=D(_.getStartingPoint(),u[0]),g=D(_.getEndingPoint(),u[u.length-1]);return m<=250*p&&g<=250*p})(s,t,r),h=Mt(s,t),d=At(s,t.points,r),l=((u,_,p)=>p*(Q(u)+25)/(_.getLength()+25)>=.35)(s,t,r);return{isMatch:n&&a&&h&&d&&l,avgDist:o}};class Ot{constructor(t,e,r){c(this,"id");c(this,"points");c(this,"externalPoints");this.id=t,this.points=[e],this.externalPoints=[r]}appendPoint(t,e){this.points.push(t),this.externalPoints.push(e)}}class k{constructor(t,e,r={}){c(this,"_tick");c(this,"scope");c(this,"_valuesOrCallable");c(this,"_duration");c(this,"_force");c(this,"_pausedDuration");c(this,"_startPauseTime");c(this,"_renderState");c(this,"_values");c(this,"_frameHandle");c(this,"_startState");c(this,"_startTime");c(this,"_resolve");this._tick=i=>{if(this._startPauseTime!==null)return;const o=Math.min(1,(i-this._startTime-this._pausedDuration)/this._duration);if(o===1)this._renderState.updateState(this._values),this._frameHandle=void 0,this.cancel(this._renderState);else{const n=Et(o),a=at(this._startState,this._values,n);this._renderState.updateState(a),this._frameHandle=S(this._tick)}},this.scope=t,this._valuesOrCallable=e,this._duration=r.duration||0,this._force=r.force,this._pausedDuration=0,this._startPauseTime=null}run(t){return this._values||this._inflateValues(t),this._duration===0&&t.updateState(this._values),this._duration===0||ht(t.state,this._values)?Promise.resolve():(this._renderState=t,this._startState=t.state,this._startTime=performance.now(),this._frameHandle=S(this._tick),new Promise(e=>{this._resolve=e}))}_inflateValues(t){let e=this._valuesOrCallable;typeof this._valuesOrCallable=="function"&&(e=this._valuesOrCallable(t.state)),this._values=function(r,i){const o=r.split("."),n={};let a=n;for(let h=0;h<o.length;h++){const d=h===o.length-1?i:{};a[o[h]]=d,a=d}return n}(this.scope,e)}pause(){this._startPauseTime===null&&(this._frameHandle&&M(this._frameHandle),this._startPauseTime=performance.now())}resume(){this._startPauseTime!==null&&(this._frameHandle=S(this._tick),this._pausedDuration+=performance.now()-this._startPauseTime,this._startPauseTime=null)}cancel(t){var e;(e=this._resolve)===null||e===void 0||e.call(this),this._resolve=void 0,M(this._frameHandle||-1),this._frameHandle=void 0,this._force&&(this._values||this._inflateValues(t),t.updateState(this._values))}}function at(s,t,e){const r={};for(const i in t){const o=t[i],n=s==null?void 0:s[i];r[i]=typeof n=="number"&&typeof o=="number"&&o>=0?e*(o-n)+n:at(n,o,e)}return r}function ht(s,t){for(const e in t){const r=t[e],i=s==null?void 0:s[e];if(r>=0){if(r!==i)return!1}else if(!ht(i,r))return!1}return!0}const Et=s=>-Math.cos(s*Math.PI)/2+.5,ct=(s,t,e)=>[new k("character.".concat(s,".strokes"),P({opacity:1,displayPortion:1},t.strokes.length),{duration:e,force:!0})],Y=(s,t,e)=>[new k("character.".concat(s),{opacity:1,strokes:P({opacity:1,displayPortion:1},t.strokes.length)},{duration:e,force:!0})],W=(s,t,e)=>[new k("character.".concat(s,".opacity"),0,{duration:e,force:!0}),...ct(s,t,0)],lt=(s,t,e)=>[new k("options.".concat(s),t,{duration:e})],dt=(s,t,e)=>{const r=s.strokeNum,i=(s.getLength()+600)/(3*e);return[new k("character.highlight.strokeColor",t),new k("character.highlight",{opacity:1,strokes:{[r]:{displayPortion:0,opacity:0}}}),new k("character.highlight.strokes.".concat(r),{displayPortion:1,opacity:1},{duration:i}),new k("character.highlight.strokes.".concat(r,".opacity"),0,{duration:i})]},ut=(s,t,e)=>{const r=t.strokeNum,i=(t.getLength()+600)/(3*e);return[new k("character.".concat(s),{opacity:1,strokes:{[r]:{displayPortion:0,opacity:1}}}),new k("character.".concat(s,".strokes.").concat(r,".displayPortion"),1,{duration:i})]},_t=(s,t,e,r,i)=>{let o=W(s,t,e);return o=o.concat(ct(s,t,0)),o.push(new k("character.".concat(s),{opacity:1,strokes:P({opacity:0},t.strokes.length)},{force:!0})),t.strokes.forEach((n,a)=>{a>0&&o.push(new k("delay",null,{duration:i})),o=o.concat(ut(s,n,r))}),o},pt=(s,t)=>[new k("userStrokes.".concat(s,".opacity"),0,{duration:t}),new k("userStrokes.".concat(s),null,{force:!0})];class Ft{constructor(t,e,r){c(this,"_currentStrokeIndex");c(this,"_mistakesOnStroke");c(this,"_totalMistakes");c(this,"_character");c(this,"_renderState");c(this,"_isActive");c(this,"_positioner");c(this,"_options");c(this,"_userStroke");this._currentStrokeIndex=0,this._mistakesOnStroke=0,this._totalMistakes=0,this._character=t,this._renderState=e,this._isActive=!1,this._positioner=r}startQuiz(t){return this._isActive=!0,this._options=t,this._currentStrokeIndex=0,this._mistakesOnStroke=0,this._totalMistakes=0,this._renderState.run((e=this._character,r=t.strokeFadeDuration,[...W("main",e,r),new k("character.highlight",{opacity:1,strokes:P({opacity:0},e.strokes.length)},{force:!0}),new k("character.main",{opacity:1,strokes:P({opacity:0},e.strokes.length)},{force:!0})]));var e,r}startUserStroke(t){if(!this._isActive)return null;if(this._userStroke)return this.endUserStroke();const e=this._positioner.convertExternalPoint(t),r=z();return this._userStroke=new Ot(r,e,t),this._renderState.run(((i,o)=>[new k("quiz.activeUserStrokeId",i,{force:!0}),new k("userStrokes.".concat(i.toString()),{points:[o],opacity:1},{force:!0})])(r,e))}continueUserStroke(t){if(!this._userStroke)return Promise.resolve();const e=this._positioner.convertExternalPoint(t);this._userStroke.appendPoint(e,t);const r=this._userStroke.points.slice(0);return this._renderState.run((i=this._userStroke.id,o=r,[new k("userStrokes.".concat(i,".points"),o,{force:!0})]));var i,o}endUserStroke(){var t;if(!this._userStroke)return;if(this._renderState.run(pt(this._userStroke.id,(t=this._options.drawingFadeDuration)!==null&&t!==void 0?t:300)),this._userStroke.points.length===1)return void(this._userStroke=void 0);const e=this._getCurrentStroke();if(function(r,i,o,n={}){const a=i.strokes,h=Rt(r.points);if(h.length<2)return null;const{isMatch:d,avgDist:l}=X(h,a[o],n);if(!d)return!1;const u=a.slice(o+1);let _=l;for(let p=0;p<u.length;p++){const{isMatch:m,avgDist:g}=X(h,u[p],n);m&&g<_&&(_=g)}if(_<l){const p=.6*(_+l)/(2*l),{isMatch:m}=X(h,a[o],{...n,leniency:(n.leniency||1)*p});return m}return!0}(this._userStroke,this._character,this._currentStrokeIndex,{isOutlineVisible:this._renderState.state.character.outline.opacity>0,leniency:this._options.leniency}))this._handleSuccess();else{this._handleFailure();const{showHintAfterMisses:r,highlightColor:i,strokeHighlightSpeed:o}=this._options;r!==!1&&this._mistakesOnStroke>=r&&this._renderState.run(dt(e,x(i),o))}this._userStroke=void 0}cancel(){this._isActive=!1,this._userStroke&&this._renderState.run(pt(this._userStroke.id,this._options.drawingFadeDuration))}_getStrokeData(t=!1){return{character:this._character.symbol,strokeNum:this._currentStrokeIndex,mistakesOnStroke:this._mistakesOnStroke,totalMistakes:this._totalMistakes,strokesRemaining:this._character.strokes.length-this._currentStrokeIndex-(t?1:0),drawnPath:(e=this._userStroke,{pathString:K(e.externalPoints),points:e.points.map(r=>V(r))})};var e}_handleSuccess(){if(!this._options)return;const{strokes:t,symbol:e}=this._character,{onCorrectStroke:r,onComplete:i,highlightOnComplete:o,strokeFadeDuration:n,strokeHighlightDuration:a}=this._options;r==null||r(this._getStrokeData(!0));let h=(d="main",l=this._currentStrokeIndex,u=n,[new k("character.".concat(d,".strokes.").concat(l),{displayPortion:1,opacity:1},{duration:u,force:!0})]);var d,l,u;this._mistakesOnStroke=0,this._currentStrokeIndex+=1,this._currentStrokeIndex===t.length&&(this._isActive=!1,i==null||i({character:e,totalMistakes:this._totalMistakes}),o&&(h=h.concat(((_,p)=>[...W("highlight",_,0),...Y("highlight",_,p/2),...W("highlight",_,p/2)])(this._character,2*(a||0))))),this._renderState.run(h)}_handleFailure(){var t,e;this._mistakesOnStroke+=1,this._totalMistakes+=1,(t=(e=this._options).onMistake)===null||t===void 0||t.call(e,this._getStrokeData())}_getCurrentStroke(){return this._character.strokes[this._currentStrokeIndex]}}function F(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function A(s,t,e){s.setAttributeNS(null,t,e)}function B(s,t){Object.keys(t).forEach(e=>A(s,e,t[e]))}function gt(s){var t;s==null||(t=s.parentNode)===null||t===void 0||t.removeChild(s)}const U=class U{constructor(t){c(this,"stroke");c(this,"_pathLength");this.stroke=t,this._pathLength=t.getLength()+U.STROKE_WIDTH/2}_getStrokeDashoffset(t){return .999*this._pathLength*(1-t)}_getColor({strokeColor:t,radicalColor:e}){return e&&this.stroke.isInRadical?e:t}};c(U,"STROKE_WIDTH");let L=U;L.STROKE_WIDTH=200;class Lt extends L{constructor(e){super(e);c(this,"_oldProps");c(this,"_animationPath");c(this,"_clip");c(this,"_strokePath");this._oldProps=void 0}mount(e){this._animationPath=F("path"),this._clip=F("clipPath"),this._strokePath=F("path");const r="mask-".concat(z().toString());A(this._clip,"id",r),A(this._strokePath,"d",this.stroke.path),this._animationPath.style.opacity="0",A(this._animationPath,"clip-path",function(o){let n="";return window.location&&window.location.href&&(n=window.location.href.replace(/#[^#]*$/,"").replace(/"/gi,"%22")),'url("'.concat(n,"#").concat(o,'")')}(r));const i=rt(this.stroke.points,100);return A(this._animationPath,"d",K(i)),B(this._animationPath,{stroke:"#FFFFFF","stroke-width":"200",fill:"none","stroke-linecap":"round","stroke-linejoin":"miter","stroke-dasharray":"".concat(this._pathLength.toString(),",").concat(this._pathLength.toString())}),this._clip.appendChild(this._strokePath),e.defs.appendChild(this._clip),e.svg.appendChild(this._animationPath),this}render(e){var r,i;if(e===this._oldProps||!this._animationPath)return;e.displayPortion!==((r=this._oldProps)===null||r===void 0?void 0:r.displayPortion)&&(this._animationPath.style.strokeDashoffset=this._getStrokeDashoffset(e.displayPortion).toString());const o=this._getColor(e);if(!this._oldProps||o!==this._getColor(this._oldProps)){const{r:n,g:a,b:h,a:d}=o;B(this._animationPath,{stroke:"rgba(".concat(n,",").concat(a,",").concat(h,",").concat(d,")")})}e.opacity!==((i=this._oldProps)===null||i===void 0?void 0:i.opacity)&&(this._animationPath.style.opacity=e.opacity.toString()),this._oldProps=e}}class J{constructor(t){c(this,"_oldProps");c(this,"_strokeRenderers");c(this,"_group");this._oldProps=void 0,this._strokeRenderers=t.strokes.map(e=>new Lt(e))}mount(t){const e=t.createSubRenderTarget();this._group=e.svg,this._strokeRenderers.forEach(r=>{r.mount(e)})}render(t){var e,r;if(t===this._oldProps||!this._group)return;const{opacity:i,strokes:o,strokeColor:n,radicalColor:a=null}=t;var h;i!==((e=this._oldProps)===null||e===void 0?void 0:e.opacity)&&(this._group.style.opacity=i.toString(),I||(i===0?this._group.style.display="none":((h=this._oldProps)===null||h===void 0?void 0:h.opacity)===0&&this._group.style.removeProperty("display")));const d=!this._oldProps||n!==this._oldProps.strokeColor||a!==this._oldProps.radicalColor;if(d||o!==((r=this._oldProps)===null||r===void 0?void 0:r.strokes))for(let u=0;u<this._strokeRenderers.length;u++){var l;!d&&(l=this._oldProps)!==null&&l!==void 0&&l.strokes&&o[u]===this._oldProps.strokes[u]||this._strokeRenderers[u].render({strokeColor:n,radicalColor:a,opacity:o[u].opacity,displayPortion:o[u].displayPortion})}this._oldProps=t}}class bt{constructor(){c(this,"_oldProps");c(this,"_path");this._oldProps=void 0}mount(t){this._path=F("path"),t.svg.appendChild(this._path)}render(t){var e,r,i,o;if(this._path&&t!==this._oldProps){if(t.strokeColor!==((e=this._oldProps)===null||e===void 0?void 0:e.strokeColor)||t.strokeWidth!==((r=this._oldProps)===null||r===void 0?void 0:r.strokeWidth)){const{r:n,g:a,b:h,a:d}=t.strokeColor;B(this._path,{fill:"none",stroke:"rgba(".concat(n,",").concat(a,",").concat(h,",").concat(d,")"),"stroke-width":t.strokeWidth.toString(),"stroke-linecap":"round","stroke-linejoin":"round"})}t.opacity!==((i=this._oldProps)===null||i===void 0?void 0:i.opacity)&&A(this._path,"opacity",t.opacity.toString()),t.points!==((o=this._oldProps)===null||o===void 0?void 0:o.points)&&A(this._path,"d",K(t.points)),this._oldProps=t}}destroy(){gt(this._path)}}class ft{constructor(t){c(this,"node");this.node=t}addPointerStartListener(t){this.node.addEventListener("mousedown",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchstart",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerMoveListener(t){this.node.addEventListener("mousemove",e=>{t(this._eventify(e,this._getMousePoint))}),this.node.addEventListener("touchmove",e=>{t(this._eventify(e,this._getTouchPoint))})}addPointerEndListener(t){document.addEventListener("mouseup",t),document.addEventListener("touchend",t)}getBoundingClientRect(){return this.node.getBoundingClientRect()}_eventify(t,e){return{getPoint:()=>e.call(this,t),preventDefault:()=>t.preventDefault()}}_getMousePoint(t){const{left:e,top:r}=this.getBoundingClientRect();return{x:t.clientX-e,y:t.clientY-r}}_getTouchPoint(t){const{left:e,top:r}=this.getBoundingClientRect();return{x:t.touches[0].clientX-e,y:t.touches[0].clientY-r}}}class j extends ft{constructor(e,r){super(e);c(this,"svg");c(this,"defs");c(this,"_pt");this.svg=e,this.defs=r,"createSVGPoint"in e&&(this._pt=e.createSVGPoint())}static init(e,r="100%",i="100%"){const o=typeof e=="string"?document.getElementById(e):e;if(!o)throw new Error("HanziWriter target element not found: ".concat(e));const n=o.nodeName.toUpperCase(),a=(()=>{if(n==="SVG"||n==="G")return o;{const d=F("svg");return o.appendChild(d),d}})();B(a,{width:r,height:i});const h=F("defs");return a.appendChild(h),new j(a,h)}createSubRenderTarget(){const e=F("g");return this.svg.appendChild(e),new j(e,this.defs)}_getMousePoint(e){if(this._pt&&(this._pt.x=e.clientX,this._pt.y=e.clientY,"getScreenCTM"in this.node)){var r;const i=this._pt.matrixTransform((r=this.node.getScreenCTM())===null||r===void 0?void 0:r.inverse());return{x:i.x,y:i.y}}return super._getMousePoint.call(this,e)}_getTouchPoint(e){if(this._pt&&(this._pt.x=e.touches[0].clientX,this._pt.y=e.touches[0].clientY,"getScreenCTM"in this.node)){var r;const i=this._pt.matrixTransform((r=this.node.getScreenCTM())===null||r===void 0?void 0:r.inverse());return{x:i.x,y:i.y}}return super._getTouchPoint(e)}}var Wt={HanziWriterRenderer:class{constructor(s,t){c(this,"_character");c(this,"_positioner");c(this,"_mainCharRenderer");c(this,"_outlineCharRenderer");c(this,"_highlightCharRenderer");c(this,"_userStrokeRenderers");c(this,"_positionedTarget");this._character=s,this._positioner=t,this._mainCharRenderer=new J(s),this._outlineCharRenderer=new J(s),this._highlightCharRenderer=new J(s),this._userStrokeRenderers={}}mount(s){const t=s.createSubRenderTarget(),e=t.svg,{xOffset:r,yOffset:i,height:o,scale:n}=this._positioner;A(e,"transform","translate(".concat(r.toString(),", ").concat((o-i).toString(),") scale(").concat(n.toString(),", ").concat((-1*n).toString(),")")),this._outlineCharRenderer.mount(t),this._mainCharRenderer.mount(t),this._highlightCharRenderer.mount(t),this._positionedTarget=t}render(s){const{main:t,outline:e,highlight:r}=s.character,{outlineColor:i,radicalColor:o,highlightColor:n,strokeColor:a,drawingWidth:h,drawingColor:d}=s.options;this._outlineCharRenderer.render({opacity:e.opacity,strokes:e.strokes,strokeColor:i}),this._mainCharRenderer.render({opacity:t.opacity,strokes:t.strokes,strokeColor:a,radicalColor:o}),this._highlightCharRenderer.render({opacity:r.opacity,strokes:r.strokes,strokeColor:n});const l=s.userStrokes||{};for(const _ in this._userStrokeRenderers){var u;l[_]||((u=this._userStrokeRenderers[_])===null||u===void 0||u.destroy(),delete this._userStrokeRenderers[_])}for(const _ in l){const p=l[_];if(!p)continue;const m={strokeWidth:h,strokeColor:d,...p};(()=>{if(this._userStrokeRenderers[_])return this._userStrokeRenderers[_];const g=new bt;return g.mount(this._positionedTarget),this._userStrokeRenderers[_]=g,g})().render(m)}}destroy(){gt(this._positionedTarget.svg),this._positionedTarget.defs.innerHTML=""}},createRenderTarget:j.init};const kt=(s,t)=>{s.beginPath();const e=t[0],r=t.slice(1);s.moveTo(e.x,e.y);for(const i of r)s.lineTo(i.x,i.y);s.stroke()};class Ht extends L{constructor(e,r=!0){super(e);c(this,"_path2D");c(this,"_pathCmd");c(this,"_extendedMaskPoints");r&&Path2D?this._path2D=new Path2D(this.stroke.path):this._pathCmd=(i=>{const o=i.split(/(^|\s+)(?=[A-Z])/).filter(a=>a!==" "),n=[a=>a.beginPath()];for(const a of o){const[h,...d]=a.split(/\s+/),l=d.map(u=>parseFloat(u));h==="M"?n.push(u=>u.moveTo(...l)):h==="L"?n.push(u=>u.lineTo(...l)):h==="C"?n.push(u=>u.bezierCurveTo(...l)):h==="Q"&&n.push(u=>u.quadraticCurveTo(...l))}return a=>n.forEach(h=>h(a))})(this.stroke.path),this._extendedMaskPoints=rt(this.stroke.points,L.STROKE_WIDTH/2)}render(e,r){if(r.opacity<.05)return;var i;e.save(),this._path2D?e.clip(this._path2D):((i=this._pathCmd)===null||i===void 0||i.call(this,e),e.globalAlpha=0,e.stroke(),e.clip());const{r:o,g:n,b:a,a:h}=this._getColor(r),d=h===1?"rgb(".concat(o,",").concat(n,",").concat(a,")"):"rgb(".concat(o,",").concat(n,",").concat(a,",").concat(h,")"),l=this._getStrokeDashoffset(r.displayPortion);e.globalAlpha=r.opacity,e.strokeStyle=d,e.fillStyle=d,e.lineWidth=L.STROKE_WIDTH,e.lineCap="round",e.lineJoin="round",e.setLineDash([this._pathLength,this._pathLength],l),e.lineDashOffset=l,kt(e,this._extendedMaskPoints),e.restore()}}class ${constructor(t){c(this,"_strokeRenderers");this._strokeRenderers=t.strokes.map(e=>new Ht(e))}render(t,e){if(e.opacity<.05)return;const{opacity:r,strokeColor:i,radicalColor:o,strokes:n}=e;for(let a=0;a<this._strokeRenderers.length;a++)this._strokeRenderers[a].render(t,{strokeColor:i,radicalColor:o,opacity:n[a].opacity*r,displayPortion:n[a].displayPortion||0})}}function It(s,t){if(t.opacity<.05)return;const{opacity:e,strokeWidth:r,strokeColor:i,points:o}=t,{r:n,g:a,b:h,a:d}=i;s.save(),s.globalAlpha=e,s.lineWidth=r,s.strokeStyle="rgba(".concat(n,",").concat(a,",").concat(h,",").concat(d,")"),s.lineCap="round",s.lineJoin="round",kt(s,o),s.restore()}class Z extends ft{constructor(t){super(t)}static init(t,e="100%",r="100%"){const i=typeof t=="string"?document.getElementById(t):t;if(!i)throw new Error("HanziWriter target element not found: ".concat(t));const o=i.nodeName.toUpperCase(),n=(()=>{if(o==="CANVAS")return i;const a=document.createElement("canvas");return i.appendChild(a),a})();return n.setAttribute("width",e),n.setAttribute("height",r),new Z(n)}getContext(){return this.node.getContext("2d")}}var zt={HanziWriterRenderer:class{constructor(s,t){c(this,"destroy");c(this,"_character");c(this,"_positioner");c(this,"_mainCharRenderer");c(this,"_outlineCharRenderer");c(this,"_highlightCharRenderer");c(this,"_target");this.destroy=tt,this._character=s,this._positioner=t,this._mainCharRenderer=new $(s),this._outlineCharRenderer=new $(s),this._highlightCharRenderer=new $(s)}mount(s){this._target=s}_animationFrame(s){const{width:t,height:e,scale:r,xOffset:i,yOffset:o}=this._positioner,n=this._target.getContext();n.clearRect(0,0,t,e),n.save(),n.translate(i,e-o),n.transform(1,0,0,-1,0,0),n.scale(r,r),s(n),n.restore(),n.draw&&n.draw()}render(s){const{outline:t,main:e,highlight:r}=s.character,{outlineColor:i,strokeColor:o,radicalColor:n,highlightColor:a,drawingColor:h,drawingWidth:d}=s.options;this._animationFrame(l=>{this._outlineCharRenderer.render(l,{opacity:t.opacity,strokes:t.strokes,strokeColor:i}),this._mainCharRenderer.render(l,{opacity:e.opacity,strokes:e.strokes,strokeColor:o,radicalColor:n}),this._highlightCharRenderer.render(l,{opacity:r.opacity,strokes:r.strokes,strokeColor:a});const u=s.userStrokes||{};for(const _ in u){const p=u[_];p&&It(l,{strokeWidth:d,strokeColor:h,...p})}})}},createRenderTarget:Z.init};const mt={charDataLoader:(s,t,e)=>{const r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("application/json"),r.open("GET",(i=>"https://cdn.jsdelivr.net/npm/hanzi-writer-data@".concat("2.0","/").concat(i,".json"))(s),!0),r.onerror=i=>{e(r,i)},r.onreadystatechange=()=>{r.readyState===4&&(r.status===200?t(JSON.parse(r.responseText)):r.status!==0&&e&&e(r))},r.send(null)},onLoadCharDataError:null,onLoadCharDataSuccess:null,showOutline:!0,showCharacter:!0,renderer:"svg",width:0,height:0,padding:20,strokeAnimationSpeed:1,strokeFadeDuration:400,strokeHighlightDuration:200,strokeHighlightSpeed:2,delayBetweenStrokes:1e3,delayBetweenLoops:2e3,strokeColor:"#555",radicalColor:null,highlightColor:"#AAF",outlineColor:"#DDD",drawingColor:"#333",leniency:1,showHintAfterMisses:3,highlightOnComplete:!0,highlightCompleteColor:null,drawingFadeDuration:300,drawingWidth:4,strokeWidth:2,outlineWidth:2,rendererOverride:{}};class vt{constructor(t){c(this,"_loadCounter");c(this,"_isLoading");c(this,"loadingFailed");c(this,"_options");c(this,"_resolve");c(this,"_reject");c(this,"_loadingChar");this._loadCounter=0,this._isLoading=!1,this.loadingFailed=!1,this._options=t}_debouncedLoad(t,e){const r=n=>{var a;e===this._loadCounter&&((a=this._resolve)===null||a===void 0||a.call(this,n))},i=n=>{var a;e===this._loadCounter&&((a=this._reject)===null||a===void 0||a.call(this,n))},o=this._options.charDataLoader(t,r,i);o&&("then"in o?o.then(r).catch(i):r(o))}_setupLoadingPromise(){return new Promise((t,e)=>{this._resolve=t,this._reject=e}).then(t=>{var e,r;return this._isLoading=!1,(e=(r=this._options).onLoadCharDataSuccess)===null||e===void 0||e.call(r,t),t}).catch(t=>{if(this._isLoading=!1,this.loadingFailed=!0,this._options.onLoadCharDataError)return void this._options.onLoadCharDataError(t);if(t instanceof Error)throw t;const e=new Error("Failed to load char data for ".concat(this._loadingChar));throw e.reason=t,e})}loadCharData(t){this._loadingChar=t;const e=this._setupLoadingPromise();return this.loadingFailed=!1,this._isLoading=!0,this._loadCounter++,this._debouncedLoad(t,this._loadCounter),e}}class O{constructor(t,e={}){const{HanziWriterRenderer:r,createRenderTarget:i}=e.renderer==="canvas"?zt:Wt,o=e.rendererOverride||{};this._renderer={HanziWriterRenderer:o.HanziWriterRenderer||r,createRenderTarget:o.createRenderTarget||i},this.target=this._renderer.createRenderTarget(t,e.width,e.height),this._options=this._assignOptions(e),this._loadingManager=new vt(this._options),this._setupListeners()}static create(t,e,r){const i=new O(t,r);return i.setCharacter(e),i}static loadCharacterData(t,e={}){const r=(()=>{const{_loadingManager:i,_loadingOptions:o}=O;return(i==null?void 0:i._loadingChar)===t&&o===e?i:new vt({...mt,...e})})();return O._loadingManager=r,O._loadingOptions=e,r.loadCharData(t)}static getScalingTransform(t,e,r=0){const i=new nt({width:t,height:e,padding:r});return{x:i.xOffset,y:i.yOffset,scale:i.scale,transform:(o=`
        translate(`.concat(i.xOffset,", ").concat(i.height-i.yOffset,`)
        scale(`).concat(i.scale,", ").concat(-1*i.scale,`)
      `),o.replace(/^\s+/,"").replace(/\s+$/,"")).replace(/\s+/g," ")};var o}showCharacter(t={}){return this._options.showCharacter=!0,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(Y("main",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}hideCharacter(t={}){return this._options.showCharacter=!1,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(W("main",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}animateCharacter(t={}){return this.cancelQuiz(),this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(_t("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}animateStroke(t,e={}){return this.cancelQuiz(),this._withData(()=>{var r;return(r=this._renderState)===null||r===void 0?void 0:r.run(((i,o,n,a)=>{const h=o.strokes[n];return[new k("character.".concat(i),d=>{const l=d.character[i],u={opacity:1,strokes:{}};for(let _=0;_<o.strokes.length;_++)u.strokes[_]={opacity:l.opacity*l.strokes[_].opacity};return u}),...ut(i,h,a)]})("main",this._character,t,this._options.strokeAnimationSpeed)).then(i=>{var o;return(o=e.onComplete)===null||o===void 0||o.call(e,i),i})})}highlightStroke(t,e={}){return this._withData(()=>{if(this._character&&this._renderState)return this._renderState.run(dt(this._character.strokes[t],x(this._options.highlightColor),this._options.strokeHighlightSpeed)).then(r=>{var i;return(i=e.onComplete)===null||i===void 0||i.call(e,r),r})})}async loopCharacterAnimation(){return this.cancelQuiz(),this._withData(()=>this._renderState.run(((t,e,r,i,o,n)=>{const a=_t(t,e,r,i,o);return a.push(new k.Delay(n)),a})("main",this._character,this._options.strokeFadeDuration,this._options.strokeAnimationSpeed,this._options.delayBetweenStrokes,this._options.delayBetweenLoops),{loop:!0}))}pauseAnimation(){return this._withData(()=>{var t;return(t=this._renderState)===null||t===void 0?void 0:t.pauseAll()})}resumeAnimation(){return this._withData(()=>{var t;return(t=this._renderState)===null||t===void 0?void 0:t.resumeAll()})}showOutline(t={}){return this._options.showOutline=!0,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(Y("outline",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}hideOutline(t={}){return this._options.showOutline=!1,this._withData(()=>{var e;return(e=this._renderState)===null||e===void 0?void 0:e.run(W("outline",this._character,typeof t.duration=="number"?t.duration:this._options.strokeFadeDuration)).then(r=>{var i;return(i=t.onComplete)===null||i===void 0||i.call(t,r),r})})}updateColor(t,e,r={}){var i;let o=[];const n=x(t!=="radicalColor"||e?e:this._options.strokeColor);this._options[t]=e;const a=(i=r.duration)!==null&&i!==void 0?i:this._options.strokeFadeDuration;return o=o.concat(lt(t,n,a)),t!=="radicalColor"||e||(o=o.concat(lt(t,null,0))),this._withData(()=>{var h;return(h=this._renderState)===null||h===void 0?void 0:h.run(o).then(d=>{var l;return(l=r.onComplete)===null||l===void 0||l.call(r,d),d})})}quiz(t={}){return this._withData(async()=>{this._character&&this._renderState&&this._positioner&&(this.cancelQuiz(),this._quiz=new Ft(this._character,this._renderState,this._positioner),this._options={...this._options,...t},this._quiz.startQuiz(this._options))})}cancelQuiz(){this._quiz&&(this._quiz.cancel(),this._quiz=void 0)}setCharacter(t){return this.cancelQuiz(),this._char=t,this._hanziWriterRenderer&&this._hanziWriterRenderer.destroy(),this._renderState&&this._renderState.cancelAll(),this._hanziWriterRenderer=null,this._withDataPromise=this._loadingManager.loadCharData(t).then(e=>{if(!e||this._loadingManager.loadingFailed)return;this._character=function(a,h){const d=Dt(h);return new xt(a,d)}(t,e);const{width:r,height:i,padding:o}=this._options;this._positioner=new nt({width:r,height:i,padding:o});const n=new this._renderer.HanziWriterRenderer(this._character,this._positioner);this._hanziWriterRenderer=n,this._renderState=new wt(this._character,this._options,a=>n.render(a)),this._hanziWriterRenderer.mount(this.target),this._hanziWriterRenderer.render(this._renderState.state)}),this._withDataPromise}_assignOptions(t){const e={...mt,...t};return t.strokeAnimationDuration&&!t.strokeAnimationSpeed&&(e.strokeAnimationSpeed=500/t.strokeAnimationDuration),t.strokeHighlightDuration&&!t.strokeHighlightSpeed&&(e.strokeHighlightSpeed=500/e.strokeHighlightDuration),t.highlightCompleteColor||(e.highlightCompleteColor=e.highlightColor),this._fillWidthAndHeight(e)}_fillWidthAndHeight(t){const e={...t};if(e.width&&!e.height)e.height=e.width;else if(e.height&&!e.width)e.width=e.height;else if(!e.width&&!e.height){const{width:r,height:i}=this.target.getBoundingClientRect(),o=Math.min(r,i);e.width=o,e.height=o}return e}_withData(t){if(this._loadingManager.loadingFailed)throw Error("Failed to load character data. Call setCharacter and try again.");return this._withDataPromise?this._withDataPromise.then(()=>{if(!this._loadingManager.loadingFailed)return t()}):Promise.resolve().then(t)}_setupListeners(){this.target.addPointerStartListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.startUserStroke(t.getPoint()))}),this.target.addPointerMoveListener(t=>{this._quiz&&(t.preventDefault(),this._quiz.continueUserStroke(t.getPoint()))}),this.target.addPointerEndListener(()=>{var t;(t=this._quiz)===null||t===void 0||t.endUserStroke()})}}return O._loadingManager=null,O._loadingOptions=null,O}();export{Ut as a,Vt as g};
