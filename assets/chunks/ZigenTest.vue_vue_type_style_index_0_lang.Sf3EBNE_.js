import{d as lt,l as st,o as p,c as m,m as t,a as ot,e as x,F as G,C as L,n as at,t as s,$ as ut,j,g as Z}from"./framework.72Ik0KeM.js";import{m as it}from"./share.Dv-cn20s.js";const rt={key:0,class:"loading"},ct={key:1,class:"zigen-test-container"},dt={class:"left-panel"},ht={class:"panel-header"},ft={class:"table-container"},vt={class:"zigen-cell zigen-font"},gt={class:"code-cell"},pt={class:"input-cell"},mt=["value","placeholder","onInput","onKeyup"],yt={class:"right-panel"},_t={class:"stats-section"},bt={class:"compact-stats-table"},jt={key:0,class:"dynamic-stats"},Ct={class:"compact-stats-table"},wt={key:0,class:"stats-section modified"},kt={class:"compact-stats-table"},zt={key:0,class:"dynamic-stats"},Ft={class:"compact-stats-table"},xt={key:1,class:"comparison-section"},Mt={key:0,class:"change-list added"},qt={class:"char-list"},Ot={key:1,class:"change-list removed"},Tt={class:"char-list"},St={key:2,class:"no-change"},Bt={class:"bottom-info-panel"},Dt={class:"info-section"},Kt={class:"info-table"},Nt={class:"info-section"},At={class:"info-table"},Et=lt({__name:"ZigenTest",setup(It){const T=j([]),K=j(new Map),v=j(null),N=j(!0),A=j(!1),M=j([]),C=j([]),B=j(new Map),f=j(null),q=j(null),F=j(null);async function V(){try{const n=await fetch("https://raw.githubusercontent.com/forfudan/yuhao-assess/main/public/data/charsets.json");v.value=await n.json()}catch(n){console.error("Failed to load charset data:",n),v.value={}}}async function H(){try{const n="https://cdn.jsdelivr.net/gh/forfudan/yuhao-assess@main/public/data",[e,l,o,a]=await Promise.all([fetch(`${n}/charFrequencyZhihu.json`),fetch(`${n}/charFrequencySC.json`),fetch(`${n}/charFrequencyTC.json`),fetch(`${n}/charFrequencyGuji.json`)]);if(!e.ok||!l.ok||!o.ok||!a.ok)throw new Error(`HTTP error: ${[e,l,o,a].map(g=>g.status).join(", ")}`);const[u,i,h,d]=await Promise.all([e.json(),l.json(),o.json(),a.json()]),r=g=>{const c=Object.values(g).reduce((O,I)=>O+I,0);if(c===0)return g;const b={};for(const[O,I]of Object.entries(g))b[O]=I/c;return b},y=r(u),_=r(i),w=r(h),k=r(d),z={};for(const[g,c]of Object.entries(i))z[g]=c;for(const[g,c]of Object.entries(h))z[g]?z[g]+=c:z[g]=c;const D=r(z);f.value={zhihu:y,sc:_,tc:w,guji:k,unified:D}}catch(n){console.error("Failed to load char frequencies:",n),f.value=null}}function U(n,e){if(!v.value||!v.value[n])return!1;const l=v.value[n];switch(e){case"gb2312":return l.is_gb2312||!1;case"tonggui":return l.is_tonggui||!1;case"guozi":return l.is_guozi||!1;case"tonggui_guozi":return l.is_tonggui||l.is_guozi||!1;default:return!1}}function R(n){const e=n.codePointAt(0);return e?e>=19968&&e<=40959:!1}async function Q(n){const o=(await(await fetch(Z(n))).text()).split(`
`).filter(u=>u.trim()),a=[];for(let u=1;u<o.length;u++){const[i,h,d]=o[u].split(",");i&&h&&a.push({font:i,ma:h,pinyin:d})}T.value=a}async function W(n){var u,i,h;const o=(await(await fetch(Z(n))).text()).split(`
`).filter(d=>d.trim()),a=new Map;for(let d=1;d<o.length;d++){const[r,y,_,w]=o[d].split(",");if(r&&y){const k=R(r),z=v.value&&(((u=v.value[r])==null?void 0:u.is_tonggui)||((i=v.value[r])==null?void 0:i.is_gb2312)||((h=v.value[r])==null?void 0:h.is_guozi));(k||z)&&a.set(r,{char:r,division:y,division_tw:_||"",region:w||""})}}K.value=a}function $(){const n=new Map;for(const e of T.value){const l=e.editedMa||e.ma;n.set(e.font,{font:e.font,ma:l,pinyin:e.pinyin})}return n}function E(n){const e=new Map;for(const[l,o]of K.value.entries()){const a=it(o.division,n,"ling").toLowerCase();a&&!a.includes("?")&&e.set(l,a)}return e}function S(n,e){const l=new Map;for(const[u,i]of n.entries()){const h=e[u]||0;l.has(i)||l.set(i,[]),l.get(i).push({char:u,freq:h})}let o=0;for(const u of l.values())if(u.length>1){u.sort((d,r)=>r.freq-d.freq);const i=u.reduce((d,r)=>d+r.freq,0),h=u[0].freq;o+=i-h}let a=0;for(const[u]of n.entries()){const i=e[u];i!==void 0&&i>0&&(a+=i)}return a>0?o/a:0}function J(n){return f.value?{zhihu:S(n,f.value.zhihu),sc:S(n,f.value.sc),tc:S(n,f.value.tc),guji:S(n,f.value.guji),unified:S(n,f.value.unified)}:null}function P(n,e){const l=[];for(const o of e){const a=Array.from(n.keys()).filter(y=>o==="cjk_basic"?R(y):U(y,o)),u=new Set(a),i=new Map;for(const[y,_]of n.entries())i.has(_)||i.set(_,[]),i.get(_).push(y);const h=new Set;let d=0;for(const[y,_]of i.entries()){const w=_.filter(k=>u.has(k));w.length>1&&(d+=w.length,w.forEach(k=>h.add(k)))}const r={gb2312:"GB2312",tonggui:"通用規範",guozi:"常用國字",tonggui_guozi:"通規+國字",cjk_basic:"CJK基本集"};l.push({name:r[o]||o,totalChars:a.length,duplicateCount:d,duplicateRate:a.length>0?d/a.length:0,duplicateChars:h})}return l}function X(n,e){const l=new Map;for(let o=0;o<n.length;o++){const a=n[o].duplicateChars,u=e[o].duplicateChars,i=n[o].name,h=Array.from(u).filter(r=>!a.has(r)),d=Array.from(a).filter(r=>!u.has(r));l.set(i,{added:h,removed:d})}B.value=l}st(async()=>{try{N.value=!0,await V(),await Promise.all([Q("/zigen-ling.csv"),W("/chaifen.csv"),H()]);const n=$(),e=E(n),l=["gb2312","tonggui","guozi","tonggui_guozi","cjk_basic"];M.value=P(e,l),q.value=J(e)}catch(n){console.error("Error loading data:",n)}finally{N.value=!1}});function Y(n,e){const l=e.target;T.value[n].editedMa=l.value}function tt(n){et()}function et(){if(!A.value){A.value=!0;try{const n=$(),e=E(n),l=["gb2312","tonggui","guozi","tonggui_guozi","cjk_basic"];C.value=P(e,l),F.value=J(e),X(M.value,C.value)}finally{A.value=!1}}}function nt(){for(const n of T.value)n.editedMa=void 0;C.value=[],F.value=null,B.value.clear()}return(n,e)=>{var l,o,a,u,i,h,d,r,y,_,w,k,z,D,g;return N.value?(p(),m("div",rt,"加載中...")):(p(),m("div",ct,[t("div",dt,[t("div",ht,[e[1]||(e[1]=t("h3",null,"字根表編輯",-1)),C.value.length>0?(p(),m("button",{key:0,onClick:nt,class:"reset-btn",title:"還原所有修改"},[...e[0]||(e[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),t("path",{d:"M3 3v5h5"})],-1),ot(" 還原 ",-1)])])):x("",!0)]),t("div",ft,[t("table",null,[e[2]||(e[2]=t("thead",null,[t("tr",null,[t("th",null,"字根"),t("th",null,"編碼"),t("th",null,"修改編碼")])],-1)),t("tbody",null,[(p(!0),m(G,null,L(T.value,(c,b)=>(p(),m("tr",{key:b,class:at({"edited-row":c.editedMa})},[t("td",vt,s(c.font),1),t("td",gt,s(c.ma),1),t("td",pt,[t("input",{type:"text",value:c.editedMa||"",placeholder:c.ma,onInput:O=>Y(b,O),onKeyup:ut(O=>tt(),["enter"]),class:"code-input"},null,40,mt)])],2))),128))])])])]),t("div",yt,[t("div",_t,[e[5]||(e[5]=t("h4",null,"原始統計",-1)),t("table",bt,[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",null,"GB2312"),t("th",null,"通規"),t("th",null,"國字"),t("th",null,"通+國"),t("th",null,"CJK")])],-1)),t("tbody",null,[t("tr",null,[t("td",null,s(((l=M.value[0])==null?void 0:l.duplicateCount)||0),1),t("td",null,s(((o=M.value[1])==null?void 0:o.duplicateCount)||0),1),t("td",null,s(((a=M.value[2])==null?void 0:a.duplicateCount)||0),1),t("td",null,s(((u=M.value[3])==null?void 0:u.duplicateCount)||0),1),t("td",null,s(((i=M.value[4])==null?void 0:i.duplicateCount)||0),1)])])]),q.value?(p(),m("div",jt,[t("table",Ct,[e[4]||(e[4]=t("thead",null,[t("tr",null,[t("th",null,"知乎"),t("th",null,"北語"),t("th",null,"臺繁"),t("th",null,"古籍"),t("th",null,"繁簡")])],-1)),t("tbody",null,[t("tr",null,[t("td",null,s((q.value.zhihu*1e4).toFixed(2))+"‱",1),t("td",null,s((q.value.sc*1e4).toFixed(2))+"‱",1),t("td",null,s((q.value.tc*1e4).toFixed(2))+"‱",1),t("td",null,s((q.value.guji*1e4).toFixed(2))+"‱",1),t("td",null,s((q.value.unified*1e4).toFixed(2))+"‱",1)])])])])):x("",!0)]),C.value.length>0?(p(),m("div",wt,[e[8]||(e[8]=t("h4",null,"修改後統計",-1)),t("table",kt,[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",null,"GB2312"),t("th",null,"通規"),t("th",null,"國字"),t("th",null,"通+國"),t("th",null,"CJK")])],-1)),t("tbody",null,[t("tr",null,[t("td",null,s(((h=C.value[0])==null?void 0:h.duplicateCount)||0),1),t("td",null,s(((d=C.value[1])==null?void 0:d.duplicateCount)||0),1),t("td",null,s(((r=C.value[2])==null?void 0:r.duplicateCount)||0),1),t("td",null,s(((y=C.value[3])==null?void 0:y.duplicateCount)||0),1),t("td",null,s(((_=C.value[4])==null?void 0:_.duplicateCount)||0),1)])])]),F.value?(p(),m("div",zt,[t("table",Ft,[e[7]||(e[7]=t("thead",null,[t("tr",null,[t("th",null,"知乎"),t("th",null,"北語"),t("th",null,"臺繁"),t("th",null,"古籍"),t("th",null,"繁簡")])],-1)),t("tbody",null,[t("tr",null,[t("td",null,s((F.value.zhihu*1e4).toFixed(2))+"‱",1),t("td",null,s((F.value.sc*1e4).toFixed(2))+"‱",1),t("td",null,s((F.value.tc*1e4).toFixed(2))+"‱",1),t("td",null,s((F.value.guji*1e4).toFixed(2))+"‱",1),t("td",null,s((F.value.unified*1e4).toFixed(2))+"‱",1)])])])])):x("",!0)])):x("",!0),B.value.size>0?(p(),m("div",xt,[e[11]||(e[11]=t("h4",null,"對比結果",-1)),(p(!0),m(G,null,L(B.value,([c,b])=>(p(),m("div",{key:c,class:"comparison-item"},[t("h5",null,s(c),1),b.added.length>0?(p(),m("div",Mt,[e[9]||(e[9]=t("strong",null,"新增重碼：",-1)),t("span",qt,s(b.added.join(" ")),1)])):x("",!0),b.removed.length>0?(p(),m("div",Ot,[e[10]||(e[10]=t("strong",null,"減少重碼：",-1)),t("span",Tt,s(b.removed.join(" ")),1)])):x("",!0),b.added.length===0&&b.removed.length===0?(p(),m("div",St," 無變化 ")):x("",!0)]))),128))])):x("",!0)]),t("div",Bt,[t("div",Dt,[e[13]||(e[13]=t("h4",null,"字符集字數",-1)),t("table",Kt,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"GB2312"),t("th",null,"通規"),t("th",null,"國字"),t("th",null,"通+國"),t("th",null,"CJK")])],-1)),t("tbody",null,[t("tr",null,[t("td",null,s(v.value?Object.values(v.value).filter(c=>c.is_gb2312).length:0),1),t("td",null,s(v.value?Object.values(v.value).filter(c=>c.is_tonggui).length:0),1),t("td",null,s(v.value?Object.values(v.value).filter(c=>c.is_guozi).length:0),1),t("td",null,s(v.value?Object.values(v.value).filter(c=>c.is_tonggui||c.is_guozi).length:0),1),t("td",null,s(Array.from(K.value.keys()).length),1)])])])]),t("div",Nt,[e[15]||(e[15]=t("h4",null,"字頻表字數",-1)),t("table",At,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"知乎"),t("th",null,"北語"),t("th",null,"臺繁"),t("th",null,"古籍"),t("th",null,"繁簡")])],-1)),t("tbody",null,[t("tr",null,[t("td",null,s((w=f.value)!=null&&w.zhihu?Object.keys(f.value.zhihu).length:0),1),t("td",null,s((k=f.value)!=null&&k.sc?Object.keys(f.value.sc).length:0),1),t("td",null,s((z=f.value)!=null&&z.tc?Object.keys(f.value.tc).length:0),1),t("td",null,s((D=f.value)!=null&&D.guji?Object.keys(f.value.guji).length:0),1),t("td",null,s((g=f.value)!=null&&g.unified?Object.keys(f.value.unified).length:0),1)])])])])])]))}}});export{Et as _};
