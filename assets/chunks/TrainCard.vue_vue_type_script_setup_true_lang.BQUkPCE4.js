var B=Object.defineProperty;var F=(i,s,t)=>s in i?B(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var x=(i,s,t)=>(F(i,typeof s!="symbol"?s+"":s,t),t);import{d as I,H as m,l as M,y as N,o as d,c as h,m as o,t as u,n as y,b as A,e as b,p as T,ag as z,ah as E,a as w}from"./framework.rq0FYgLR.js";import{_ as V}from"./MultiChaifen.vue_vue_type_script_setup_true_lang.BgcfZadL.js";function j(i,s){let t="",e=0;for(const n of s.values())if(n.division.includes(i)&&(t+=n.char,e++,e>=8))break;return t}function O(i,s){let t=null;return()=>{t||(t=setTimeout(()=>{i(),t=null},s))}}class C{constructor(s,t=""){x(this,"record");x(this,"progress",0);x(this,"saveLocal",O(()=>{window.localStorage.setItem(`yuhao_${this.name}_records`,JSON.stringify(this.record))},1e3));this.items=s,this.name=t;const e=window.localStorage.getItem(`yuhao_${this.name}_records`);e?this.record=JSON.parse(e):this.record=Array.from({length:this.items.length},(l,c)=>[-1,c]);let n=0;for(const l of this.record)l[0]!==-1&&++n;this.progress=n}first(){return{item:this.items[this.record[0][1]],isFirst:this.record[0][0]===-1}}nextSuccess(){const s=this.record.length-1,t=this.record[0],e=++t[0];e===0&&this.progress===t[1]&&this.progress++;let n=0;const l=[4,16,64,256];return e>l.length-1?(t[0]=8,n=s):(n=l[e],n>s&&(n=s)),this.record.copyWithin(0,1,n+1),this.record[n]=t,this.saveLocal(),this.first()}nextFail(){return this.record[0][0]=-1,this.saveLocal(),this.first()}}const R={key:0,class:"text-center py-16"},$={class:"mb-8"},D=o("div",{class:"text-6xl mb-4"},"🎉",-1),J=o("h2",{class:"text-4xl font-bold mb-2"},"恭喜你完成練習！",-1),U={class:"text-xl text-gray-600 mb-8"},H=o("div",{class:"text-sm text-gray-500"}," 繼續練習以巩固記憶 ",-1),P={key:1},W={class:"flex justify-center mb-24"},q=["value","max"],G={class:"flex justify-around mb-8"},Q={key:0,class:"flex tracking-widest flex-col opacity-70"},X={key:1,class:"flex tracking-widest flex-col opacity-70"},Y=o("div",{class:"text-gray-500 text-sm"}," 相关的字： ",-1),Z={class:"font-bold text-xl"},K={class:"flex justify-center p-5"},ee={class:"font-mono"},te={key:0},se={key:1,class:"text-sm text-gray-500 mt-1"},ae={class:"font-mono text-blue-600"},oe={class:"text-gray-500 pb-16"},le=I({__name:"TrainCard",props:{cards:{},name:{},chaifenMap:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(i){const s=i;let t;const e=m({name:"",key:""}),n=m(0),l=m(!0),c=m(!0),k=m(!1),g=m("");M(()=>{t=new C(s.cards,s.name);const a=t.first();e.value=a.item,l.value=a.isFirst,n.value=t.progress;const r=document.getElementById("input_el");r==null||r.focus()}),N(g,a=>{const r={的:"e",是:"i",我:"o",不:"u",了:"a"};(a.length>=e.value.key.length||s.ming&&r[e.value.name]&&a.toLowerCase()===r[e.value.name])&&(S(a),g.value="")});function S(a){const r=a.toLowerCase(),v=e.value.key.toLowerCase(),f={的:"e",是:"i",我:"o",不:"u",了:"a"};let p=r===v;!p&&s.ming&&f[e.value.name]&&(p=r===f[e.value.name]);let _;if(p?(_=t.nextSuccess(),c.value=!0):(_=t.nextFail(),c.value=!1),n.value>=s.cards.length){k.value=!0;return}e.value=_.item,l.value=_.isFirst,n.value=t.progress}function L(){t=new C(s.cards,s.name);const a=t.first();e.value=a.item,l.value=a.isFirst,n.value=t.progress,k.value=!1;const r=document.getElementById("input_el");r==null||r.focus()}return(a,r)=>{var v,f;return k.value?(d(),h("div",R,[o("div",$,[D,J,o("p",U,"你已经完成了 "+u(a.cards.length)+" 個項目的練習，獲得称号「登堂入室」",1)]),o("div",{class:"space-y-4"},[o("button",{onClick:L,class:"btn btn-primary btn-lg px-8"}," 要不要再來一輪？ "),H])])):(d(),h("div",P,[o("div",{class:y(["md:w-2/3 w-full shadow-sm my-12 pb-24 bg-opacity-10  rounded-md",{"bg-red-700":!c.value,"bg-slate-500":c.value}])},[o("div",W,[o("progress",{class:"progress w-full",value:n.value,max:a.cards.length},null,8,q)]),o("div",G,[o("div",{class:y(["text-6xl ",{"text-red-400":!c.value}])},u(e.value.name),3),a.mode==="z"?(d(),h("div",Q,[(d(),A(V,{chars:e.value.name,size:100,key:e.value.name,loc:""},null,8,["chars"]))])):b("",!0),a.mode==="g"&&a.chaifenMap?(d(),h("div",X,[Y,o("div",Z,u(T(j)(e.value.name,a.chaifenMap)),1)])):b("",!0)]),o("div",K,[z(o("input",{id:"input_el",type:"text",placeholder:"輸入編碼","onUpdate:modelValue":r[0]||(r[0]=p=>g.value=p),class:y(["input w-half max-w-xs input-bordered text-center input-sm dark:bg-slate-800 bg-white",{"input-error":!c.value}])},null,2),[[E,g.value]])]),o("div",{class:y(["text-center",{"opacity-0":!l.value}])},[w("答案是 "),o("b",ee,u(e.value.key),1),a.mode==="z"?(d(),h("span",te,"（"+u((f=(v=a.chaifenMap)==null?void 0:v.get(e.value.name))==null?void 0:f.division)+"）",1)):b("",!0),s.ming&&["的","是","我","不","了"].includes(e.value.name)?(d(),h("div",se,[w(" 也可直接使用韻碼 "),o("b",ae,u(e.value.name==="的"?"E":e.value.name==="是"?"I":e.value.name==="我"?"O":e.value.name==="不"?"U":e.value.name==="了"?"A":""),1),w(" 直接上屏 ")])):b("",!0)],2)],2),o("div",oe,"訓練進度："+u(n.value)+" / "+u(a.cards.length),1)]))}}});export{le as _};
