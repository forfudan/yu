import{f as ie}from"./share.Nrbaa2_l.js";import{C as le}from"./ChaiDataLoader.DYi6iwdM.js";import{d as ae,k as S,am as ce,h as g,l as Q,A as de,y as R,o as s,c as t,e as p,m as i,n as m,F as y,G as k,t as _,Q as re,q as ue,s as ve,_ as _e}from"./framework.rq0FYgLR.js";const v=Z=>(ue("data-v-ff9d6c10"),Z=Z(),ve(),Z),he={class:"zigen-map-container"},fe={key:0,class:"flex justify-center items-center py-8"},ge=v(()=>i("div",{class:"loading loading-spinner loading-lg"},null,-1)),pe=v(()=>i("span",{class:"ml-2"},"正在加載字根數據...",-1)),me=[ge,pe],ye={key:1,class:"flex justify-between items-center mb-4"},ke=v(()=>i("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),xe={key:0,class:"flex items-center space-x-2"},ze=v(()=>i("span",{class:"text-xs text-gray-400"},"切換字根圖和字根表：",-1)),be=["title"],Ce={key:0},we={key:1},$e={key:2,class:"keyboard-layout"},Le={class:"key-label"},Se=["onClick"],Ze={class:"zigen-code"},Me={key:0,class:"more-indicator"},Ee={key:1,class:"text-xs text-gray-400 no-zigen-text"},Pe={key:0,class:"vertical-text zigen-font"},Ue=v(()=>i("div",null,"引導特殊符號",-1)),De=v(()=>i("div",null,"切換多重註解",-1)),je=[Ue,De],Ae={key:1,class:"vertical-text zigen-font"},Be=v(()=>i("div",null,"引導拼音反查",-1)),Fe=v(()=>i("div",null,"引導歷史輸入",-1)),Ke=[Be,Fe],We={key:2,class:"vertical-text zigen-font"},Ie=v(()=>i("div",null,null,-1)),Ve=v(()=>i("div",null,"一碼上屏字　了",-1)),Ne=[Ie,Ve],qe={key:3,class:"vertical-text zigen-font"},Te=v(()=>i("div",null,null,-1)),He=v(()=>i("div",null,"一碼上屏字　的",-1)),Oe=[Te,He],Xe={key:4,class:"vertical-text zigen-font"},Ge=v(()=>i("div",null,null,-1)),Qe=v(()=>i("div",null,"一碼上屏字　是",-1)),Re=[Ge,Qe],Je={key:5,class:"vertical-text zigen-font"},Ye=v(()=>i("div",null,null,-1)),es=v(()=>i("div",null,"一碼上屏字　我",-1)),ss=[Ye,es],ts={key:6,class:"vertical-text zigen-font"},ns=v(()=>i("div",null,null,-1)),os=v(()=>i("div",null,"一碼上屏字　不",-1)),is=[ns,os],ls={key:7,class:"vertical-text single-line zigen-font"},as={class:"mobile-key-label"},cs={key:0,class:"mobile-zigen-container"},ds={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},rs=["onClick"],us={class:"zigen-code"},vs={key:1,class:"mobile-no-zigen"},_s={key:0,class:"mobile-key-desc zigen-font"},hs={key:1,class:"mobile-key-desc zigen-font"},fs={key:2,class:"mobile-key-desc zigen-font"},gs={key:3,class:"mobile-key-desc"},ps={key:4,class:"pinned-popup"},ms={class:"popup-container"},ys={class:"popup-body"},ks={class:"popup-header"},xs={class:"popup-title"},zs={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},bs={class:"zigen-header-inline current-zigen"},Cs={key:0,class:"example-chars-same-line"},ws={key:1,class:"example-chars-same-line"},$s=v(()=>i("span",{class:"loading-text"},"正在加載...",-1)),Ls=[$s],Ss={class:"zigen-header-inline other-zigen"},Zs={key:0,class:"example-chars-same-line"},Ms={key:1,class:"example-chars-same-line"},Es=v(()=>i("span",{class:"loading-text"},"正在加載...",-1)),Ps=[Es],F=8,Us=ae({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(Z){const D=Z,j=S(()=>D.zigenFontClass||"zigen-font"),J=ce(D,"columnMinWidth"),Y=S(()=>`repeat(auto-fill, minmax(${J.value||"2rem"}, max-content))`),N=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],b=["'"],M=g(!1),x=g(!1),K=()=>{M.value=window.innerWidth<1280},ee=()=>{x.value=!x.value};Q(()=>{K(),window.addEventListener("resize",K)}),de(()=>{window.removeEventListener("resize",K)});const q=S(()=>N.flat()),se=["joy","light","star","ming","wafel"];function T(l){const a=se.includes(l);return{zigenUrl:`/zigen-${l}.csv`,chaifenUrl:a?"/chaifen.json":`/chaifen-${l}.json`}}const W=S(()=>D.defaultScheme||"star"),h=g(),E=g(),C=g(!1),w=g(new Map),A=g(0),P=g(null),$=g(null),z=g({}),U=g(!1);R(()=>D.defaultScheme,()=>{E.value=null,w.value.clear(),A.value=0,console.log("方案已切換，已清除例字緩存")});const I=S(()=>{var r;if(!h.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",h.value.size);const l={},a=[];for(const[e,u]of h.value){const n=u.font,c=(r=u.ma)==null?void 0:r.trim();if(!c||c.length===0||n==null)continue;const o=c[0].toLowerCase(),d=c.slice(1);a.push({font:n,ma:c,firstLetter:o,code:d})}console.log(`Found ${a.length} valid zigens`);for(let e=0;e<a.length;e++){const u=a[e],{font:n,ma:c,firstLetter:o,code:d}=u;l[o]||(l[o]={visible:[],hidden:[]});const f=e>0?a[e-1]:null,L=f&&f.code===d&&f.firstLetter===o;l[o].visible.find(oe=>oe.code===d)?L?l[o].hidden.push({font:n,code:d}):l[o].visible.push({font:n,code:d}):l[o].visible.push({font:n,code:d})}return console.log("Final result:",l),l}),H=S(()=>{var a;if(!h.value)return{};const l={};for(const r of q.value)l[r]=[];for(const[r,e]of h.value){const u=e.font,n=(a=e.ma)==null?void 0:a.trim();if(!n||u===null||u===void 0)continue;const c=n[0].toLowerCase(),o=n.slice(1),d=l[c].some(f=>f.code===o);l[c].push({font:u,code:o,isHidden:d})}return l}),te=async l=>{const a=l.normalize("NFC");let r=new Set;if(w.value.has(a)&&(r=w.value.get(a),console.log(`✅ 從緩存中獲取字根 "${a}" 的例字 ${r.size} 個`),r.size>=F))return Array.from(r);if(!E.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${l}(${a})" 搜索例字, cachedCheckedCount=${A.value}...`);const e=new Promise((o,d)=>{setTimeout(()=>d(new Error("數據加載超時")),1e4)}),u=await Promise.race([E.value.loadData(),e]),n=Object.entries(u).slice(0,3);console.log("數據樣本:",n);let c=0;for(const[o,d]of Object.entries(u).slice(A.value)){c++;const f=d;if(c<=5&&console.log(`字符 "${o}" 的拆分數據:`,f.d),f.d){for(const L of f.d){w.value.has(L)||w.value.set(L,new Set);const B=w.value.get(L);B.size<F&&B.add(o),L===a&&(r=B,console.log(`✅ 找到匹配: "${o}" 包含字根 "${a}", 拆分: "${f.d}"`))}if(r.size>=F)break}c%1e3===0&&console.log(`已檢查 ${c} 個字符，找到 ${r.size} 個例字`)}return A.value+=c,console.log(`字根 "${a}" 最終找到例字:`,Array.from(r).slice(0,5),`(總共${r.size}個)`),Array.from(r)}catch(e){return console.error("获取例字失败:",e),e instanceof Error&&e.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function O(){C.value=!0;try{const l=T(W.value),a=await ie(l.zigenUrl);h.value=a,console.log("我就知道你會忍不住打開控制臺😏"),console.log(`已加載字根數據，文件: ${l.zigenUrl}`),console.log("注意：拆分數據將在第一次點擊字根時才加載")}catch(l){console.error("加載字根數據失敗:",l)}finally{C.value=!1}}function X(l){switch(l){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function G(l,a){var c;if(l.stopPropagation(),!E.value){console.log("點擊時初始化拆分數據加載器...");const o=T(W.value);E.value=le.getInstance(o.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${o.chaifenUrl}`)}if(U.value&&P.value===a.font){V();return}P.value=a.font,U.value=!0;let r="";if(h.value){for(const[o,d]of h.value)if(d.font===a.font&&((c=d.ma)==null?void 0:c.slice(1))===a.code){r=d.ma;break}}const e=ne(a.font,r);$.value=e,console.log("開始獲取例字，字根數量:",[...e.visible,...e.hidden].length);const u={},n=[...e.visible,...e.hidden];for(const o of n){console.log(`正在獲取字根 "${o.font}" 的例字...`);const d=await te(o.font);console.log(`字根 "${o.font}" 找到例字:`,d.length,"個"),u[o.font]=d.slice(0,10)}z.value=u,console.log(`固定彈窗 - 字根 "${a.font}" 的最終例字:`,z.value)}function V(){U.value=!1,P.value=null,$.value=null,z.value={}}function ne(l,a){var u;const r=[],e=[];if(!h.value||!a)return{visible:r,hidden:e};for(const[n,c]of h.value){const o=c.font,d=(u=c.ma)==null?void 0:u.trim();!d||!o||o===null||o===void 0||d===a&&(o===l?r.unshift({font:o,code:d}):e.push({font:o,code:d}))}return{visible:r,hidden:e}}return R(()=>W.value,O),Q(()=>{O(),document.addEventListener("click",l=>{if(U.value){const a=document.querySelector(".pinned-popup");a&&!a.contains(l.target)&&V()}})}),(l,a)=>{var r;return s(),t("div",he,[C.value?(s(),t("div",fe,me)):p("",!0),C.value?p("",!0):(s(),t("div",ye,[ke,M.value?p("",!0):(s(),t("div",xe,[ze,i("button",{onClick:ee,class:m(["layout-toggle-btn",{"layout-toggle-active":x.value}]),title:x.value?"切換為網格布局":"切換為列表布局"},[x.value?(s(),t("span",we,"⊞")):(s(),t("span",Ce,"☰"))],10,be)]))])),!C.value&&h.value&&!M.value&&!x.value?(s(),t("div",$e,[(s(),t(y,null,k(N,(e,u)=>i("div",{key:u,class:"keyboard-row"},[(s(!0),t(y,null,k(e,n=>{var c;return s(),t("div",{key:n,class:m(["keyboard-key",{"empty-key":b.includes(n)}])},[i("div",Le,_(n.toUpperCase()),1),!b.includes(n)&&((c=I.value[n])==null?void 0:c.visible.length)>0?(s(),t("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:re({gridTemplateColumns:Y.value})},[(s(!0),t(y,null,k(I.value[n].visible,(o,d)=>(s(),t("span",{key:d,class:"zigen-item",onClick:f=>G(f,o)},[i("span",{class:m(j.value)},_(o.font),3),i("span",Ze,_(o.code),1)],8,Se))),128)),I.value[n].hidden.length>0?(s(),t("span",Me,"⋯")):p("",!0)],4)):b.includes(n)?p("",!0):(s(),t("div",Ee,[n==="/"?(s(),t("div",Pe,je)):n==="z"?(s(),t("div",Ae,Ke)):n==="a"?(s(),t("div",We,Ne)):n==="e"?(s(),t("div",qe,Oe)):n==="i"?(s(),t("div",Xe,Re)):n==="o"?(s(),t("div",Je,ss)):n==="u"?(s(),t("div",ts,is)):(s(),t("div",ls,_(X(n)),1))]))],2)}),128))])),64))])):p("",!0),!C.value&&h.value&&(M.value||x.value)?(s(),t("div",{key:3,class:m(["mobile-layout",{"desktop-list-layout":!M.value&&x.value}])},[(s(!0),t(y,null,k(q.value,e=>{var u;return s(),t("div",{key:e,class:m(["mobile-key-row",{"empty-mobile-key":b.includes(e)}])},[i("div",as,_(e.toUpperCase()),1),!b.includes(e)&&((u=H.value[e])==null?void 0:u.length)>0?(s(),t("div",cs,[i("div",ds,[(s(!0),t(y,null,k(H.value[e],(n,c)=>(s(),t("span",{key:`sorted-${c}`,class:m(["mobile-zigen-item",{"mobile-hidden-zigen":n.isHidden}]),onClick:o=>G(o,n)},[i("span",{class:m(j.value)},_(n.font),3),i("span",us,_(n.code),1)],10,rs))),128))])])):b.includes(e)?p("",!0):(s(),t("div",vs,[e==="/"?(s(),t("span",_s,"引導特殊符號")):e==="z"?(s(),t("span",hs,"引導拼音反查")):["a","e","i","o","u"].includes(e)?(s(),t("span",fs," 一碼上屏字 ")):(s(),t("span",gs,_(X(e)),1))]))],2)}),128))],2)):p("",!0),U.value&&P.value&&$.value?(s(),t("div",ps,[i("div",ms,[i("div",ys,[i("div",ks,[i("h3",xs," 編碼 "+_(((r=$.value.visible[0])==null?void 0:r.code)||P.value)+" 上的字根 ",1),i("button",{onClick:V,class:"close-btn"},"✕")]),i("div",zs,[(s(!0),t(y,null,k($.value.visible,(e,u)=>{var n;return s(),t("div",{key:`pinned-visible-${u}`,class:"zigen-row-inline"},[i("div",bs,[i("span",{class:m(j.value)},_(e.font),3)]),((n=z.value[e.font])==null?void 0:n.length)>0?(s(),t("div",Cs,[(s(!0),t(y,null,k(z.value[e.font].slice(0,F),c=>(s(),t("span",{key:c,class:"example-char zigen-font"},_(c),1))),128))])):(s(),t("div",ws,Ls))])}),128)),(s(!0),t(y,null,k($.value.hidden,(e,u)=>{var n;return s(),t("div",{key:`pinned-hidden-${u}`,class:"zigen-row-inline"},[i("div",Ss,[i("span",{class:m(j.value)},_(e.font),3)]),((n=z.value[e.font])==null?void 0:n.length)>0?(s(),t("div",Zs,[(s(!0),t(y,null,k(z.value[e.font].slice(0,8),c=>(s(),t("span",{key:c,class:"example-char zigen-font"},_(c),1))),128))])):(s(),t("div",Ms,Ps))])}),128))])])])])):p("",!0)])}}}),Bs=_e(Us,[["__scopeId","data-v-ff9d6c10"]]);export{Bs as Z};
