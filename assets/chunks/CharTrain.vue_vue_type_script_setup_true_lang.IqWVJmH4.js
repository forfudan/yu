var N=Object.defineProperty;var $=(c,t,s)=>t in c?N(c,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[t]=s;var _=(c,t,s)=>$(c,typeof t!="symbol"?t+"":t,s);import{c as T,f as U,m as A,d as C}from"./share.DnuYRLaV.js";import{d as M,E as v,l as S,v as E,c as f,o as u,m as r,t as m,n as w,e as k,b as z,p as L,a3 as V,a4 as O,a as b}from"./framework.D5VGNaZP.js";import{f as j}from"./share.BaGPHDUM.js";import{_ as D}from"./MultiChaifen.vue_vue_type_script_setup_true_lang.AYPZYDU4.js";function R(c,t){let s=null;return()=>{s||(s=setTimeout(()=>{c(),s=null},t))}}class B{constructor(t,s=""){_(this,"record");_(this,"progress",0);_(this,"saveLocal",R(()=>{window.localStorage.setItem(`yuhao_${this.name}_records`,JSON.stringify(this.record))},1e3));this.items=t,this.name=s;const e=window.localStorage.getItem(`yuhao_${this.name}_records`);e?this.record=JSON.parse(e):this.record=Array.from({length:this.items.length},(i,l)=>[-1,l]);let n=0;for(const i of this.record)i[0]!==-1&&++n;this.progress=n}first(){return{item:this.items[this.record[0][1]],isFirst:this.record[0][0]===-1}}nextSuccess(){const t=this.record.length-1,s=this.record[0],e=++s[0];e===0&&this.progress===s[1]&&this.progress++;let n=0;const i=[4,16,64,256];return e>i.length-1?(s[0]=8,n=t):(n=i[e],n>t&&(n=t)),this.record.copyWithin(0,1,n+1),this.record[n]=s,this.saveLocal(),this.first()}nextFail(){return this.record[0][0]=-1,this.saveLocal(),this.first()}}const J={key:0,class:"text-center py-16"},P={class:"mb-8"},W={class:"text-xl text-gray-600 mb-8"},Z={key:1},q={class:"flex justify-center mb-24"},G=["value","max"],H={class:"flex justify-around mb-8"},Q={key:0,class:"flex tracking-widest flex-col opacity-70"},X={key:1,class:"flex tracking-widest flex-col opacity-70"},Y={class:"font-bold text-xl"},K={class:"flex justify-center p-5"},ee={class:"font-mono"},te={key:0},se={key:1,class:"text-sm text-gray-500 mt-1"},ae={class:"font-mono text-blue-600"},ne={class:"text-gray-500 pb-16"},oe=M({__name:"TrainCard",props:{cards:{},name:{},chaifenMap:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(c){const t=c;let s;const e=v({name:"",key:""}),n=v(0),i=v(!0),l=v(!0),d=v(!1),p=v("");S(()=>{s=new B(t.cards,t.name);const o=s.first();e.value=o.item,i.value=o.isFirst,n.value=s.progress;const a=document.getElementById("input_el");a==null||a.focus()}),E(p,o=>{const a={的:"e",是:"i",我:"o",不:"u",了:"a"};(o.length>=e.value.key.length||t.ming&&a[e.value.name]&&o.toLowerCase()===a[e.value.name])&&(F(o),p.value="")});function F(o){const a=o.toLowerCase(),h=e.value.key.toLowerCase(),g={的:"e",是:"i",我:"o",不:"u",了:"a"};let y=a===h;!y&&t.ming&&g[e.value.name]&&(y=a===g[e.value.name]);let x;if(y?(x=s.nextSuccess(),l.value=!0):(x=s.nextFail(),l.value=!1),n.value>=t.cards.length){d.value=!0;return}e.value=x.item,i.value=x.isFirst,n.value=s.progress}function I(){s=new B(t.cards,t.name);const o=s.first();e.value=o.item,i.value=o.isFirst,n.value=s.progress,d.value=!1;const a=document.getElementById("input_el");a==null||a.focus()}return(o,a)=>{var h,g;return d.value?(u(),f("div",J,[r("div",P,[a[1]||(a[1]=r("div",{class:"text-6xl mb-4"},"🎉",-1)),a[2]||(a[2]=r("h2",{class:"text-4xl font-bold mb-2"},"恭喜你完成練習！",-1)),r("p",W,"你已经完成了 "+m(o.cards.length)+" 個項目的練習。感謝你的努力和堅持，爲中華文明和漢字的傳承又增添了一份力量！",1)]),r("div",{class:"space-y-4"},[r("button",{onClick:I,class:"btn btn-primary btn-lg px-8"}," 想要再訓練一輪嗎？ "),a[3]||(a[3]=r("div",{class:"text-sm text-gray-500"}," 繼續練習以巩固記憶 ",-1))])])):(u(),f("div",Z,[r("div",{class:w(["md:w-2/3 w-full shadow-sm my-12 pb-24 bg-opacity-10  rounded-md",{"bg-red-700":!l.value,"bg-slate-500":l.value}])},[r("div",q,[r("progress",{class:"progress w-full",value:n.value,max:o.cards.length},null,8,G)]),r("div",H,[r("div",{class:w(["text-6xl ",{"text-red-400":!l.value}])},m(e.value.name),3),o.mode==="z"?(u(),f("div",Q,[(u(),z(D,{chars:e.value.name,size:100,key:e.value.name,loc:""},null,8,["chars"]))])):k("",!0),o.mode==="g"&&o.chaifenMap?(u(),f("div",X,[a[4]||(a[4]=r("div",{class:"text-gray-500 text-sm"}," 相关的字： ",-1)),r("div",Y,m(L(j)(e.value.name,o.chaifenMap)),1)])):k("",!0)]),r("div",K,[V(r("input",{id:"input_el",type:"text",placeholder:"輸入編碼","onUpdate:modelValue":a[0]||(a[0]=y=>p.value=y),class:w(["input w-half max-w-xs input-bordered text-center input-sm dark:bg-slate-800 bg-white",{"input-error":!l.value}])},null,2),[[O,p.value]])]),r("div",{class:w(["text-center",{"opacity-0":!i.value}])},[a[7]||(a[7]=b("答案是 ",-1)),r("b",ee,m(e.value.key),1),o.mode==="z"?(u(),f("span",te,"（"+m((g=(h=o.chaifenMap)==null?void 0:h.get(e.value.name))==null?void 0:g.division)+"）",1)):k("",!0),t.ming&&["的","是","我","不","了"].includes(e.value.name)?(u(),f("div",se,[a[5]||(a[5]=b(" 也可直接使用韻碼 ",-1)),r("b",ae,m(e.value.name==="的"?"E":e.value.name==="是"?"I":e.value.name==="我"?"O":e.value.name==="不"?"U":e.value.name==="了"?"A":""),1),a[6]||(a[6]=b(" 直接上屏 ",-1))])):k("",!0)],2)],2),r("div",ne,"訓練進度："+m(n.value)+" / "+m(o.cards.length),1)]))}}}),re={key:1,class:"text-gray-700 text-center"},me=M({__name:"CharTrain",props:{name:{},chaifenUrl:{},zigenUrl:{},range:{},supplement:{type:Boolean},ming:{type:Boolean},wafel:{type:Boolean}},setup(c){const t=c;let s=t.name+"_char";const e=t.range;e&&(s+=`_${e[0]}_${e[1]}`);const n=v(C[s]),i=v();return S(async()=>{if(n.value&&i.value)return;i.value=await T(t.chaifenUrl);const l=await U(t.zigenUrl);let d=[...i.value.values()];e&&(d=d.slice(e[0],e[1])),n.value=d.map(p=>({name:p.char,key:A(p.division,l,t.supplement,t.ming,t.wafel)})),C[s]=n.value}),(l,d)=>n.value&&i.value?(u(),z(oe,{key:0,name:L(s),cards:n.value,chaifenMap:i.value,mode:"z",supplement:l.supplement,ming:l.ming},null,8,["name","cards","chaifenMap","supplement","ming"])):(u(),f("h2",re," 下载数据中…… "))}});export{me as _};
