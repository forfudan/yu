import{f as ie,C as ae}from"./share.DZjQ0EVH.js";import{d as ce,k as S,a9 as re,h as p,l as G,y as ue,v as J,c as t,o as s,e as m,m as l,n as h,F as k,C as x,t as v,O as de,_ as ve}from"./framework.D5VGNaZP.js";const fe={class:"zigen-map-container"},ge={key:0,class:"flex justify-center items-center py-8"},pe={key:1,class:"flex justify-between items-center mb-4"},me={key:0,class:"flex items-center space-x-4"},he={class:"flex items-center space-x-2"},_e=["title"],ye={key:0},ke={key:1},xe={key:0,class:"flex items-center space-x-2"},ze=["title"],be={key:0},Ce={key:1},we={key:1,class:"flex items-center space-x-2"},$e=["title"],Le={key:0},Ze={key:1},Se={key:2,class:"keyboard-layout"},Me={class:"key-label"},Ee=["onClick"],Ae={class:"zigen-code"},Pe={key:0,class:"more-indicator"},Ue={key:1,class:"text-xs text-gray-400 no-zigen-text"},Be={key:0,class:"vertical-text zigen-font"},De={key:1,class:"vertical-text zigen-font"},je={key:2,class:"vertical-text zigen-font"},Ke={key:3,class:"vertical-text zigen-font"},Fe={key:4,class:"vertical-text zigen-font"},We={key:5,class:"vertical-text zigen-font"},Ve={key:6,class:"vertical-text zigen-font"},Ne={key:7,class:"vertical-text single-line zigen-font"},Oe={class:"mobile-key-label"},Te={key:0,class:"mobile-zigen-container"},qe={class:"mobile-zigen-list text-indigo-800 dark:text-indigo-300"},He=["onClick"],Ie={class:"zigen-code"},Xe={key:1,class:"mobile-no-zigen"},Re={key:0,class:"mobile-key-desc zigen-font"},Ge={key:1,class:"mobile-key-desc zigen-font"},Je={key:2,class:"mobile-key-desc zigen-font"},Qe={key:3,class:"mobile-key-desc"},Ye={key:4,class:"pinned-popup"},et={class:"popup-container"},tt={class:"popup-body"},st={class:"popup-header"},nt={class:"popup-title"},ot={class:"zigen-rows text-indigo-800 dark:text-indigo-300"},lt={class:"zigen-header-inline current-zigen"},it={key:0,class:"example-chars-same-line"},at={key:1,class:"example-chars-same-line"},ct={class:"zigen-header-inline other-zigen"},rt={key:0,class:"example-chars-same-line"},ut={key:1,class:"example-chars-same-line"},j=8,dt=ce({__name:"ZigenMap",props:{defaultScheme:{},columnMinWidth:{},zigenFontClass:{}},setup(Q){const P=Q,U=S(()=>P.zigenFontClass||"zigen-font"),Y=re(P,"columnMinWidth"),ee=S(()=>`repeat(auto-fill, minmax(${Y.value||"2rem"}, max-content))`),N=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l",";"],["z","x","c","v","b","n","m",",",".","/"]],b=["'"],C=p(!1),_=p(!1),y=p(!1),K=()=>{C.value=window.innerWidth<1280},te=()=>{_.value=!_.value},O=()=>{y.value=!y.value};G(()=>{K(),window.addEventListener("resize",K)}),ue(()=>{window.removeEventListener("resize",K)});const T=S(()=>{const a=N.flat();return y.value?a.slice().sort((e,r)=>{const n=/^[a-zA-Z]$/.test(e),u=/^[a-zA-Z]$/.test(r);return n&&!u?-1:!n&&u?1:e.localeCompare(r)}):a}),se=["joy","light","star","ming","wafel"];function q(a){const e=se.includes(a);return{zigenUrl:`/zigen-${a}.csv`,chaifenUrl:e?"/chaifen.json":`/chaifen-${a}.json`}}const F=S(()=>P.defaultScheme||"star"),f=p(),M=p(),w=p(!1),$=p(new Map),B=p(0),E=p(null),L=p(null),z=p({}),A=p(!1);J(()=>P.defaultScheme,()=>{M.value=null,$.value.clear(),B.value=0,console.log("方案已切換，已清除例字緩存")});const W=S(()=>{var r;if(!f.value)return console.log("No zigenMap data"),{};console.log("ZigenMap has data, size:",f.value.size);const a={},e=[];for(const[n,u]of f.value){const o=u.font,c=(r=u.ma)==null?void 0:r.trim();if(!c||c.length===0||o==null)continue;const i=c[0].toLowerCase(),d=c.slice(1);e.push({font:o,ma:c,firstLetter:i,code:d})}console.log(`Found ${e.length} valid zigens`);for(let n=0;n<e.length;n++){const u=e[n],{font:o,ma:c,firstLetter:i,code:d}=u;a[i]||(a[i]={visible:[],hidden:[]});const g=n>0?e[n-1]:null,Z=g&&g.code===d&&g.firstLetter===i;a[i].visible.find(le=>le.code===d)?Z?a[i].hidden.push({font:o,code:d}):a[i].visible.push({font:o,code:d}):a[i].visible.push({font:o,code:d})}return console.log("Final result:",a),a}),H=S(()=>{var e;if(!f.value)return{};const a={};for(const r of T.value)a[r]=[];for(const[r,n]of f.value){const u=n.font,o=(e=n.ma)==null?void 0:e.trim();if(!o||u===null||u===void 0)continue;const c=o[0].toLowerCase(),i=o.slice(1),d=a[c].some(g=>g.code===i);a[c].push({font:u,code:i,isHidden:d})}return a}),ne=async a=>{const e=a.normalize("NFC");let r=new Set;if($.value.has(e)&&(r=$.value.get(e),console.log(`✅ 從緩存中獲取字根 "${e}" 的例字 ${r.size} 個`),r.size>=j))return Array.from(r);if(!M.value)return console.log("chaifenLoader 未初始化"),[];try{console.log(`開始為字根 "${a}(${e})" 搜索例字, cachedCheckedCount=${B.value}...`);const n=new Promise((i,d)=>{setTimeout(()=>d(new Error("數據加載超時")),1e4)}),u=await Promise.race([M.value.loadData(),n]),o=Object.entries(u).slice(0,3);console.log("數據樣本:",o);let c=0;for(const[i,d]of Object.entries(u).slice(B.value)){c++;const g=d;if(c<=5&&console.log(`字符 "${i}" 的拆分數據:`,g.d),g.d){for(const Z of g.d){$.value.has(Z)||$.value.set(Z,new Set);const D=$.value.get(Z);D.size<j&&D.add(i),Z===e&&(r=D,console.log(`✅ 找到匹配: "${i}" 包含字根 "${e}", 拆分: "${g.d}"`))}if(r.size>=j)break}c%1e3===0&&console.log(`已檢查 ${c} 個字符，找到 ${r.size} 個例字`)}return B.value+=c,console.log(`字根 "${e}" 最終找到例字:`,Array.from(r).slice(0,5),`(總共${r.size}個)`),Array.from(r)}catch(n){return console.error("获取例字失败:",n),n instanceof Error&&n.message==="數據加載超時"&&console.error("數據加載超時，請檢查網絡連接"),[]}};async function I(){w.value=!0;try{const a=q(F.value),e=await ie(a.zigenUrl);f.value=e,console.log("我就知道你會忍不住打開控制臺😏"),console.log(`已加載字根數據，文件: ${a.zigenUrl}`),console.log("注意：拆分數據將在第一次點擊字根時才加載")}catch(a){console.error("加載字根數據失敗:",a)}finally{w.value=!1}}function X(a){switch(a){case";":return"次選";case",":return"逗號";case".":return"句號";default:return"无字根"}}async function R(a,e){var c;if(a.stopPropagation(),!M.value){console.log("點擊時初始化拆分數據加載器...");const i=q(F.value);M.value=ae.getInstance(i.chaifenUrl),console.log(`已初始化 ChaiDataLoader，使用文件: ${i.chaifenUrl}`)}if(A.value&&E.value===e.font){V();return}E.value=e.font,A.value=!0;let r="";if(f.value){for(const[i,d]of f.value)if(d.font===e.font&&((c=d.ma)==null?void 0:c.slice(1))===e.code){r=d.ma;break}}const n=oe(e.font,r);L.value=n,console.log("開始獲取例字，字根數量:",[...n.visible,...n.hidden].length);const u={},o=[...n.visible,...n.hidden];for(const i of o){console.log(`正在獲取字根 "${i.font}" 的例字...`);const d=await ne(i.font);console.log(`字根 "${i.font}" 找到例字:`,d.length,"個"),u[i.font]=d.slice(0,10)}z.value=u,console.log(`固定彈窗 - 字根 "${e.font}" 的最終例字:`,z.value)}function V(){A.value=!1,E.value=null,L.value=null,z.value={}}function oe(a,e){var u;const r=[],n=[];if(!f.value||!e)return{visible:r,hidden:n};for(const[o,c]of f.value){const i=c.font,d=(u=c.ma)==null?void 0:u.trim();!d||!i||i===null||i===void 0||d===e&&(i===a?r.unshift({font:i,code:d}):n.push({font:i,code:d}))}return{visible:r,hidden:n}}return J(()=>F.value,I),G(()=>{I(),document.addEventListener("click",a=>{if(A.value){const e=document.querySelector(".pinned-popup");e&&!e.contains(a.target)&&V()}})}),(a,e)=>{var r;return s(),t("div",fe,[w.value?(s(),t("div",ge,[...e[0]||(e[0]=[l("div",{class:"loading loading-spinner loading-lg"},null,-1),l("span",{class:"ml-2"},"正在加載字根數據...",-1)])])):m("",!0),w.value?m("",!0):(s(),t("div",pe,[e[4]||(e[4]=l("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 點擊字根可查看例字 ",-1)),C.value?m("",!0):(s(),t("div",me,[l("div",he,[e[1]||(e[1]=l("span",{class:"text-xs text-gray-400"},"切換字根圖和字根表：",-1)),l("button",{onClick:te,class:h(["layout-toggle-btn",{"layout-toggle-active":_.value}]),title:_.value?"切換為網格布局":"切換為列表布局"},[_.value?(s(),t("span",ke,"⊞")):(s(),t("span",ye,"☰"))],10,_e)]),_.value?(s(),t("div",xe,[e[2]||(e[2]=l("span",{class:"text-xs text-gray-400"},"按鍵排序：",-1)),l("button",{onClick:O,class:h(["layout-toggle-btn",{"layout-toggle-active":y.value}]),title:y.value?"切換為鍵盤順序":"切換為字母順序"},[y.value?(s(),t("span",Ce,"⌨️")):(s(),t("span",be,"🔤"))],10,ze)])):m("",!0)])),C.value?(s(),t("div",we,[e[3]||(e[3]=l("span",{class:"text-xs text-gray-400"},"按鍵排序：",-1)),l("button",{onClick:O,class:h(["layout-toggle-btn",{"layout-toggle-active":y.value}]),title:y.value?"切換為鍵盤順序":"切換為字母順序"},[y.value?(s(),t("span",Ze,"⌨️")):(s(),t("span",Le,"🔤"))],10,$e)])):m("",!0)])),!w.value&&f.value&&!C.value&&!_.value?(s(),t("div",Se,[(s(),t(k,null,x(N,(n,u)=>l("div",{key:u,class:"keyboard-row"},[(s(!0),t(k,null,x(n,o=>{var c;return s(),t("div",{key:o,class:h(["keyboard-key",{"empty-key":b.includes(o)}])},[l("div",Me,v(o.toUpperCase()),1),!b.includes(o)&&((c=W.value[o])==null?void 0:c.visible.length)>0?(s(),t("div",{key:0,class:"zigen-list text-indigo-800 dark:text-indigo-300",style:de({gridTemplateColumns:ee.value})},[(s(!0),t(k,null,x(W.value[o].visible,(i,d)=>(s(),t("span",{key:d,class:"zigen-item",onClick:g=>R(g,i)},[l("span",{class:h(U.value)},v(i.font),3),l("span",Ae,v(i.code),1)],8,Ee))),128)),W.value[o].hidden.length>0?(s(),t("span",Pe,"⋯")):m("",!0)],4)):b.includes(o)?m("",!0):(s(),t("div",Ue,[o==="/"?(s(),t("div",Be,[...e[5]||(e[5]=[l("div",null,"引導特殊符號",-1),l("div",null,"切換多重註解",-1)])])):o==="z"?(s(),t("div",De,[...e[6]||(e[6]=[l("div",null,"引導拼音反查",-1),l("div",null,"引導歷史輸入",-1)])])):o==="a"?(s(),t("div",je,[...e[7]||(e[7]=[l("div",null,null,-1),l("div",null,"一碼上屏字　了",-1)])])):o==="e"?(s(),t("div",Ke,[...e[8]||(e[8]=[l("div",null,null,-1),l("div",null,"一碼上屏字　的",-1)])])):o==="i"?(s(),t("div",Fe,[...e[9]||(e[9]=[l("div",null,null,-1),l("div",null,"一碼上屏字　是",-1)])])):o==="o"?(s(),t("div",We,[...e[10]||(e[10]=[l("div",null,null,-1),l("div",null,"一碼上屏字　我",-1)])])):o==="u"?(s(),t("div",Ve,[...e[11]||(e[11]=[l("div",null,null,-1),l("div",null,"一碼上屏字　不",-1)])])):(s(),t("div",Ne,v(X(o)),1))]))],2)}),128))])),64))])):m("",!0),!w.value&&f.value&&(C.value||_.value)?(s(),t("div",{key:3,class:h(["mobile-layout",{"desktop-list-layout":!C.value&&_.value}])},[(s(!0),t(k,null,x(T.value,n=>{var u;return s(),t("div",{key:n,class:h(["mobile-key-row",{"empty-mobile-key":b.includes(n)}])},[l("div",Oe,v(n.toUpperCase()),1),!b.includes(n)&&((u=H.value[n])==null?void 0:u.length)>0?(s(),t("div",Te,[l("div",qe,[(s(!0),t(k,null,x(H.value[n],(o,c)=>(s(),t("span",{key:`sorted-${c}`,class:h(["mobile-zigen-item",{"mobile-hidden-zigen":o.isHidden}]),onClick:i=>R(i,o)},[l("span",{class:h(U.value)},v(o.font),3),l("span",Ie,v(o.code),1)],10,He))),128))])])):b.includes(n)?m("",!0):(s(),t("div",Xe,[n==="/"?(s(),t("span",Re,"引導特殊符號")):n==="z"?(s(),t("span",Ge,"引導拼音反查")):["a","e","i","o","u"].includes(n)?(s(),t("span",Je," 一碼上屏字 ")):(s(),t("span",Qe,v(X(n)),1))]))],2)}),128))],2)):m("",!0),A.value&&E.value&&L.value?(s(),t("div",Ye,[l("div",et,[l("div",tt,[l("div",st,[l("h3",nt," 編碼 "+v(((r=L.value.visible[0])==null?void 0:r.code)||E.value)+" 上的字根 ",1),l("button",{onClick:V,class:"close-btn"},"✕")]),l("div",ot,[(s(!0),t(k,null,x(L.value.visible,(n,u)=>{var o;return s(),t("div",{key:`pinned-visible-${u}`,class:"zigen-row-inline"},[l("div",lt,[l("span",{class:h(U.value)},v(n.font),3)]),((o=z.value[n.font])==null?void 0:o.length)>0?(s(),t("div",it,[(s(!0),t(k,null,x(z.value[n.font].slice(0,j),c=>(s(),t("span",{key:c,class:"example-char zigen-font"},v(c),1))),128))])):(s(),t("div",at,[...e[12]||(e[12]=[l("span",{class:"loading-text"},"正在加載...",-1)])]))])}),128)),(s(!0),t(k,null,x(L.value.hidden,(n,u)=>{var o;return s(),t("div",{key:`pinned-hidden-${u}`,class:"zigen-row-inline"},[l("div",ct,[l("span",{class:h(U.value)},v(n.font),3)]),((o=z.value[n.font])==null?void 0:o.length)>0?(s(),t("div",rt,[(s(!0),t(k,null,x(z.value[n.font].slice(0,8),c=>(s(),t("span",{key:c,class:"example-char zigen-font"},v(c),1))),128))])):(s(),t("div",ut,[...e[13]||(e[13]=[l("span",{class:"loading-text"},"正在加載...",-1)])]))])}),128))])])])])):m("",!0)])}}}),gt=ve(dt,[["__scopeId","data-v-a5b5fe2e"]]);export{gt as Z};
