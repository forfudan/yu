import{d as b,H as r,k as C,y as f,l as I,o as i,c as u,m as o,ag as V,ah as $,a as L,t as w,e as k,b as S}from"./framework.rq0FYgLR.js";import{_ as T}from"./Search.vue_vue_type_script_setup_true_lang.DJcqL1vg.js";import{f as E}from"./share.Nrbaa2_l.js";import{C as F}from"./ChaiDataLoader.DYi6iwdM.js";const N={class:"input input-bordered bg-gray-100 dark:bg-slate-800 flex items-center gap-2 mt-2"},Z=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"h-4 w-4 opacity-70"},[o("path",{"fill-rule":"evenodd",d:"M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z","clip-rule":"evenodd"})],-1),j={key:0,class:"text-gray-600 text-center py-4"},O=o("div",{class:"loading loading-spinner loading-sm mr-2"},null,-1),P={key:1,class:"alert alert-error mt-2"},H=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),R={key:3,class:"opacity-40 text-center p-9 tracking-widest"},q={key:4,class:"text-gray-500 text-center py-4"},Q=b({__name:"OptimizedFetchSearch",props:{chaifenUrl:{},zigenUrl:{},supplement:{type:Boolean},ming:{type:Boolean},modelValue:{}},emits:["update:modelValue"],setup(x,{emit:M}){const l=x,z=M,m=r(),p=r(),n=r(!1),s=r(!1),t=r(l.modelValue||""),c=r(null),_=["小樓一夜聽春雨　深巷明朝賣杏花","休對故人思故國　且將新火試新茶","三十功名塵與土　八千里路雲和月","落花人獨立　微雨燕雙飛","玲瓏骰子安紅豆　入骨相思知不知","兩情若是久長時　又豈在朝朝暮暮","身無彩鳳雙飛翼　心有靈犀一點通","自在飛花輕似夢　無邊絲雨細如愁","醉後不知天在水　滿船清夢壓星河","東風夜放花千樹　更吹落　星如雨","鳳蕭聲動　玉壸光轉　一夜魚龍舞","爲君持酒勸斜陽　且向花間留晚照","綠楊煙外曉寒輕　紅杏枝頭春意鬧","城中桃李愁風雨　春在溪頭薺菜花","未是秋光奇绝　看十五十六","無可奈何花落去　似曾相識燕歸來","但願人長久　千里共嬋娟","大江東去　浪淘盡千古風流人物","明月幾時有　把酒問青天","一蓑煙雨任平生　也無風雨也無晴","縱豆蔻詞工　青樓夢好　難賦深情","衣帶漸寬終不悔　為伊消得人憔悴"],D=C(()=>{const e=Math.floor(Math.random()*_.length);return _[e]});f(()=>l.modelValue,e=>{e!==void 0&&e!==t.value&&(t.value=e,e.trim().length>0&&!s.value&&v())},{immediate:!0}),f(t,e=>{z("update:modelValue",e),e.trim().length>0&&!s.value&&v()}),f([s,t],([e,a])=>{e&&a&&a.trim().length>0&&console.log(`🔍 Data loaded, ready to search for: "${a}"`)});const B=F.getInstance(l.chaifenUrl);async function v(){if(s.value||n.value)return;n.value=!0,c.value=null;const e=performance.now();try{const[a,d]=await Promise.all([B.loadData(),E(l.zigenUrl)]),g=new Map;for(const[y,h]of Object.entries(a))g.set(y,{char:y,division:h.d||"",division_tw:h.dt||"",region:h.r||""});m.value=g,p.value=d,s.value=!0;const U=performance.now()-e;console.log(`🚀 Search data loaded in ${U.toFixed(2)}ms`),console.log(`📦 Characters: ${g.size}`),console.log(`📁 Source: ${l.chaifenUrl}`)}catch(a){console.error("Failed to load search data:",a),c.value=a instanceof Error?a.message:"Unknown error"}finally{n.value=!1}}return I(()=>{t.value.trim().length>0&&v()}),(e,a)=>(i(),u("div",null,[o("label",N,[V(o("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>t.value=d),type:"text",class:"grow",placeholder:"輸入漢字查詢拆分和編碼"},null,512),[[$,t.value]]),Z]),n.value?(i(),u("div",j,[O,L(" 正在加载拆分数据…… ")])):c.value?(i(),u("div",P,[H,o("span",null,"加载失败："+w(c.value),1)])):k("",!0),s.value&&m.value&&p.value?(i(),S(T,{key:2,chaifenMap:m.value,zigenMap:p.value,supplement:l.supplement,ming:l.ming||!1,userInput:t.value,"onUpdate:userInput":a[1]||(a[1]=d=>t.value=d)},null,8,["chaifenMap","zigenMap","supplement","ming","userInput"])):!t.value.trim()&&!n.value&&!c.value?(i(),u("div",R,w(D.value),1)):t.value.trim().length>0&&!n.value?(i(),u("div",q," 开始输入以查看拆分…… ")):k("",!0)]))}});export{Q as _};
