var $=Object.defineProperty;var T=(c,t,s)=>t in c?$(c,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[t]=s;var _=(c,t,s)=>T(c,typeof t!="symbol"?t+"":t,s);import{f as C,m as U,c as B}from"./share.D5aqWrzv.js";import{d as S,E as v,l as L,v as A,c as h,o as u,m as r,t as m,n as k,e as w,b as z,p as F,a3 as E,a4 as V,a as b}from"./framework.D5VGNaZP.js";import{f as j}from"./share.BaGPHDUM.js";import{_ as D}from"./MultiChaifen.vue_vue_type_script_setup_true_lang.Co-Brw8Z.js";function O(c,t){let s=null;return()=>{s||(s=setTimeout(()=>{c(),s=null},t))}}class M{constructor(t,s=""){_(this,"record");_(this,"progress",0);_(this,"saveLocal",O(()=>{window.localStorage.setItem(`yuhao_${this.name}_records`,JSON.stringify(this.record))},1e3));this.items=t,this.name=s;const e=window.localStorage.getItem(`yuhao_${this.name}_records`);e?this.record=JSON.parse(e):this.record=Array.from({length:this.items.length},(i,l)=>[-1,l]);let n=0;for(const i of this.record)i[0]!==-1&&++n;this.progress=n}first(){return{item:this.items[this.record[0][1]],isFirst:this.record[0][0]===-1}}nextSuccess(){const t=this.record.length-1,s=this.record[0],e=++s[0];e===0&&this.progress===s[1]&&this.progress++;let n=0;const i=[4,16,64,256];return e>i.length-1?(s[0]=8,n=t):(n=i[e],n>t&&(n=t)),this.record.copyWithin(0,1,n+1),this.record[n]=s,this.saveLocal(),this.first()}nextFail(){return this.record[0][0]=-1,this.saveLocal(),this.first()}}const R={key:0,class:"text-center py-16"},J={class:"mb-8"},P={class:"text-xl text-gray-600 mb-8"},W={key:1},Z={class:"flex justify-center mb-24"},q=["value","max"],G={class:"flex justify-around mb-8"},H={key:0,class:"flex tracking-widest flex-col opacity-70"},Q={key:1,class:"flex tracking-widest flex-col opacity-70"},X={class:"font-bold text-xl"},Y={class:"flex justify-center p-5"},K={class:"font-mono"},ee={key:0},te={key:1,class:"text-sm text-gray-500 mt-1"},se={class:"font-mono text-blue-600"},ae={class:"text-gray-500 pb-16"},ne=S({__name:"TrainCard",props:{cards:{},name:{},chaifenMap:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(c){const t=c;let s;const e=v({name:"",key:""}),n=v(0),i=v(!0),l=v(!0),d=v(!1),p=v("");L(()=>{s=new M(t.cards,t.name);const o=s.first();e.value=o.item,i.value=o.isFirst,n.value=s.progress;const a=document.getElementById("input_el");a==null||a.focus()}),A(p,o=>{const a={的:"e",是:"i",我:"o",不:"u",了:"a"};(o.length>=e.value.key.length||t.ming&&a[e.value.name]&&o.toLowerCase()===a[e.value.name])&&(I(o),p.value="")});function I(o){const a=o.toLowerCase(),f=e.value.key.toLowerCase(),g={的:"e",是:"i",我:"o",不:"u",了:"a"};let y=a===f;!y&&t.ming&&g[e.value.name]&&(y=a===g[e.value.name]);let x;if(y?(x=s.nextSuccess(),l.value=!0):(x=s.nextFail(),l.value=!1),n.value>=t.cards.length){d.value=!0;return}e.value=x.item,i.value=x.isFirst,n.value=s.progress}function N(){s=new M(t.cards,t.name);const o=s.first();e.value=o.item,i.value=o.isFirst,n.value=s.progress,d.value=!1;const a=document.getElementById("input_el");a==null||a.focus()}return(o,a)=>{var f,g;return d.value?(u(),h("div",R,[r("div",J,[a[1]||(a[1]=r("div",{class:"text-6xl mb-4"},"🎉",-1)),a[2]||(a[2]=r("h2",{class:"text-4xl font-bold mb-2"},"恭喜你完成練習！",-1)),r("p",P,"你已经完成了 "+m(o.cards.length)+" 個項目的練習。感謝你的努力和堅持，爲中華文明和漢字的傳承又增添了一份力量！",1)]),r("div",{class:"space-y-4"},[r("button",{onClick:N,class:"btn btn-primary btn-lg px-8"}," 想要再訓練一輪嗎？ "),a[3]||(a[3]=r("div",{class:"text-sm text-gray-500"}," 繼續練習以巩固記憶 ",-1))])])):(u(),h("div",W,[r("div",{class:k(["md:w-2/3 w-full shadow-sm my-12 pb-24 bg-opacity-10  rounded-md",{"bg-red-700":!l.value,"bg-slate-500":l.value}])},[r("div",Z,[r("progress",{class:"progress w-full",value:n.value,max:o.cards.length},null,8,q)]),r("div",G,[r("div",{class:k(["text-6xl ",{"text-red-400":!l.value}])},m(e.value.name),3),o.mode==="z"?(u(),h("div",H,[(u(),z(D,{chars:e.value.name,size:100,key:e.value.name,loc:""},null,8,["chars"]))])):w("",!0),o.mode==="g"&&o.chaifenMap?(u(),h("div",Q,[a[4]||(a[4]=r("div",{class:"text-gray-500 text-sm"}," 相关的字： ",-1)),r("div",X,m(F(j)(e.value.name,o.chaifenMap)),1)])):w("",!0)]),r("div",Y,[E(r("input",{id:"input_el",type:"text",placeholder:"輸入編碼","onUpdate:modelValue":a[0]||(a[0]=y=>p.value=y),class:k(["input w-half max-w-xs input-bordered text-center input-sm dark:bg-slate-800 bg-white",{"input-error":!l.value}])},null,2),[[V,p.value]])]),r("div",{class:k(["text-center",{"opacity-0":!i.value}])},[a[7]||(a[7]=b("答案是 ",-1)),r("b",K,m(e.value.key),1),o.mode==="z"?(u(),h("span",ee,"（"+m((g=(f=o.chaifenMap)==null?void 0:f.get(e.value.name))==null?void 0:g.division)+"）",1)):w("",!0),t.ming&&["的","是","我","不","了"].includes(e.value.name)?(u(),h("div",te,[a[5]||(a[5]=b(" 也可直接使用韻碼 ",-1)),r("b",se,m(e.value.name==="的"?"E":e.value.name==="是"?"I":e.value.name==="我"?"O":e.value.name==="不"?"U":e.value.name==="了"?"A":""),1),a[6]||(a[6]=b(" 直接上屏 ",-1))])):w("",!0)],2)],2),r("div",ae,"訓練進度："+m(n.value)+" / "+m(o.cards.length),1)]))}}}),oe={key:1,class:"text-gray-700 text-center"},de=S({__name:"CharTrain",props:{name:{},chaifenUrl:{},zigenUrl:{},range:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(c){const t=c;let s=t.name+"_char";const e=t.range;e&&(s+=`_${e[0]}_${e[1]}`);const n=v(B[s]),i=v();return L(async()=>{if(n.value&&i.value)return;i.value=await C(t.chaifenUrl);const l=await C(t.zigenUrl);let d=[...i.value.values()];e&&(d=d.slice(e[0],e[1])),n.value=d.map(p=>({name:p.char,key:U(p.division,l,t.supplement,t.ming)})),B[s]=n.value}),(l,d)=>n.value&&i.value?(u(),z(ne,{key:0,name:F(s),cards:n.value,chaifenMap:i.value,mode:"z",supplement:l.supplement,ming:l.ming},null,8,["name","cards","chaifenMap","supplement","ming"])):(u(),h("h2",oe," 下载数据中…… "))}});export{de as _};
