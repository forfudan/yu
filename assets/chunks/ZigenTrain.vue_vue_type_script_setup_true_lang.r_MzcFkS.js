import{c as ce,f as ge}from"./share.Bj6ex72H.js";import{A as ae}from"./advancedSchedule.ChzbWpT_.js";import{d as re,h as v,l as K,R as N,aa as ee,k as _,v as ve,c as u,o as i,F as H,e as M,m as n,t as k,p as j,n as r,O as pe,C as te,a3 as fe,a4 as xe,a as ne,a0 as me,a2 as ye,_ as he,E as J,H as be}from"./framework.D3o4Ln5n.js";import{f as ke}from"./share.DRmL_k0C.js";const we={key:0,class:"text-center py-16"},Ce={class:"mb-8"},Se={class:"text-xl text-gray-600 dark:text-gray-400 mb-8"},_e={class:"relative"},$e={key:0,class:"text-red-600 dark:text-red-400"},ze=["title"],Be={class:"zigen-font"},je={class:"font-mono"},Te={class:"flex items-center gap-1"},Fe={class:"flex items-center gap-1"},Ge={key:1,class:"text-blue-600 dark:text-blue-400 font-medium"},Le=re({__name:"TrainCardGroup",props:{name:{},cardGroups:{},chaifenMap:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean},isFrequencyOrder:{type:Boolean},onToggleSort:{type:Function},onReset:{type:Function}},setup(W){const p=W,{name:E,cardGroups:x,mode:Z,supplement:f,ming:O,isFrequencyOrder:S,onToggleSort:T,onReset:I}=p;console.log(`載入分組練習會話: ${E}`);const m=new ae(E),$=v(0),F=v(),w=v(""),y=v(!1),h=v(!0),G=v(0),z=v(!1),L=v(0),D=v(!1);v(10);const o=v([]);v(0);const s=v(0);v(2e3);const c=()=>{z.value=!0},B=()=>{I&&(I(),z.value=!1,setTimeout(()=>{window.location.reload()},100))},b=()=>{z.value=!1},t=v(typeof window<"u"?window.innerWidth:1024),C=()=>{t.value=window.innerWidth};K(()=>{typeof window<"u"&&window.addEventListener("resize",C),N(()=>{var e;(e=F.value)==null||e.focus()}),document.addEventListener("keydown",V),U()}),ee(()=>{typeof window<"u"&&window.removeEventListener("resize",C),document.removeEventListener("keydown",V)});const g=_(()=>{if(!d.value)return"text-8xl";const e=d.value.zigens.length,a=t.value<768,l=t.value<1024;return a?e<=2?"text-6xl":e<=4?"text-5xl":"text-4xl":l?e<=2?"text-8xl":e<=4?"text-7xl":"text-6xl":e<=2?"text-9xl":e<=4?"text-8xl":"text-7xl"}),R=_(()=>{if(!d.value)return"gap-8 lg:gap-12";const e=d.value.zigens.length;return t.value<768?e>4?"gap-1":e>2?"gap-2":"gap-3":e>4?"gap-6":"gap-8 lg:gap-12"}),d=_(()=>x[$.value]||null);_(()=>x.length);const q=_(()=>{L.value;const e=m.getProgressStats();return{current:e.practiced,total:e.total,mastered:e.mastered,percentage:e.percentage.toFixed(1)}}),oe=_(()=>q.value.percentage),Q=_(()=>d.value?d.value.zigens.some(e=>e.font&&e.font.trim()!==""&&e.pinyin&&e.pinyin.trim()!==""):!1),se=_(()=>!Q.value||!d.value?[]:d.value.zigens.filter(e=>e.font&&e.font.trim()!==""&&e.pinyin&&e.pinyin.trim()!==""&&e.pinyin!=="Ø").map(e=>({font:e.font,pinyin:e.pinyin}))),le=_(()=>(L.value,m.isCompleted()));ve(w,e=>{if(!d.value)return;const a=e.trim().toLowerCase(),l=d.value.code.toLowerCase();a.length>=l.length&&(a===l?ue():y.value||X())});const ue=()=>{d.value&&(h.value=!0,m.recordSuccess($.value),L.value++,U())},X=()=>{d.value&&(h.value=!1,G.value++,y.value=!0,m.recordFailure($.value),L.value++,w.value="",N(()=>{var e;(e=F.value)==null||e.focus()}))},U=()=>{const e=m.getNextIndex();if(e!==null)$.value=e;else return;h.value=!0,G.value=0,w.value="",m.isFirstTime($.value)?y.value=!0:y.value=!1,N(()=>{var a;(a=F.value)==null||a.focus()})},ie=()=>{D.value||(m.reset(),$.value=0,w.value="",y.value=!1,h.value=!0,G.value=0,o.value=[],s.value=0,m.initializeWithGroupCount(x.length),U(),L.value++,o.value.push(`[${new Date().toLocaleTimeString()}] 學習進度已重置`))},de=()=>{ie()},V=e=>{e.key==="Escape"&&!y.value&&(X(),e.preventDefault())},Y=e=>{const a=ke(e,p.chaifenMap),l=t.value<768,A=t.value<1024;let P=4;return l?P=2:A&&(P=3),a.slice(0,P).split("").join("")};return K(()=>{m.initializeWithGroupCount(x.length),N(()=>{var e;(e=F.value)==null||e.focus()}),document.addEventListener("keydown",V),U()}),ee(()=>{document.removeEventListener("keydown",V)}),(e,a)=>(i(),u(H,null,[le.value?(i(),u("div",we,[n("div",Ce,[a[3]||(a[3]=n("div",{class:"text-6xl mb-4"},"🎉",-1)),a[4]||(a[4]=n("h2",{class:"text-4xl font-bold mb-2"},"恭喜你完成練習！",-1)),n("p",Se," 你已經完成了 "+k(j(x).length)+" 個字根組的練習。 感謝你的努力和堅持，為中華文明和漢字的傳承又增添了一份力量！ ",1)]),n("div",{class:"space-y-4"},[n("button",{onClick:de,class:"px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 font-medium"}," 想要再訓練一輪嗎？ "),a[5]||(a[5]=n("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," 繼續練習以鞏固記憶 ",-1))])])):d.value?(i(),u("div",{key:1,class:r(["mx-auto p-6 space-y-6",t.value<768?"max-w-sm p-3 space-y-3":"max-w-2xl"])},[n("div",_e,[n("div",{class:r(["text-center text-gray-600 dark:text-gray-400",t.value<768?"text-xs":"text-sm"])},[n("div",{class:r(["flex justify-between items-center",t.value<768?"mb-1":"mb-2"])},[n("span",null,"已練習: "+k(q.value.current)+" / "+k(q.value.total)+" ("+k(q.value.percentage)+"%) | 已掌握: "+k(q.value.mastered),1),G.value>0?(i(),u("span",$e,"錯誤次數: "+k(G.value),1)):M("",!0)],2),n("div",{class:r(["w-full bg-gray-200 dark:bg-gray-700 rounded-full",t.value<768?"h-1.5":"h-2"])},[n("div",{class:r(["bg-blue-500 dark:bg-blue-400 rounded-full transition-all duration-300",t.value<768?"h-1.5":"h-2"]),style:pe(`width: ${oe.value}%`)},null,6)],2)],2)]),n("div",{class:r(["w-full shadow-lg rounded-2xl transition-all duration-300 transform relative",{"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":!h.value,"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":h.value},"border-2 hover:shadow-xl"])},[n("div",{class:r(["absolute flex gap-2 z-10",t.value<768?"bottom-2 right-2":"bottom-4 right-4"])},[j(T)?(i(),u("button",{key:0,onClick:a[0]||(a[0]=(...l)=>j(T)&&j(T)(...l)),class:r(["rounded-full font-medium transition-all duration-200 flex items-center justify-center shadow-md",t.value<768?"w-6 h-6 text-xs":"w-8 h-8 text-xs",j(S)?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-200 hover:bg-gray-300 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200"]),title:j(S)?"字頻序 (點擊切換到字典序)":"字典序 (點擊切換到字頻序)"},[(i(),u("svg",{class:r(t.value<768?"w-2 h-2":"w-3 h-3"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[6]||(a[6]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"},null,-1)])],2))],10,ze)):M("",!0),j(I)?(i(),u("button",{key:1,onClick:c,class:r(["rounded-full bg-red-500 hover:bg-red-600 text-white font-medium transition-all duration-200 flex items-center justify-center shadow-md",t.value<768?"w-6 h-6 text-xs":"w-8 h-8 text-xs"]),title:"重新開始訓練"},[(i(),u("svg",{class:r(t.value<768?"w-2 h-2":"w-3 h-3"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[7]||(a[7]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],2)):M("",!0)],2),n("div",{class:r(["text-center flex items-center justify-center",t.value<768?"h-32":"h-48"])},[n("div",{class:r(["flex justify-center items-center flex-wrap",R.value])},[(i(!0),u(H,null,te(d.value.zigens,(l,A)=>(i(),u("div",{key:A,class:"flex flex-col items-center group"},[n("div",{class:r(["zigen-font transform transition-all duration-300 group-hover:scale-110",t.value<768?"mb-1":"mb-4",g.value,{"text-red-500 dark:text-red-400":!h.value,"text-blue-700 dark:text-blue-300":h.value}])},k(l.font),3),Y(l.font)?(i(),u("div",{key:0,class:r(["text-gray-600 dark:text-gray-300 font-medium tracking-tight zigen-font",t.value<768?"mt-0.5":"mt-2",{"text-xs":t.value<768,"text-base":t.value>=768&&t.value<1024,"text-lg":t.value>=1024}])},k(Y(l.font)),3)):M("",!0)]))),128))],2)],2),n("div",{class:r(["flex justify-center",t.value<768?"pt-2 pb-3":"pt-4 pb-8"])},[fe(n("input",{ref_key:"inputElement",ref:F,"onUpdate:modelValue":a[1]||(a[1]=l=>w.value=l),type:"text",placeholder:"編碼",class:r(["text-center border-2 rounded-xl font-mono","transition-all duration-300 focus:outline-none focus:ring-4",t.value<768?"px-3 py-2 text-lg w-32":"px-6 py-4 text-2xl w-48",{"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50 dark:border-red-700 dark:focus:border-red-500 dark:focus:ring-red-900/50 dark:bg-red-900/20 dark:text-white":!h.value,"border-blue-300 focus:border-blue-500 focus:ring-blue-200 bg-white dark:border-blue-700 dark:focus:border-blue-500 dark:focus:ring-blue-900/50 dark:bg-gray-800 dark:text-white":h.value}])},null,2),[[xe,w.value]])],2),n("div",{class:r(["text-center transition-all duration-300",t.value<768?"pb-3":"pb-8",{"opacity-0 transform translate-y-2":!y.value,"opacity-100":y.value}])},[n("div",{class:r(["inline-block bg-gray-100 dark:bg-gray-800 rounded-lg",t.value<768?"px-2 py-1":"px-4 py-2"])},[n("span",{class:r(["text-gray-800 dark:text-gray-200",t.value<768?"text-sm":""])},"答案是 ",2),n("span",{class:r(["font-mono font-bold text-blue-600 dark:text-blue-400",t.value<768?"text-lg":"text-xl"])},k(d.value.code),3)],2)],2)],2),Q.value?(i(),u("div",{key:0,class:r(["mx-auto max-w-md mt-4",t.value<768?"max-w-xs mt-2":"max-w-md mt-4"])},[n("div",{class:r(["border-2 border-dashed border-blue-300 dark:border-blue-600 rounded-lg bg-blue-50 dark:bg-blue-900/20 p-3 transition-all duration-300",t.value<768?"p-2":"p-3"])},[n("div",{class:r(["text-center font-medium text-blue-800 dark:text-blue-300 mb-2",t.value<768?"text-xs mb-1":"text-sm mb-2"])}," 漢語拼音 到 聲碼韻碼 關係解析 ",2),n("div",{class:r(["text-center space-y-1",t.value<768?"text-xs space-y-0.5":"text-sm space-y-1"])},[(i(!0),u(H,null,te(se.value,(l,A)=>(i(),u("div",{key:`${l.font}-${l.pinyin}-${A}`,class:r(["text-blue-700 dark:text-blue-300"])},[n("span",Be,k(l.font),1),n("span",je," ("+k(l.pinyin)+")",1)]))),128))],2)],2)],2)):M("",!0),n("div",{class:r(["text-center text-gray-500 dark:text-gray-400 space-y-1",t.value<768?"text-xs":"text-sm"])},[y.value?(i(),u("div",Ge," 繼續輸入正確編碼 ")):(i(),u("div",{key:0,class:r(["flex items-center justify-center",t.value<768?"gap-2 flex-col":"gap-4"])},[n("span",Te,[n("kbd",{class:r(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",t.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"輸入",2),a[8]||(a[8]=ne(" 自動檢查 ",-1))]),n("span",Fe,[n("kbd",{class:r(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",t.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"Esc",2),a[9]||(a[9]=ne(" 顯示答案 ",-1))])],2))],2)],2)):M("",!0),z.value?(i(),u("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:b},[n("div",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm mx-4 shadow-xl",onClick:a[2]||(a[2]=me(()=>{},["stop"]))},[a[10]||(a[10]=ye('<div class="flex items-center gap-3 mb-4" data-v-946a59d8><div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center" data-v-946a59d8><svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-946a59d8><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-946a59d8></path></svg></div><div data-v-946a59d8><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100" data-v-946a59d8>確認重置</h3><p class="text-sm text-gray-600 dark:text-gray-400" data-v-946a59d8>您確定要重新開始訓練嗎？</p></div></div><p class="text-sm text-gray-600 dark:text-gray-400 mb-6" data-v-946a59d8> 這將清除當前的學習進度和統計數據，無法恢復。 </p>',2)),n("div",{class:"flex gap-3 justify-end"},[n("button",{onClick:b,class:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"}," 取消 "),n("button",{onClick:B,class:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors"}," 確認重置 ")])])])):M("",!0)],64))}}),Me=he(Le,[["__scopeId","data-v-946a59d8"]]),Ee={key:0},Oe={key:1,class:"text-gray-700 dark:text-gray-300 text-center"},Ne=re({__name:"ZigenTrain",props:{name:{},zigenUrl:{},range:{},mode:{},supplement:{type:Boolean},ming:{type:Boolean}},setup(W){const p=W;let E=p.name+"_zigen_grouped";const x=p.range;x&&(E+=`_${x[0]}_${x[1]}`);const Z=`zigen_sort_order_${p.name}`,f=v(!1),O=J(),S=J(),T=J();function I(){try{const o=localStorage.getItem(Z);if(o!==null){const s=JSON.parse(o);f.value=s,console.log("載入保存的排序狀態:",s)}}catch(o){console.warn("載入排序狀態失敗:",o)}}function m(){try{localStorage.setItem(Z,JSON.stringify(f.value)),console.log("排序狀態已保存:",f.value)}catch(o){console.warn("保存排序狀態失敗:",o)}}const $=["口","一","月","丶","日","人","亻","扌","白","土","丷","二","又","丿","宀","木","尚","辶","小","冖","厶","心","氵","八","女","大","艹","𠂇","匕","寸","也","乙","戈","目","讠","不","龰","阝","竹","了","十","夂","王","刂","儿","力","凵","冂","子","斤","火","米","丁","彐","纟","文","立","士","夕","乂","门","卜","自","尤","彳","羊","止","禾","贝","尸","工","乚","上","囗","至","手","𬺰","艮","车","石","田","己","几","牛","见","走","甲","且","彡","犬","巾","西","方","刀","殳","七","弓","巴","矢","示"],F=["鳥","烏","魚","馬","風","來","車","長","門","鬥","齒","飛","見","貝","鹵","僉","韋","咼","黽"],w=o=>{switch(p.mode){case"A":return o[0];case"a":return o[1];case"both":return o;default:return}};function y(o){for(const s of o.zigens){const c=$.indexOf(s.font);if(c!==-1)return c}for(const s of o.zigens){const c=F.indexOf(s.font);if(c!==-1)return 1e4+c}return 5e3}function h(o){return[...o].sort((s,c)=>{const B=y(s),b=y(c);return B-b})}function G(){console.log("切換排序模式被調用，當前狀態:",f.value),f.value=!f.value,console.log("切換後狀態:",f.value),m(),z(),console.log("排序應用完成，按鈕應該顯示為:",f.value?"橙色（字頻序）":"灰色（字典序）"),setTimeout(()=>{window.location.reload()},100)}function z(){O.value?(f.value?(S.value=h(O.value),console.log("已切換到字頻序，重新排序了",S.value.length,"個字根組")):(S.value=[...O.value],console.log("已切換到字典序，恢復原始順序")),N(()=>{console.log("排序更新完成，當前順序:",S.value.slice(0,3).map(o=>o.code))})):console.warn("originalCardGroups 未初始化，無法應用排序")}function L(o){var b,t;const s=[];let c=0;const B=[];console.log("=== 开始分组字根 ==="),console.log("输入字根总数:",o.length),console.log("练习模式:",p.mode);for(let C=0;C<o.length;C++){const g=o[C],R=(b=w(g.ma))==null?void 0:b.toLowerCase();if(!R){c++,B.push({font:g.font,ma:g.ma,reason:`getCode返回空值，mode=${p.mode}`}),console.warn(`跳过字根 ${C}: ${g.font} (${g.ma}) - getCode返回: ${w(g.ma)}`);continue}const d=C>0?o[C-1]:null;(d?(t=w(d.ma))==null?void 0:t.toLowerCase():null)===R&&s.length>0&&s[s.length-1].code===R?s[s.length-1].zigens.push(g):s.push({code:R,zigens:[g]})}return console.log("=== 分组完成 ==="),console.log("有效组数:",s.length),console.log("跳过的字根数:",c),c>0&&(console.log("跳过的字根详情:",B),console.log("前10个跳过的字根原因统计:"),B.slice(0,10).map(g=>`${g.font}(${g.ma}): ${g.reason}`).forEach(g=>console.log(`  - ${g}`))),s}function D(){O.value&&(new ae(E).reset(),f.value=!1,m(),z(),console.log("訓練已重置，排序狀態重置為字典序"))}return K(async()=>{I();const c=["joy","light","star","ming","wafel"].includes(p.name)?"/chaifen.json":`/chaifen-${p.name}.json`;console.log(`字根训练方案: ${p.name}, 使用拆分文件: ${c}`),T.value=await ce(c);let b=[...(await ge(p.zigenUrl)).values()];x&&(b=b.slice(x[0],x[1]));const t=L(b);O.value=t,z(),console.log(`字根練習：共 ${t.length} 個編碼組，包含 ${b.length} 個字根，當前${f.value?"字頻序":"字典序"}`)}),(o,s)=>S.value&&T.value?(i(),u("div",Ee,[be(Me,{name:j(E),"card-groups":S.value,"chaifen-map":T.value,mode:"g",supplement:p.supplement??!1,ming:p.ming??!1,"is-frequency-order":f.value,"on-toggle-sort":G,"on-reset":D},null,8,["name","card-groups","chaifen-map","supplement","ming","is-frequency-order"])])):(i(),u("h2",Oe," 下載資料中…… "))}});export{Ne as _};
