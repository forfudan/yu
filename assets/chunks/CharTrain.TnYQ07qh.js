import{d as Me,l as je,R as D,aa as Ee,v as Te,o as i,c as u,F as Q,m as e,t as d,n as l,e as z,O as P,p as A,C as ve,a as O,b as Ve,a3 as Ie,a4 as Fe,a0 as Re,a2 as Ae,H as b,j as x,k as L,_ as Ue}from"./framework.72Ik0KeM.js";import{b as $e,a as We,m as Ne,c as xe}from"./share.B3iA_d3Z.js";import{A as fe}from"./advancedSchedule.CyVEQGBC.js";import{_ as Be}from"./MultiCharPlot.vue_vue_type_script_setup_true_lang.Beh7G5s9.js";import{u as De,a as Pe,b as Oe,c as Ge,i as He,d as Ke}from"./cascadeStyles.BOW0gUVv.js";const Ze={key:0,class:"text-gray-700 dark:text-gray-300 text-center"},qe={key:1,class:"text-center py-16"},Xe={class:"mb-8"},Je={class:"text-xl text-gray-600 dark:text-gray-400 mb-4"},Qe={class:"flex justify-center gap-8 mb-8"},Ye={class:"bg-gradient-to-br from-yellow-100 to-yellow-200 dark:from-yellow-900/30 dark:to-yellow-800/30 rounded-xl px-6 py-4"},et={class:"text-3xl font-bold text-yellow-700 dark:text-yellow-400"},tt={class:"bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/30 dark:to-red-800/30 rounded-xl px-6 py-4"},at={class:"text-3xl font-bold text-red-700 dark:text-red-400"},st={class:"relative"},rt={class:"flex items-center gap-3"},lt={class:"font-semibold text-yellow-600 dark:text-yellow-400"},nt={key:0,class:"font-semibold text-red-600 dark:text-red-400"},ot={key:1,class:"font-semibold text-orange-600 dark:text-orange-400"},it={key:2,class:"text-red-600 dark:text-red-400"},ut={class:"relative h-full flex items-center overflow-visible"},dt={class:"text-sm"},ct={key:1,class:"text-gray-400 text-sm"},vt={class:"flex tracking-widest flex-col opacity-80"},xt={class:"font-mono text-blue-600 dark:text-blue-400"},ft={class:"flex items-center gap-1"},pt={class:"flex items-center gap-1"},gt={key:1,class:"text-blue-600 dark:text-blue-400 font-medium"},mt={class:"zigen-font"},yt={class:"font-mono"},bt=Me({__name:"CharTrain",props:{name:{},chaifenUrl:{},zigenUrl:{},range:{},rule:{},mabiaoUrl:{},popLevel:{}},setup(pe){const m=pe;let S=m.name+"_char";const C=m.range;C&&(S+=`_${C[0]}_${C[1]}`);const v=b(xe[S]),h=b(),M=b(),j=b(new Map);let c;const o=b({name:"",key:""}),k=x(0),E=x(),g=b(!0),y=b(!0),G=b(!1),T=b(""),U=x(0),V=x(!1),$=x(0),Y=x(0),ee=x(0),f=x(0),W=x(0),N=x(0),_=x(null),H=x(!1),ge=t=>t<500?{level:"æ¥µé€Ÿ",score:10,color:"text-yellow-400"}:t<1e3?{level:"é«˜é€Ÿ",score:8,color:"text-orange-400"}:t<1500?{level:"å¿«é€Ÿ",score:6,color:"text-green-400"}:t<2e3?{level:"æ™®é€Ÿ",score:4,color:"text-blue-400"}:t<3e3?{level:"æ…¢é€Ÿ",score:2,color:"text-gray-400"}:{level:"æ…¢é€Ÿ",score:1,color:"text-red-400"},B=L(()=>f.value>=100?5:f.value>=50?4:f.value>=30?3:f.value>=20?2.5:f.value>=10?2:f.value>=5?1.5:1),me=t=>{const a=Math.floor(t*B.value);return N.value+=a,a},ye=t=>{_.value=t,H.value=!0,setTimeout(()=>{H.value=!1},1500)};async function be(){if(!m.mabiaoUrl)return;const t=m.popLevel??0;if(t===0)return;const a=new Set(["a","e","i","o","u"]),s=new Map;try{const Z=(await(await fetch(m.mabiaoUrl)).text()).split(`
`);for(const F of Z){const q=F.trim();if(!q)continue;const[w,R]=q.split("	");if(!w||!R)continue;const X=w.toLowerCase();if(X.length<=t&&a.has(X[X.length-1])&&R.length===1){const J=R;(!s.has(J)||w.length<s.get(J).length)&&s.set(J,w)}}j.value=s}catch(n){console.error("Failed to load mabiao:",n)}}const r=x(typeof window<"u"?window.innerWidth:1024),te=x(),ae=()=>{r.value=window.innerWidth},se=De(te,r),he=Ke(r),ke=Pe(r),re=Oe(v,k),we=Ge(re),le=t=>He(t,he.value),Ce=L(()=>{const t=r.value<768,a=r.value<1024;return t?"text-6xl":a?"text-8xl":"text-9xl"}),I=L(()=>{var a;U.value;const t=(c==null?void 0:c.getProgressStats())||{practiced:0,total:((a=v.value)==null?void 0:a.length)||0,mastered:0,percentage:0};return{current:t.practiced,total:t.total,mastered:t.mastered,percentage:t.percentage.toFixed(1)}}),ne=L(()=>{if(!o.value||!h.value||!M.value)return!1;const t=h.value.get(o.value.name);return!t||!t.division?!1:Array.from(t.division).some(s=>{var p;const n=(p=M.value)==null?void 0:p.get(s);return(n==null?void 0:n.pinyin)&&n.pinyin.trim()!==""&&n.pinyin!=="Ã˜"})}),_e=L(()=>{if(!ne.value||!o.value||!h.value||!M.value)return[];const t=h.value.get(o.value.name);return!t||!t.division?[]:Array.from(t.division).map(s=>{var p;const n=(p=M.value)==null?void 0:p.get(s);return{font:s,pinyin:(n==null?void 0:n.pinyin)||""}}).filter(s=>s.pinyin&&s.pinyin.trim()!==""&&s.pinyin!=="Ã˜")}),oe=L(()=>{if(!o.value||!j.value||j.value.size===0)return null;const t=j.value.get(o.value.name);return t&&t.toLowerCase()!==o.value.key.toLowerCase()&&t.length!==o.value.key.length?t:null});je(async()=>{if(await be(),v.value&&h.value){c=new fe(S),c.initializeWithGroupCount(v.value.length);const n=c.getNextIndex();n!==null&&(k.value=n,o.value=v.value[n],g.value=c.isFirstTime(n)),D(()=>{var p;(p=E.value)==null||p.focus()});return}h.value=await $e(m.chaifenUrl);const t=await We(m.zigenUrl);M.value=t;let a=[...h.value.values()];C&&(a=a.slice(C[0],C[1])),v.value=a.map(n=>({name:n.char,key:Ne(n.division,t,m.rule)})),xe[S]=v.value,c=new fe(S),c.initializeWithGroupCount(v.value.length);const s=c.getNextIndex();s!==null&&(k.value=s,o.value=v.value[s],g.value=c.isFirstTime(s)),D(()=>{var n;(n=E.value)==null||n.focus()}),typeof window<"u"&&window.addEventListener("resize",ae),document.addEventListener("keydown",ce)}),Ee(()=>{typeof window<"u"&&window.removeEventListener("resize",ae),document.removeEventListener("keydown",ce)}),Te(T,t=>{var w;if(!o.value)return;const a=t.trim().toLowerCase(),s=o.value.key.toLowerCase(),n=(w=j.value.get(o.value.name))==null?void 0:w.toLowerCase(),p=n&&n!==s,Z=m.popLevel??0;let F=!1;if(Z>0){const R=/[aeiou]/.test(a);F=a.length>=s.length||R}else F=a.length>=s.length||p&&a.length>=n.length;if(!F)return;a===s||p&&a===n?ze():g.value||Le()});const ze=()=>{if(!o.value)return;y.value=!0,ee.value=Date.now()-Y.value;const t=ge(ee.value);f.value++,W.value=Math.max(W.value,f.value),me(t.score),ye(t),c.recordSuccess(k.value),U.value++,ie()},Le=()=>{o.value&&(y.value=!1,$.value++,g.value=!1,f.value=0,c.recordFailure(k.value),U.value++,T.value="",D(()=>{var t;(t=E.value)==null||t.focus()}))},ie=()=>{const t=c.getNextIndex();if(t!==null)k.value=t,o.value=v.value[t];else{G.value=!0;return}y.value=!0,$.value=0,T.value="",Y.value=Date.now(),c.isFirstTime(k.value)?g.value=!0:g.value=!1,D(()=>{var a;(a=E.value)==null||a.focus()})};function ue(){v.value&&(c.reset(),c.initializeWithGroupCount(v.value.length),G.value=!1,U.value++,f.value=0,W.value=0,N.value=0,_.value=null,H.value=!1,ie())}const Se=()=>{V.value=!0},de=()=>{ue(),V.value=!1},K=()=>{V.value=!1},ce=t=>{if(V.value){t.key==="Enter"?de():t.key==="Escape"&&K();return}t.key==="Escape"&&!g.value&&(g.value=!0,t.preventDefault())};return(t,a)=>(i(),u(Q,null,[!v.value||!h.value?(i(),u("h2",Ze," ä¸‹è¼‰æ•¸æ“šä¸­â€¦â€¦ ")):G.value?(i(),u("div",qe,[e("div",Xe,[a[4]||(a[4]=e("div",{class:"text-6xl mb-4"},"ğŸ‰",-1)),a[5]||(a[5]=e("h2",{class:"text-4xl font-bold mb-2"},"æ­å–œä½ å®Œæˆç·´ç¿’ï¼",-1)),e("p",Je," ä½ å·²ç¶“å®Œæˆäº† "+d(v.value.length)+" å€‹å–®å­—çš„ç·´ç¿’ã€‚ æ„Ÿè¬ä½ çš„åŠªåŠ›å’Œå …æŒï¼Œç‚ºä¸­è¯æ–‡æ˜å’Œæ¼¢å­—çš„å‚³æ‰¿åˆå¢æ·»äº†ä¸€ä»½åŠ›é‡ï¼ ",1),e("div",Qe,[e("div",Ye,[a[2]||(a[2]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"ç¸½åˆ†",-1)),e("div",et,d(N.value),1)]),e("div",tt,[a[3]||(a[3]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"æœ€é«˜é€£æ“Š",-1)),e("div",at,d(W.value),1)])])]),e("div",{class:"space-y-4"},[e("button",{onClick:ue,class:"px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 font-medium"}," æƒ³è¦å†è¨“ç·´ä¸€è¼ªå—ï¼Ÿ "),a[6]||(a[6]=e("div",{class:"text-sm text-gray-500 dark:text-gray-400"}," ç¹¼çºŒç·´ç¿’ä»¥éå›ºè¨˜æ†¶ ",-1))])])):(i(),u("div",{key:2,class:l(["mx-auto p-6 space-y-6",r.value<768?"max-w-sm p-3 space-y-3":"max-w-2xl"])},[e("div",st,[e("div",{class:l(["text-center text-gray-600 dark:text-gray-400",r.value<768?"text-xs":"text-sm"])},[e("div",{class:l(["flex justify-between items-center",r.value<768?"mb-1":"mb-2"])},[e("span",null,"å·²ç·´ç¿’: "+d(I.value.current)+" / "+d(I.value.total)+" ("+d(I.value.percentage)+"%) | å·²æŒæ¡: "+d(I.value.mastered),1),e("div",rt,[e("span",lt,"åˆ†æ•¸: "+d(N.value),1),f.value>0?(i(),u("span",nt,"é€£æ“Š: "+d(f.value)+"x",1)):z("",!0),B.value>1?(i(),u("span",ot,"å€æ•¸: "+d(B.value)+"x",1)):z("",!0),$.value>0?(i(),u("span",it,"éŒ¯èª¤: "+d($.value),1)):z("",!0)])],2),e("div",{class:l(["w-full bg-gray-200 dark:bg-gray-700 rounded-full",r.value<768?"h-1.5":"h-2"])},[e("div",{class:l(["bg-blue-500 dark:bg-blue-400 rounded-full transition-all duration-300",r.value<768?"h-1.5":"h-2"]),style:P(`width: ${I.value.percentage}%`)},null,6)],2)],2)]),e("div",{class:l(["w-full shadow-lg rounded-2xl transition-all duration-300 transform relative overflow-hidden",{"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800":!y.value,"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":y.value},"border-2 hover:shadow-xl"])},[e("div",{ref_key:"cascadeContainer",ref:te,class:"relative overflow-hidden py-3",style:P({height:r.value<768?"60px":"70px"})},[e("div",ut,[e("div",{class:"flex items-center h-full transition-transform duration-500 ease-out",style:P({transform:`translateX(${(A(ke)-A(we))*A(se)}px)`})},[(i(!0),u(Q,null,ve(A(re),s=>(i(),u("div",{key:s.index,class:l(["flex-shrink-0 flex items-center justify-center transition-all duration-500","cascade-item",{"cascade-current scale-110 font-bold":s.isCurrent,"cascade-side opacity-40 scale-75":!s.isCurrent&&le(s.offset),"opacity-0 scale-50":!le(s.offset)}]),style:P({width:`${A(se)}px`})},[e("span",{class:l(["zigen-font text-2xl md:text-3xl select-none",{"text-blue-700 dark:text-blue-300":s.isCurrent,"text-gray-500 dark:text-gray-500":!s.isCurrent}])},d(s.item.name),3)],6))),128))],4)])],4),a[9]||(a[9]=e("div",{class:"border-b border-gray-200 dark:border-gray-700"},null,-1)),e("div",{class:l(["absolute flex gap-2 z-10",r.value<768?"bottom-2 right-2":"bottom-4 right-4"])},[e("button",{onClick:Se,class:l(["rounded-full bg-red-500 hover:bg-red-600 text-white font-medium transition-all duration-200 flex items-center justify-center shadow-md",r.value<768?"w-6 h-6 text-xs":"w-8 h-8 text-xs"]),title:"é‡æ–°é–‹å§‹è¨“ç·´"},[(i(),u("svg",{class:l(r.value<768?"w-2 h-2":"w-3 h-3"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[7]||(a[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])],2))],2)],2),e("div",{class:l(["absolute z-30 bottom-4 left-4 font-bold drop-shadow-lg",r.value<768?"text-base":"text-xl"])},[_.value?(i(),u("div",{key:0,class:l(_.value.color)},[O(d(_.value.level)+" ",1),e("span",dt,"+"+d(Math.floor(_.value.score*B.value)),1)],2)):(i(),u("div",ct," ç­‰å¾…è¼¸å…¥... "))],2),e("div",{class:l(["text-center flex items-center justify-center",r.value<768?"h-32 py-2":"h-40 py-4"])},[e("div",{class:l(["flex items-center justify-center",r.value<768?"gap-4":"gap-8"])},[e("div",{class:l(["zigen-font transform transition-all duration-300",Ce.value,{"text-red-500 dark:text-red-400":!y.value,"text-blue-700 dark:text-blue-300":y.value}])},d(o.value.name),3),e("div",vt,[(i(),Ve(Be,{chars:o.value.name,size:r.value<768?80:120,key:o.value.name,loc:""},null,8,["chars","size"]))])],2)],2),e("div",{class:l(["flex justify-center",r.value<768?"pt-2 pb-2":"pt-3 pb-4"])},[Ie(e("input",{ref_key:"inputElement",ref:E,"onUpdate:modelValue":a[0]||(a[0]=s=>T.value=s),type:"text",placeholder:"ç·¨ç¢¼",class:l(["text-center border-2 rounded-xl font-mono","transition-all duration-300 focus:outline-none focus:ring-4",r.value<768?"px-3 py-2 text-lg w-32":"px-6 py-4 text-2xl w-48",{"border-red-300 focus:border-red-500 focus:ring-red-200 bg-red-50 dark:border-red-700 dark:focus:border-red-500 dark:focus:ring-red-900/50 dark:bg-red-900/20 dark:text-white":!y.value,"border-blue-300 focus:border-blue-500 focus:ring-blue-200 bg-white dark:border-blue-700 dark:focus:border-blue-500 dark:focus:ring-blue-900/50 dark:bg-gray-800 dark:text-white":y.value}])},null,2),[[Fe,T.value]])],2),e("div",{class:l(["text-center transition-all duration-300",r.value<768?"pb-2":"pb-4",{"opacity-0 transform translate-y-2":!g.value,"opacity-100":g.value}])},[e("div",{class:l(["inline-block bg-gray-100 dark:bg-gray-800 rounded-lg",r.value<768?"px-2 py-1":"px-4 py-2"])},[e("span",{class:l(["font-mono font-bold text-blue-600 dark:text-blue-400",r.value<768?"text-lg":"text-xl"])},d(o.value.key),3),oe.value?(i(),u("span",{key:0,class:l(["text-gray-600 dark:text-gray-400 ml-2",r.value<768?"text-xs":"text-sm"])},[a[8]||(a[8]=O("ç°¡ç¢¼ ",-1)),e("b",xt,d(oe.value),1)],2)):z("",!0)],2)],2)],2),e("div",{class:l(["text-center text-gray-500 dark:text-gray-400 space-y-1",r.value<768?"text-xs":"text-sm"])},[g.value?(i(),u("div",gt," ç¹¼çºŒè¼¸å…¥æ­£ç¢ºç·¨ç¢¼ ")):(i(),u("div",{key:0,class:l(["flex items-center justify-center",r.value<768?"gap-2 flex-col":"gap-4"])},[e("span",ft,[e("kbd",{class:l(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",r.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"è¼¸å…¥",2),a[10]||(a[10]=O(" è‡ªå‹•æª¢æŸ¥ ",-1))]),e("span",pt,[e("kbd",{class:l(["bg-gray-100 dark:bg-gray-800 dark:text-gray-300 rounded",r.value<768?"px-1 py-0.5 text-xs":"px-2 py-1 text-xs"])},"Esc",2),a[11]||(a[11]=O(" é¡¯ç¤ºç­”æ¡ˆ ",-1))])],2))],2),ne.value?(i(),u("div",{key:0,class:l(["mx-auto max-w-md mt-4",r.value<768?"max-w-xs mt-2":"max-w-md mt-4"])},[e("div",{class:l(["border-2 border-dashed border-blue-300 dark:border-blue-600 rounded-lg bg-blue-50 dark:bg-blue-900/20 p-3 transition-all duration-300",r.value<768?"p-2":"p-3"])},[e("div",{class:l(["text-center font-medium text-blue-800 dark:text-blue-300 mb-2",r.value<768?"text-xs mb-1":"text-sm mb-2"])}," æ‹¼éŸ³åˆ°éŸ³æ‰˜ä¹‹é—œä¿‚è§£æ ",2),e("div",{class:l(["text-center space-y-1",r.value<768?"text-xs space-y-0.5":"text-sm space-y-1"])},[(i(!0),u(Q,null,ve(_e.value,(s,n)=>(i(),u("div",{key:`${s.font}-${s.pinyin}-${n}`,class:l(["text-blue-700 dark:text-blue-300"])},[e("span",mt,d(s.font),1),e("span",yt," ("+d(s.pinyin)+")",1)]))),128))],2)],2)],2)):z("",!0)],2)),V.value?(i(),u("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:K},[e("div",{class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm mx-4 shadow-xl",onClick:a[1]||(a[1]=Re(()=>{},["stop"]))},[a[12]||(a[12]=Ae('<div class="flex items-center gap-3 mb-4" data-v-04133069><div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center" data-v-04133069><svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-04133069><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-04133069></path></svg></div><div data-v-04133069><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100" data-v-04133069>ç¢ºèªé‡ç½®</h3><p class="text-sm text-gray-600 dark:text-gray-400" data-v-04133069>æ‚¨ç¢ºå®šè¦é‡æ–°é–‹å§‹è¨“ç·´å—ï¼Ÿ</p></div></div><p class="text-sm text-gray-600 dark:text-gray-400 mb-6" data-v-04133069> é€™å°‡æ¸…é™¤ç•¶å‰çš„å­¸ç¿’é€²åº¦å’Œçµ±è¨ˆæ•¸æ“šï¼Œç„¡æ³•æ¢å¾©ã€‚ </p>',2)),e("div",{class:"flex gap-3 justify-end"},[e("button",{onClick:K,class:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"}," å–æ¶ˆ "),e("button",{onClick:de,class:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors"}," ç¢ºèªé‡ç½® ")])])])):z("",!0)],64))}}),zt=Ue(bt,[["__scopeId","data-v-04133069"]]);export{zt as T};
