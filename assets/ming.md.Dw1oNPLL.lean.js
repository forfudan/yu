import{g as he,d as G,c as m,o as g,F as L,r as K,m as i,C as T,t as x,h as P,k as S,v as E,l as ne,R as ge,y as me,a3 as be,a4 as xe,b as ae,e as F,n as B,p as ee,_ as ke,E as we,w as _e,H as ye,a as Ce}from"./chunks/framework.D3o4Ln5n.js";const $e={pop:0,len:4,autoCm:5,cm1:" ",cm2:";",cm3:"'",keys:26};let te=!1;async function Pe(){if(window.pako||te)return window.pako;try{const l=document.createElement("script");return l.src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js",l.crossOrigin="anonymous",await new Promise((a,s)=>{l.onload=a,l.onerror=s,document.head.appendChild(l)}),te=!0,window.pako}catch(l){return console.warn("Failed to load pako library:",l),null}}async function Se(l){const a=await Le(l);return new TextDecoder("utf-8").decode(a)}async function Le(l){try{const a=await Pe();if(a){console.log("📦 Using pako for gzip decompression");const f=new Uint8Array(l);return a.inflate(f).buffer}if(console.log("🌐 Using browser DecompressionStream for gzip decompression"),typeof DecompressionStream>"u")throw new Error("DecompressionStream not supported and pako not available");const o=new ReadableStream({start(f){f.enqueue(new Uint8Array(l)),f.close()}}).pipeThrough(new DecompressionStream("gzip")),v=[],r=o.getReader();for(;;){const{done:f,value:k}=await r.read();if(f)break;v.push(k)}const b=v.reduce((f,k)=>f+k.length,0),p=new Uint8Array(b);let d=0;for(const f of v)p.set(f,d),d+=f.length;return p.buffer}catch(a){throw console.error("Failed to decompress gzip data:",a),new Error(`Gzip decompression failed: ${a.message}`)}}async function De(l,a){console.log("开始获取码表:",l);const s=await fetch(he(l));if(!s.ok)throw new Error(`Failed to fetch mabiao: ${s.status}`);const o=await s.arrayBuffer(),v=s.headers.get("content-type")||"";console.log("响应类型:",v,"数据大小:",o.byteLength);const r=l.endsWith(".json")||v.includes("application/json");let b;if(r){console.log("检测到JSON格式，开始解压缩..."),b=await Se(o);const p=JSON.parse(b),d=Object.entries(p);console.log("JSON解析完成，条目数:",d.length),a&&(a.value.max=d.length,a.value.current=d.length);const f=[];for(const[k,h]of d)if(Array.isArray(h))for(const M of h)f.push({name:String(M),key:k});else f.push({name:String(h),key:k});return f.sort((k,h)=>k.key.localeCompare(h.key)),console.log("转换完成，返回",f.length,"个条目"),f}else{b=new TextDecoder("utf-8").decode(o),console.log("TSV数据长度:",b.length);const p=b.split(`
`).filter(d=>d.trim()!=="");return a&&(a.value.max=p.length),p.map((d,f)=>{a&&(a.value.current=f+1);const[k,h]=d.split("	");return{name:h,key:k}})}}function se(l,a){return l===a?0:l<a?-1:1}function Ie(l,a){if(a==="")return[0,l.length];const s=J(l,a,0,le);if(s<0)return null;const o=J(l,a,s,Be);return o<0?null:[s,o]}function H(l,a){const s=J(l,a,0,le);return s<0||!l[s].key.startsWith(a)?null:s}function J(l,a,s,o){let v=s;const r=o(l,a,v);if(r===0)return v;if(r<0)return-1;let b=l.length-1;const p=o(l,a,b);if(p===0)return b+1;if(p>0)return-1;let d=v+(b-v)/2|0,f=o(l,a,d);for(;f!==0;){if(b-v===1)return b;f>0?v=d:b=d,d=v+(b-v)/2|0,f=o(l,a,d)}return d}function le(l,a,s){const o=O(l[s],a),v=s===0?!1:O(l[s-1],a);return o?v?-1:0:v?-1:se(a,l[s].key)}function Be(l,a,s){const o=O(l[s],a);if(o&&s===l.length-1)return 0;const v=s===0?!1:O(l[s-1],a);return o?1:v?0:se(a,l[s].key)}function O(l,a){return!l||!l.key?!1:l.key.startsWith(a,0)}const je={class:"text-xl bg-neutral-50 dark:bg-neutral-900 w-full text-slate-900 dark:text-slate-400 select-none"},Te={class:"flex min-h-9 h-9 text-base bg-neutral-100 dark:bg-neutral-800 pt-1 break-keep text-nowrap w-full"},Me={class:"grid grid-cols-10 gap-0.5 p-1"},ze=["onClick"],Ae=["onClick"],Ue=["onClick"],Ne={class:"grid grid-cols-10 gap-0.5 p-1 pt-0"},Ve=G({__name:"Keyboard",emits:["click"],setup(l){return(a,s)=>(g(),m(L,null,[K(a.$slots,"codes"),i("div",je,[i("div",Te,[K(a.$slots,"cadidate")]),i("div",Me,[(g(),m(L,null,T("qwertyuiop",o=>i("button",{key:o,class:"aspect-square hover:bg-slate-300 hover:dark:bg-slate-800 flex items-center justify-center",onClick:v=>a.$emit("click",o)},x(o),9,ze)),64)),(g(),m(L,null,T("asdfghjkl;",o=>i("button",{key:o,class:"aspect-square hover:bg-slate-300 hover:dark:bg-slate-800 flex items-center justify-center",onClick:v=>a.$emit("click",o)},x(o),9,Ae)),64)),(g(),m(L,null,T("zxcvbnm,./",o=>i("button",{key:o,class:"aspect-square hover:bg-slate-300 hover:dark:bg-slate-800 flex items-center justify-center",onClick:v=>a.$emit("click",o)},x(o),9,Ue)),64))]),i("div",Ne,[i("button",{class:"col-span-2 hover:bg-slate-300 hover:dark:bg-slate-800 py-3 text-sm text-neutral-500 border rounded flex items-center justify-center",onClick:s[0]||(s[0]=o=>a.$emit("click","toggle-lang"))}," 中/英 "),i("button",{class:"col-span-6 hover:bg-slate-300 hover:dark:bg-slate-800 py-3 text-sm text-neutral-500 rounded flex items-center justify-center",onClick:s[1]||(s[1]=o=>a.$emit("click"," "))}," 空格 "),i("button",{class:"col-span-2 text-neutral-400 hover:bg-slate-300 hover:dark:bg-slate-800 flex justify-center items-center rounded",onClick:s[2]||(s[2]=o=>a.$emit("click","bs"))},[...s[3]||(s[3]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[i("path",{fill:"currentColor",d:"M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m-3 12.59L17.59 17L14 13.41L10.41 17L9 15.59L12.59 12L9 8.41L10.41 7L14 10.59L17.59 7L19 8.41L15.41 12"})],-1)])])])])],64))}}),Ee={class:"pt-3"},Ke={class:"relative w-full"},Oe={class:"flex justify-end mb-2 space-x-2"},qe={class:"flex items-center space-x-2"},We={key:0,class:"h-4"},Fe={key:1,class:"text-xs bg-neutral-200 dark:bg-neutral-900 w-max px-2 h-4 select-none"},He={key:0,class:"flex items-center min-h-[3.5rem] h-[3.5rem]"},Je={key:0,class:"text-sm text-slate-500 ml-6 mt-1"},Ge={key:0},Ze={key:1},Ye={key:1,class:"text-sm text-slate-400 dark:text-slate-500 ml-6 mt-1"},Qe={class:"relative flex items-center min-h-[3.5rem] border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 shadow-sm",ref:"candidateContainer"},Re={class:"flex-1 min-w-0 overflow-x-auto overflow-y-hidden scrollbar-hide",style:{"scrollbar-width":"none","-ms-overflow-style":"none"}},Xe={class:"flex"},et=["onClick"],tt={class:"text-xs text-slate-400 dark:text-slate-500"},nt={class:"text-xl select-text px-2 text-slate-900 dark:text-slate-200"},at={class:"text-base text-blue-400 dark:text-blue-500 mt-0"},st={class:"flex items-center mx-2 space-x-1"},lt=["disabled"],ot=["disabled"],rt={key:0,class:"absolute top-full left-0 right-0 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg z-[9999] p-4 mt-2"},it={class:"flex justify-between items-center mb-2"},ut={class:"text-sm text-slate-500"},ct={class:"flex space-x-2"},dt=["disabled"],vt={class:"text-sm text-slate-500 px-2 py-1"},ft=["disabled"],pt={class:"flex flex-wrap gap-2 max-h-64 overflow-y-auto"},ht=["onClick"],gt={class:"text-slate-900 dark:text-slate-200 font-medium text-lg leading-tight"},mt={key:0,class:"text-xs text-slate-400 mt-1"},bt={class:"text-xs text-blue-400 dark:text-blue-500 mt-1 truncate max-w-full"},I=9,j=24,xt=G({__name:"InputMethod",props:{id:{},data:{},rule:{}},setup(l){const a=l,s=a.data;console.log("🎯 InputMethod loaded with",s.length,"items");const o=P(!0),v=P(!1),r=P(""),b=[",",".","!","?","[","]","{","}","(",")","\\"],p=S(()=>{if(!o.value)return[];const t=r.value;if(!t)return[];const e=Ie(s,t);if(!e)return[];let n=s.slice(e[0],e[1]);const u=n.filter(C=>C.key===t);let c=n.filter(C=>{const w=C.key;if(w===t||!w.startsWith(t))return!1;const N=w.slice(t.length);return N.length===1&&"aeiou".includes(N)});return c=c.filter(C=>{const w=C.name.charCodeAt(0);return w>=19968&&w<=40959||w>=13312&&w<=19903||w>=12288&&w<=12351||w>=12544&&w<=12591||w>=12704&&w<=12735}),[...u,...c]}),d=P(0),f=P(!1),k=P(!1),h=S(()=>{if(p.value.length===0)return[];const t=d.value*I;return p.value.slice(t,t+I)}),M=S(()=>d.value<1),Z=S(()=>d.value>=Math.ceil(p.value.length/I)-1),_=P(0),oe=S(()=>{if(!r.value)return[];const t=r.value,e=s.filter(c=>c.key&&c.key.startsWith(t)),n=_.value*j,u=Math.min(n+j,e.length);return e.slice(n,u)}),z=S(()=>{if(!r.value)return 0;const t=r.value,e=s.filter(n=>n.key&&n.key.startsWith(t));return e.length===0?0:Math.ceil(e.length/j)});S(()=>p.value.length>I);function re(){_.value<z.value-1&&_.value++}function ie(){_.value>0&&_.value--}const D=P(""),A=P();function $(t){y(t),r.value="",d.value=0}function U(t){r.value&&h.value.length>0&&$(h.value[0].name),y(t)}function ue(t){if(console.log("[onClick] key:",t),t==="toggle-lang"){o.value=!o.value,o.value||(r.value=""),console.log("语言模式切换:",o.value?"中文":"英文");return}if(!o.value&&t!=="bs"&&t!==" "){console.log("英文模式輸入字符:",t),y(t);return}if(t==="bs"){r.value?r.value=r.value.slice(0,-1):D.value.length>0&&(D.value=D.value.slice(0,-1));return}if(t===" "){if(!o.value){y(" ");return}r.value?h.value.length>0?$(h.value[0].name):(r.value="",d.value=0):y(" ");return}if(t===";"){r.value&&h.value.length>=2?$(h.value[1].name):y(t);return}if(t==="'"){r.value&&h.value.length>=3?$(h.value[2].name):y(t);return}if(t==='"'){U(t);return}if(b.includes(t)){U(t);return}if(o.value){let e=t;/^[A-Z]$/.test(t)&&(e=t.toLowerCase()),Q(e),r.value+=e,d.value=0}else y(t)}function ce(t){if(console.log("[convertToChinese] called:",{words:t,isChineseMode:o.value}),!o.value)return t;let e="";for(let n=0;n<t.length;n++){const u=t[n];switch(u){case",":e+="，";break;case".":e+="。";break;case";":e+="；";break;case"!":e+="！";break;case"?":e+="？";break;case"\\":e+="、";break;case"[":e+="「";break;case"]":e+="」";break;case"{":e+="『";break;case"}":e+="』";break;case'"':v.value,e+='"',v.value=!v.value;break;case"'":e+="'";break;default:e+=u;break}}return e}function y(t){const e=ce(t),n=A.value;n.focus();const{selectionStart:u,selectionEnd:c}=n,C=n.value;if(console.log("commit 調用:",{words:e,selectionStart:u,selectionEnd:c,currentValue:C.slice(0,20)+(C.length>20?"...":""),textLength:C.length}),u===C.length&&c===C.length){const W=C+e;D.value=W,n.value=W;const X=W.length;n.selectionStart=X,n.selectionEnd=X;return}const w=C.slice(0,u||0),N=C.slice(c||u||0),V=w+e+N;D.value=V,n.value=V;const q=(u||0)+e.length;n.selectionStart=q,n.selectionEnd=q,console.log("commit 完成:",{newValue:V.slice(0,20)+(V.length>20?"...":""),newCursorPosition:q})}function Y(t){$(t.name)}function de(){}function ve(){}E(p,t=>{if(d.value=0,_.value=0,t.length===1&&r.value){const e=r.value;(e.length>=5||"aeiou".includes(e.at(-1)))&&(console.log("檢測到唯一候選項，自動上屏:",t[0].name),$(t[0].name))}},{immediate:!0}),E(r,()=>{d.value=0,_.value=0}),ne(()=>{ge(()=>{A.value&&A.value.focus()})}),me(()=>{}),E(p,t=>{if(t.length>0)return;const e=a.rule.autoCm;let n=r.value;if(n.length<e+1)return;let u=null;do{if(n=n.slice(0,-1),n.length===0)return;u=H(s,n)}while(u===null);const c=s[u];y(c.name),r.value=r.value.at(-1)||""}),E(r,t=>{const e=a.rule.pop,n=5;if(t.length>n)if(e){const u=H(a.data,t.slice(0,e));if(u===null)return;const c=a.data[u];y(c.name),r.value=r.value.slice(e)}else{const u=H(a.data,t.slice(0,n));if(u!==null){const c=a.data[u];y(c.name)}r.value=r.value.slice(n)}});function Q(t){const e=r.value;if(!e)return;const n=p.value;if(n.length!==0){if(console.log("checkAutoCommit 调用:",{当前编码:e,即将添加:t,新编码:e+t,当前候选数量:n.length,当前候选项:n.map(u=>u.name).slice(0,5)}),n.length===1){const u=r.value;if(u.length>=5||"aeiou".includes(u.at(-1))){console.log("当前候选项唯一，上屏:",n[0].name),$(n[0].name);return}}if(n.length>1){if(e.length>=5){console.log("當前編碼達到5碼，即將輸入第6碼，上屏首選:",n[0].name),$(n[0].name);return}const u=e[e.length-1];if("aeiou".includes(u)){console.log("當前編碼元音結尾，上屏首選:",{編碼:e,結尾字符:u,首選:n[0].name}),$(n[0].name);return}}console.log("無需上屏")}}const fe=new Set(`abcdefghijklmnopqrstuvwxyz/;'",.[]{}!?\\${a.rule.keys===27?";":""}`),R=S(()=>{const{cm1:t,cm2:e,cm3:n}=a.rule,u=new Map;u.set(t,0),u.set(e,1),u.set(n,2);for(let c=0;c<9;c++)u.set(String(c+1),c);return u});function pe(t){const{key:e}=t;if(e==="ArrowUp"&&p.value.length>0){t.preventDefault(),t.stopPropagation(),d.value>0&&d.value--;return}if(e==="ArrowDown"&&p.value.length>0){t.preventDefault(),t.stopPropagation();const c=I;(d.value+1)*c<p.value.length&&d.value++;return}if(t.ctrlKey||t.metaKey||t.altKey)return;const n=r.value;if(fe.has(e)){if(t.preventDefault(),t.stopPropagation(),e===";"){r.value&&h.value.length>=2?$(h.value[1].name):y(e);return}if(e==="'"){r.value&&h.value.length>=3?$(h.value[2].name):y(e);return}if(e==='"'){U(e);return}if(b.includes(e)){U(e);return}if(!o.value){console.log("物理鍵盤英文模式輸入:",e),y(e);return}let c=e;/^[A-Z]$/.test(e)&&(c=e.toLowerCase()),Q(c),r.value+=c,d.value=0;return}if(e===" "){if(!o.value)return;n&&(t.preventDefault(),t.stopPropagation(),h.value.length>0?$(h.value[0].name):(r.value="",d.value=0));return}if(R.value.has(e)&&e!==" "){const c=R.value.get(e);c<h.value.length&&(t.preventDefault(),t.stopPropagation(),$(h.value[c].name));return}if(e==="Backspace"){n&&(t.preventDefault(),t.stopPropagation(),r.value=n.slice(0,-1));return}if(e==="Escape"&&n){t.preventDefault(),t.stopPropagation(),r.value="";return}const u=d.value;if(e==="-"&&n){t.preventDefault(),t.stopPropagation(),u>0&&d.value--;return}if(e==="="&&n){t.preventDefault(),t.stopPropagation();const c=I;u+1<p.value.length/c&&d.value++;return}}return(t,e)=>(g(),m(L,null,[i("div",Ee,[be(i("textarea",{"onUpdate:modelValue":e[0]||(e[0]=n=>D.value=n),ref_key:"textarea",ref:A,class:"textarea textarea-bordered textarea-md w-full bg-neutral-50 dark:bg-neutral-700",placeholder:"輸入數據在本地分析加載，不會上傳雲端。",onKeydown:pe,onFocus:de,onBlur:ve},null,544),[[xe,D.value]])]),i("div",Ke,[i("div",Oe,[i("button",{onClick:e[1]||(e[1]=n=>k.value=!k.value),class:"px-3 py-1 rounded bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs"},x(k.value?"隱藏更多候選框":"顯示更多候選項"),1),i("button",{onClick:e[2]||(e[2]=n=>f.value=!f.value),class:"px-3 py-1 rounded bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs"},x(f.value?"收起鍵盤":"顯示鍵盤"),1)]),i("div",null,[i("div",qe,[i("div",{class:B(["text-xs px-2 h-4 rounded select-none",o.value?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200"])},x(o.value?"中":"英"),3),r.value===""?(g(),m("div",We)):(g(),m("div",Fe,x(r.value),1))]),p.value.length===0?(g(),m("div",He,[r.value.length===0?(g(),m("div",Je,[K(t.$slots,"default",{},()=>[o.value?(g(),m("span",Ge,"中文輸入模式，記得關閉系統輸入法")):(g(),m("span",Ze,"英文輸入模式，記得關閉系統輸法"))],!0)])):(g(),m("div",Ye,"空码"))])):(g(),m(L,{key:1},[i("div",Qe,[i("div",Re,[i("div",Xe,[(g(!0),m(L,null,T(h.value,(n,u)=>(g(),m("button",{class:"px-3 py-2 text-base hover:bg-slate-200 dark:hover:bg-slate-900 whitespace-nowrap flex-shrink-0 rounded flex flex-col items-center",onClick:c=>Y(n)},[i("span",tt,x(u+1),1),i("span",nt,x(n.name),1),i("span",at,x(n.key.slice(r.value.length)),1)],8,et))),256))])]),i("div",st,[i("button",{class:B([{"text-transparent":M.value},"hover:bg-slate-200 dark:hover:bg-slate-700 rounded px-1"]),disabled:M.value,onClick:e[3]||(e[3]=n=>d.value--)},"◂",10,lt),i("button",{class:B([{"text-transparent":Z.value},"hover:bg-slate-200 dark:hover:bg-slate-700 rounded px-1"]),disabled:Z.value,onClick:e[4]||(e[4]=n=>d.value++)},"▸",10,ot)])],512),k.value?(g(),m("div",rt,[i("div",it,[i("div",ut," 候選字 "+x(_.value*j+1)+"-"+x(Math.min((_.value+1)*j,p.value.length))+" / "+x(p.value.length),1),i("div",ct,[i("button",{disabled:_.value===0,class:B([{"text-slate-300":_.value===0},"px-2 py-1 text-sm hover:bg-slate-100 dark:hover:bg-slate-700 rounded"]),onClick:ie}," ← 上一頁 ",10,dt),i("span",vt,x(_.value+1)+" / "+x(z.value),1),i("button",{disabled:_.value>=z.value-1,class:B([{"text-slate-300":_.value>=z.value-1},"px-2 py-1 text-sm hover:bg-slate-100 dark:hover:bg-slate-700 rounded"]),onClick:re}," 下一頁 → ",10,ft)])]),i("div",pt,[(g(!0),m(L,null,T(oe.value,(n,u)=>(g(),m("button",{key:u,onClick:c=>Y(n),class:"inline-flex flex-col items-center px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded border border-slate-200 dark:border-slate-600 min-w-0"},[i("div",gt,x(n.name),1),n.name&&ee(s).filter(c=>c.name===n.name).length>1?(g(),m("div",mt,[i("span",null,x(ee(s).filter(c=>c.name===n.name).map(c=>c.key).sort().join(" ")),1)])):F("",!0),i("div",bt,x(n.key),1)],8,ht))),128))])])):F("",!0)],64))]),f.value?(g(),ae(Ve,{key:0,onClick:ue,onHideKeyboard:e[5]||(e[5]=n=>f.value=!1)})):F("",!0)])],64))}}),kt=ke(xt,[["__scopeId","data-v-c34c2431"]]),wt={key:0,class:"text-gray-600 text-center mt-10"},_t=["value","max"],yt=G({__name:"FetchInput",props:{mabiaoUrl:{},id:{}},setup(l){const a=l,s=we(),o=P({max:0,current:0});return ne(async()=>{var v;try{s.value=await De(a.mabiaoUrl,o),console.log("✅ Mabiao loaded successfully:",(v=s.value)==null?void 0:v.length,"items")}catch(r){console.error("❌ Failed to load mabiao:",r)}}),(v,r)=>s.value?(g(),ae(kt,{key:1,id:l.id||l.mabiaoUrl,rule:$e,data:s.value},{default:_e(()=>[K(v.$slots,"default")]),_:3},8,["id","rule","data"])):(g(),m("div",wt,[r[0]||(r[0]=i("div",{class:"text-center"},"下载码表……",-1)),i("progress",{class:"progress progress-info w-full max-w-screen-sm",value:o.value.current,max:o.value.max},null,8,_t)]))}}),Pt=JSON.parse('{"title":"宇浩日月在線輸入","description":"","frontmatter":{"aside":false},"headers":[],"relativePath":"ming.md","filePath":"ming.md"}'),Ct={name:"ming.md"},St=Object.assign(Ct,{setup(l){return(a,s)=>(g(),m("div",null,[s[0]||(s[0]=i("h1",{id:"宇浩日月在線輸入",tabindex:"-1"},[Ce("宇浩日月在線輸入 "),i("a",{class:"header-anchor",href:"#宇浩日月在線輸入","aria-label":'Permalink to "宇浩日月在線輸入"'},"​")],-1)),ye(yt,{mabiaoUrl:"/mabiao-ming.json"})]))}});export{Pt as __pageData,St as default};
